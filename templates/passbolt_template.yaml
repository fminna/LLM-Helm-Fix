---
# Source: passbolt/charts/mariadb/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-mariadb
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
  annotations:
automountServiceAccountToken: false
---
# Source: passbolt/charts/redis/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
automountServiceAccountToken: true
metadata:
  name: release-name-redis
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
---
# Source: passbolt/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-passbolt-sa-common
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: common
    app.kubernetes.io/type: sa
---
# Source: passbolt/charts/mariadb/templates/secrets.yaml
apiVersion: v1
kind: Secret
metadata:
  name: release-name-mariadb
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
type: Opaque
data:
  mariadb-root-password: "cm9vdA=="
  mariadb-password: "Q0hBTkdFTUU="
  mariadb-replication-password: "Q0hBTkdFTUU="
---
# Source: passbolt/charts/redis/templates/secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: release-name-redis
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
type: Opaque
data:
  redis-password: "Q0hBTkdFTUU="
---
# Source: passbolt/templates/secret-tls-ingress.yaml
apiVersion: v1
kind: Secret
metadata:
  name: release-name-passbolt-sec-tls-ingress-0
  labels:
    app.kubernetes.io/action: tls-ingress
    app.kubernetes.io/type: sec
type: Opaque
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURNVENDQWhtZ0F3SUJBZ0lRQnRUTzA2QTM3d1hCMWVXSi9md2xJekFOQmdrcWhraUc5dzBCQVFzRkFEQVQKTVJFd0R3WURWUVFERXdoMllYVnNkQzFqWVRBZUZ3MHlOREExTVRVd09URXhNalphRncweU5UQTFNVFV3T1RFeApNalphTUJreEZ6QVZCZ05WQkFNVERuQmhjM05pYjJ4MExteHZZMkZzTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGCkFBT0NBUThBTUlJQkNnS0NBUUVBeDd4S1JobGNwT3BFR09qWUo2MjFuazF4Q3l0VVVjNzJ5UGdvRDl0WnhJbU0KZEdKZ2Z1NmFRVTNKbDJjeSs5bjdmUmFveWY2Ym0zQzhJZnNiTVpiWGo2cXA5RHVlZFliRzBqS3FaOVpNYTc1UApkWlRwRVJFQU5oZDhCYkQyd3g2RW93UHdFRG1NWlR3Q09aOWtOTUc0TDl3VlVody9QNk1aVnYwQ0h0NWgwdTdqClcyY2cyQ1d0OUNEMkc1MlFFbnZuNVFpdXJuN1RudTMrclJQV09UZ0ZIWnRjeUpTSVliZ3EzTzFybll1L2FkRUgKWno2NGNYcmpoUmQzSDBtakhxUVJZMkc1WG1MYXQ1bDZwR2VtMDR6TzEzR2tFbGkrcERPUG0rTCt3Y0w5bDFYLwpycE9meDU2dWRERnJLR2xVNzVIUW40aVg3ZWZTVFlSZklwdklzcmgxUXdJREFRQUJvM3N3ZVRBT0JnTlZIUThCCkFmOEVCQU1DQmFBd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3RUdDQ3NHQVFVRkJ3TUNNQXdHQTFVZEV3RUIKL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVQ0lqWXJYWThrWVhKRnF1V1l5ZDhvaHhsbnY0d0dRWURWUjBSQkJJdwpFSUlPY0dGemMySnZiSFF1Ykc5allXd3dEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSmNQNEx2U0hqMTlMaHRDClVyZXkwUXA2ZW1qS2dLWUxyRG1GY3BycGxWbk1zZzEzZGxVUjNiTzgzSWoxc2IzeThVVk9WUjdXVXhZQklCY2YKV1dvSWliazBlSHo4dXZBRU9NT0c0bkIrVTQyTHlocS91b3lzb3ZWSXQrVTRTOTVrSHY5eXZ5cjh6ZlJMZ3BmdwpOU2Y4bU1ienVJMktwUzFFNzR6RmhIRWJWODF5NEVHaXBJMWkvWE1lNk5Ob1FRaUlxcHN0bTZIVUdlVHpzQThNCnFyczh0Tm1zRU52YUs1ZVlHYU9KYUZBU2MzSkx6dHh6ZGhxZkFMNGIxVTI1KytmR2ZYb0d0ZjUvaXZZay9uemUKN3ZyTjRYbU1KdFdLU09IQVRlbG0vRmNUd0tsRitoVGpWMXEydUh3ZnYyelNTQmdsOUI3azZGKytVM09pNnNtZQo0dHo3RXdRPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBeDd4S1JobGNwT3BFR09qWUo2MjFuazF4Q3l0VVVjNzJ5UGdvRDl0WnhJbU1kR0pnCmZ1NmFRVTNKbDJjeSs5bjdmUmFveWY2Ym0zQzhJZnNiTVpiWGo2cXA5RHVlZFliRzBqS3FaOVpNYTc1UGRaVHAKRVJFQU5oZDhCYkQyd3g2RW93UHdFRG1NWlR3Q09aOWtOTUc0TDl3VlVody9QNk1aVnYwQ0h0NWgwdTdqVzJjZwoyQ1d0OUNEMkc1MlFFbnZuNVFpdXJuN1RudTMrclJQV09UZ0ZIWnRjeUpTSVliZ3EzTzFybll1L2FkRUhaejY0CmNYcmpoUmQzSDBtakhxUVJZMkc1WG1MYXQ1bDZwR2VtMDR6TzEzR2tFbGkrcERPUG0rTCt3Y0w5bDFYL3JwT2YKeDU2dWRERnJLR2xVNzVIUW40aVg3ZWZTVFlSZklwdklzcmgxUXdJREFRQUJBb0lCQUdaUjBlYkpOVW1TYlNJcApuaG50aGgyN1pFNnBlcitSKzZDR1o5ZC9zaVBacHVjMFFtU2tETWVwZHIwbDg5dExGdWRFeFdEOUdtL3R0NkxjCnhWaUpBcEtwaGZrRTFhODFSUU1IUzM1NExKd0JXU2xPQ0h0aXJ5NEdwOVV1aTZyM0psRndRZm05MFd0RzY0amoKVzIwZlZDRElhTyt3WXNKUjVqaEcwbUJINGVzdzUrY25wUXgxYUFOQUlma0l6dzlkcFVudU1oaEhrSC9wNEMybAptRzBxd1c3R2VhVWJKL3I0NGoraVRrTVNMMlU4SmNmb21GbisyS3V2TjM2UTh0V0kzS2MvNk1XQVBxQjhvR1orCnlmQlNyYXpnaW9IZFBQVVc5R3R1eHloSjVGM3E0WUhZeU9XU0ZJYWgzeDVKMzc3emttTXNrcGZOdjdSWVVodjgKUnpkUyt5RUNnWUVBMjdUUTVVdWNnUW9aSzdpdUlqUXJRUTBWUEs4S3VhR2JNbERZa3IrdlUzZ2d6YW1KNG1JNwpFUVJiMXRhUGpxQkhrc0RsRXFEdnNuaXB1UXhjV0U2QytkSFpoL2F2cmR0cjljYlZEd25zZXdKeDA2U0ZvaTJIClUvekI5WUFZcVhGczNlUElDRU1RUzNhZGtZb0RrYjNkTE51bVlST25wRUFUTTNVUDJlZURiZEVDZ1lFQTZMcnQKT0JRbld5bmFIeWQ5dHRjSytidUJYMXU2ZGZBWk9FcG4weFRiZmJycjQ0cnliQzdWbk1CRFZSaTVQT3hmU2MrbgpJL0FwNzE1dVFJTUhZK0dDWlQ3TGFLT0MrNi8zRVlpb1FMTWF2QUt6OHNqeWl5UDJreEJzSWNzM0t4YUZiQVo3Cm9PeXZqakpzc2xzQm13UzQ2RCt4cE1nbFc3Z09INjVoNXJxNFV0TUNnWUFaYUdpOEM2bDJ0czlBWWlRcEtuVlMKR1l3NkwxZ0RMYkEvK2wrQllRK0tqSnJtamRPM1RYcmROZTdWQW8wcGhsbWduQlFodW1EZDk5eFEzU0FVeWtlVgpVbkpncWVPWkxJWG9yMnpXUjJTRXVUeW1xQ0VZSjBHK01iM1FnVmJZeVpnNGRPNGVIbnRVN3N1OEdBVGZwdUJjCkhxNjREVWpXMHQ0bGxrVVdBeE1NOFFLQmdRQ3krZzQwY2t0UjhIMnVOOUNXTEFwa3c2NWFoMUIrSW9kQ292WDEKZnJUTm5GS01TdTdrQTZDRFM5aDhPT2M3MHd2MDE1elNKb0FaZGFXVU56QVh2L1ZucDBNRzFiaUZsbTJMTG0wMgpWSWJhejdsVG5QWHB5MTUwK3N3dHNQcGNTSldTM2VsMWVKQUo2djFzckZBdnh4SHNpZzh6aWpnd3NQc3JvZy9vClFQQS93UUtCZ1FERyt1S3dBSU5GUGM5WjZUM1U3TTh2MmIrdzN2d3Nyc2U1aXhLMHllUW9tZ2EwRUhLdjRhdDkKWEt2ZmVGdnJ1cC9SWEZZazgveGY2UG9hOEVzZzhKME9POUhVVW1kQmp5WGY2Wm5nS3ZIUVhVVUQ3S3U3ZWhtdApBZ1Z0c3AvK2NkL3BzdlFoM2ZNMkdTKzUwV0w2bjNyN2g1RzVvVUtYdDZQMXh0MjBXSEY1UlE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFVENDQWZtZ0F3SUJBZ0lRY0tNT1N3TnJnWU5xd1JDNkNpT3RZekFOQmdrcWhraUc5dzBCQVFzRkFEQVQKTVJFd0R3WURWUVFERXdoMllYVnNkQzFqWVRBZUZ3MHlOREExTVRVd09URXhNalphRncweU5UQTFNVFV3T1RFeApNalphTUJNeEVUQVBCZ05WQkFNVENIWmhkV3gwTFdOaE1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBCk1JSUJDZ0tDQVFFQTJHcGNia3RUZG9RME5hV0RmRlJPSStYT00wcE1lbjdCMjUxL2dzVk1Tb3VTZzFuSW1OQzcKdFdKMzkyNEFma3hxMFpXL2dRZEw5Tmk1TjdKNkN1VTdsWEtpVHA1Y2pXbGNBL0ZLcUx6Rm0xelFRNWlBNlU3QQpFaTJXVEtHaWVCSVlOODJMK0hVbUJSQ3dvYngxRVJYeGo0cG11N1JZY005Um9BalRhNlY0QzhPak9hRGQvQ25OCldVY3Z5aEtPeXdkS0lmYzlFd2o2dkV6OVAyNDJyMzhJeXVNREhNRXRmeFdBMFNUVjZic1JVbGFDZjIwdG94TEsKUmlTZU5RbHRuUThIQWpqN3FieUFyMjRXaitrYmZGdDNPZ3JkWGN5UzZpYUFhNVhFZVRSbUY0OUlueXFHeEtFUQo5T1lhNmVLZUFmcnNzalJqM1dFNGZVY04yTjVkOU13RFR3SURBUUFCbzJFd1h6QU9CZ05WSFE4QkFmOEVCQU1DCkFxUXdIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUhBd0VHQ0NzR0FRVUZCd01DTUE4R0ExVWRFd0VCL3dRRk1BTUIKQWY4d0hRWURWUjBPQkJZRUZBaUkySzEyUEpHRnlSYXJsbU1uZktJY1paNytNQTBHQ1NxR1NJYjNEUUVCQ3dVQQpBNElCQVFDMTlySEo1TGlrOHoyQTVqSkthZTlqS0xRK1Nmd016VFhCNlI3S2NjUXQrbGdlakx6N0xqeFZQMHdkClhRSENxWWYvQmhHYWVZVEtXVitxYk01cSt2eDlveCt1eklxZDJETm1aMWRncy83WlVpMzdZRVJteFdMOVpmUXMKdkpSTkl4WGdsMzAvQnFaR3F1cnBLRU0xY3RaRHEyM2hQTHZJYjF4VnR1dVhkSnZFa0hEcWtCeDhsQTlvV0w3UQpWWWpjcXZTM2IyMmZOMFlMVXdTTEpjdWJWYWRXdElydTB2M3VvUWEwM2dwMDdyYlJUNnFjWUhrb0IxU0RrSXltCjJUNGVqVCtxaXZ5ZzNpMWRXODgvUlBMSXp4ZVpvd3lRem9oN2Y1UTg5emJXVXI5L3RmTXQvTGh5aFFPZzREbksKWnFJaGhkV1p6b0F0YmprQm81aWxtZUJZODIwcwotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  ca.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcFFJQkFBS0NBUUVBMkdwY2JrdFRkb1EwTmFXRGZGUk9JK1hPTTBwTWVuN0IyNTEvZ3NWTVNvdVNnMW5JCm1OQzd0V0ozOTI0QWZreHEwWlcvZ1FkTDlOaTVON0o2Q3VVN2xYS2lUcDVjaldsY0EvRktxTHpGbTF6UVE1aUEKNlU3QUVpMldUS0dpZUJJWU44MkwrSFVtQlJDd29ieDFFUlh4ajRwbXU3UlljTTlSb0FqVGE2VjRDOE9qT2FEZAovQ25OV1VjdnloS095d2RLSWZjOUV3ajZ2RXo5UDI0MnIzOEl5dU1ESE1FdGZ4V0EwU1RWNmJzUlVsYUNmMjB0Cm94TEtSaVNlTlFsdG5ROEhBamo3cWJ5QXIyNFdqK2tiZkZ0M09ncmRYY3lTNmlhQWE1WEVlVFJtRjQ5SW55cUcKeEtFUTlPWWE2ZUtlQWZyc3NqUmozV0U0ZlVjTjJONWQ5TXdEVHdJREFRQUJBb0lCQVFDWGNRNlBiQXpTNGI2NwpUOENNTDE2akJqeGViZjdJdFkwcEJyVGxLUFd6TUtwdFdsWGlnaWJvemloUE1GNE9BNkc0V2tjeG5vNkxuMkUxClZhTExueEFzQzVVQzJSVEJMRnBrcytSZjRnR1NMOGZabFkyWU5qQjRTQWhtUmJHd3ZsRE9NL3RmK1hLS2x0eFQKd2RKV0Mzb0h6WDBJbXpKTWR2ZVN1cnBnR09IQnNITHppQmNiUHpheTByOE0ydjcveTNMNVVGTDRnUW9OQ0ozcwpDaFpTMUhuVUU0MElpZk5KV3MyVndzZjNTamk1Ri94QSs2OFU0VDBCcHUvRlY2UFhzV25QL21SUnJaMXNpVXR4CjNjNWR4MG5lTTNhWlpiTGVKdll6UE9oeGoxUndwd1l0aVlWcThBelMybWZXQXk5Y0pwSi9LbTBHckVWY0FGdFQKRkVNUlhkUEJBb0dCQVBaT2JpU0Jjbm5oRUN4UDBXVzZGdlRibStHQ0tiK3dHckMvTzA3OEEveEhBVWFKMlNabwpVaVkxdDRSVEdRS253OVY5TndXbVJoRTRaVStHU1BUVlRyMmVZQUdPdW85NndCV1Y0YWFYTWpIUHF4UXhja3QzCjZIeHJzZEpsQjIzL3Z2QTlTYjJzRGF1M283UHJLUDRUa3RneVloOVlRbzNwVUYrMCtic01wNnZ2QW9HQkFPRHUKeHFtNElPREV5WmF6b2UwNk5kSDRBVXR6amdrLzNFdS94ZTM1ejNyV0h0cXdUcXFkU1FkSktXdDBsTTRyVENaYQpLRnRmZnFoMWNpMWxKT2pDdUdFdkpzdUtFeCtRYkQ4NHV6V3A0eEUyOTRaVytGK1lYbXhabHB6Nk1UdmNFUEtaCjNqaytQRWhrUVNveXZTVWJWazhGK2Qyclptc1RIU2xMbWMxV216NmhBb0dCQUtyUFgxRFB1SnpQT05FU0ZXeFAKcmlYbXVtYWNSdW1aYmhrT3RVbWtPZnRWSG94VmdwTkJHMTlHTjF0NzZVZFBJdDlGODhkbU5RY3lMZ2dGWDBqegpPS1VGVlIwZlp6K2paOXhRVWVtZXh2K0dQZVZHR1RZL0ZLcGNZVGhBT2ZQTnZST0wzVHk5T2NuUkU2VHRPME5nClBhRFM1L3RHMFBqclNZTGwxWjRqTzVCZkFvR0JBSjZZbldqVGxCTUhqZC85WG1JSEZpV3JDVGFyRG00RklnNGkKOUtzYjVhZ0Z5NUdFbUtNQjdaaitnLzdwSDNiUzNvbDRMbFptMmNacnNRckM4eWhQQzNReXE5Yjl6d2dGYTkyVAo0YVF2MmhPc1B4RHd4NFdYeUpQN0F4QkI5Rzd4ZHQybmtpR29lUmJONFlpZ1orNysvSGNSanFFMmxpdFBPZE9CCkk3dTlvZzZoQW9HQVZPL1hyUzZoYjlLVjJQRlZXcTR5WU5tTEVocnp0MEg4UjhaK3RvUnhrZFhWOXJHdjcxL1YKOHBUMFdSdGgvQlNFa2ZKMzhXem00d3pLMWFPV3BoRWlFY2c0WGV6MkVFbHgzd1doeE1sMVYrbDZPYlN0ejJ6LwpGcWdyWmZCS0xpYkRDV0xiVE9kUXNoNjZlTXViZmxJY2ZURnBkSDJTU1pNYWNyUFExbWltZ25NPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
---
# Source: passbolt/templates/secret-tls-internal.yaml
apiVersion: v1
kind: Secret
metadata:
  name: release-name-passbolt-sec-tls-internal
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: tls-internal
    app.kubernetes.io/type: sec
type: Opaque
data:
  server.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUROekNDQWgrZ0F3SUJBZ0lRWFZ2ektIL1NGOEVLUlBVK3dFVkpvekFOQmdrcWhraUc5dzBCQVFzRkFEQVQKTVJFd0R3WURWUVFERXdoMllYVnNkQzFqWVRBZUZ3MHlOREExTVRVd09URXhNalphRncweU5UQTFNVFV3T1RFeApNalphTURveE9EQTJCZ05WQkFNVEwzSmxiR1ZoYzJVdGJtRnRaUzF3WVhOelltOXNkQzFrWldaaGRXeDBMWE4yCll5NWpiSFZ6ZEdWeUxteHZZMkZzTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUEKMlZQeWdjZEtNOTAybDkwVDdLOEhDS2ZUSDJqN3FLZVEwSHo5Tk8vcDZISHg4cGQzMjIxYVlFMm42eHh3UUJRZgpwMk9raWNpYURINmhwR2g5bU9zVGNqVFZVY0kyTkx4MzZ0NWU0ajU1bG1QUEl3dVlONzB4eTYwbVRmQ1Vvc3JwCnNnNTBlTmluQ0l4WktsRCtSb3l0T05PRjVqcklUZEYvRGlFMU5zUmRhZDAxM2FCRzJnWTFZRkdPLzl5aXlHcGsKUHEzYU5DMkQ2bWhkUTlhSWhZMXhLajVla3dvS3ZmRkJuc1JOUEoxOE03VFBGTEdwTnVWcU93WlRWQkxJMVVaNAovN0RQbUpOeXBFMklxdW44OVZOaDdDc1JZdTNOVm5IdnpzTXgvangyS1plZkErTzhHT1RUTkRzUkJtMHJCU3VJCjlYOGJ5RHB3QjZiZWtNdi9hZG93SVFJREFRQUJvMkF3WGpBT0JnTlZIUThCQWY4RUJBTUNCYUF3SFFZRFZSMGwKQkJZd0ZBWUlLd1lCQlFVSEF3RUdDQ3NHQVFVRkJ3TUNNQXdHQTFVZEV3RUIvd1FDTUFBd0h3WURWUjBqQkJndwpGb0FVL3J2NW0wTWNuMHpoMU04eVJEOUhlZTNhWXRzd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFMTkt0ZWJsCkdRSHlyRFk5S0hOR08rbWV4VTlHRHgxcVBBOGI5MkNlUGhyY0h6U0VRZzA4R0FzU1hMcnNxMWN6MjQ2TUFtK1UKeUxTOHV2RkRNZit1alJaRk5RZXBOWWFldlpxVzltQzN6b2pOeHRvWTBrVEpTQml0d2paSVhpZ1hGaUFVWGhuZAowcHIyeXRsbmRVdGxENTUzVnJDaHhxcUQ3Z0lQdDNFL1ExNGxyTHNrY2JPZUh0TkNIdXc5ZkZFV0RmNDlwT2dECmRJZ1p5dmZscnF3MnA2VXBzMGJqZ0pYMTNqUzl2cFIyanRUM3g3Qm5ramg3S3hkU0Yvb0pxR3J2Ui80SlAxc1YKVFY2OFFWdHBCRldhUEQ4OFBjNzBJUVdRQ3QxSXR0RHFFcmhtcTZqSlRkU3AyWEVBelNpaUd2QzUrNlhnb05kdgpadDlucmNFRjFMem9kTGc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  server-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBMlZQeWdjZEtNOTAybDkwVDdLOEhDS2ZUSDJqN3FLZVEwSHo5Tk8vcDZISHg4cGQzCjIyMWFZRTJuNnh4d1FCUWZwMk9raWNpYURINmhwR2g5bU9zVGNqVFZVY0kyTkx4MzZ0NWU0ajU1bG1QUEl3dVkKTjcweHk2MG1UZkNVb3NycHNnNTBlTmluQ0l4WktsRCtSb3l0T05PRjVqcklUZEYvRGlFMU5zUmRhZDAxM2FCRwoyZ1kxWUZHTy85eWl5R3BrUHEzYU5DMkQ2bWhkUTlhSWhZMXhLajVla3dvS3ZmRkJuc1JOUEoxOE03VFBGTEdwCk51VnFPd1pUVkJMSTFVWjQvN0RQbUpOeXBFMklxdW44OVZOaDdDc1JZdTNOVm5IdnpzTXgvangyS1plZkErTzgKR09UVE5Ec1JCbTByQlN1STlYOGJ5RHB3QjZiZWtNdi9hZG93SVFJREFRQUJBb0lCQUdsT2NCZktoWDRVRnJ3SApkL3diNDRDaU1YN3EwK2FwSzFhYStlYUl5Z0xFRThURStHTHUzZmdFS1BXWDFoeDJvOC9zVEhJbkxkNFlEaU1vCkxwUEdkS25HU0FkUjRBbzF1TFdxQXJnR0pjeGxtSjBXcFM5OUVYL3I2citoYjZSaVJsTHRCaXI0Y0JlSVNqeGkKK3BNYzMyTEZ2QUFQUTdmUlo0dGxNKy9SdnFIb2xWS2pFQ1NpNURXdTBIYy9ieXNsNjRHNGtSOGlqNHgycTY4dQprVDllSEhxMzBKNUpaOXF5RkJ3QnRCUHNHZENNOUsxUUdTbGFJM2kwNVRybHcrSnJTQjdBdE1HVUowdjRaN2dyCnI0a3pQNW0wVW1kd2NmamliQlZEK2UyZCtwOEQxTDQ3WWVNNVE4YnphaVBFMENDQ2wzSWR2MUNwTUtQbWwwMlgKNTQ4c0R2RUNnWUVBL2pZUjNiamdCMlo3eElUMUkzVVJ2Qy9WU3dPQlhJdyt5eFZRclVLLzcwT3MrU3RyM0p1TQozSEpMNnkvdm84cXpWd2k4UG1kaGdFRGVyQmQrWVd6TTkvTWZtNDR1dFQ4VXpXZEVqVnFhRzhCTCtHNnMwWWVjCm5KdU9Ia1M4a3BLdlZiTFM1K1lHeUlSUStYb0pOYjhPSFJCVlM3TGtEUmRBYThtV2w1bW15WHNDZ1lFQTJ0dHYKMGJTTmhWTkxCUVdnZVBQTEF0MkNWOXZOeS8ycU10a1YzUFJTVEJOYTUrdExNYjY4b1NxZUhDamNURE1xUUFSdwphbEN5cWZJNExnYXNOaElIdUYzYU5qOUUrSGdGK3A5c08vQjVyY1VLUGRobkZqMGtySjdQczloRFRBN2YzMGFOCmRVOXhxK0h2TFpRejBOdU5lZXFhYjZZVnlabmtCU3hHQ1B4UTlCTUNnWUJwbTFqTXZiTUVJQVVtM1AxaDM0NmcKbVZhSXRVb1dnb1RMcFcxQXJVeERQK0FxRzJuUjJpVW9wNnIyWjVHc2Y5Y0ZQekhFMHZua2FBNlplNkViSkRINgpoOXdIcVllcDhDemFNQjZBZ3JVbTlqb1pXUkVlY3JJVE5XUlRHc2NrTlIvMkFEWXg5Sk80MVk4Mk5RYUNkMzZMCmdHK081U0JzZDg1aGVQdkF1eXBZNVFLQmdRRFNSS1BCRWJ3cVRTVTFkUHVCV1pGQmRucEZXU3YzQWdha2hjY28KbXgvNmNWb1VtZzZMZzVxTktYbnd5aDBscEw3QjlNSGdreG1raDlBTUFHTXlLODU1QnNxZzlkYVk5ZytnZzh5awpKZDF4NDI1OGpzNDBJcGg2dExZUEx3Y3hLdFZTR2VITXhJQU15S3hYMlJ5VFhHMG5wZ3VzbXlBeHFnWFdKbncvCkk5UFBPd0tCZ0NFd05yQVkzeHNIM1lVUitpd1dNcUpWeXV1VHptRTZtYmFOZ3lseHQ5N2hnTEhrYURLTGd2V24KV0JQVG9YWndJNW1HYUhJdndGV1dFVmpwUGxVWHJHcmRIOEE4ZUFoRnREeXVMYlNSR0lDTGUwbDhFcjFsM0hySgpTMkFrNWRlS0QxOFF4Ym1GUjVLUjdhZlRrNHRvUU5EcGRFMzBSajd3NEpldUo4bHI0cTFUCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFakNDQWZxZ0F3SUJBZ0lSQUpvWUo4SlVHN0laOStNVDJienBVUEl3RFFZSktvWklodmNOQVFFTEJRQXcKRXpFUk1BOEdBMVVFQXhNSWRtRjFiSFF0WTJFd0hoY05NalF3TlRFMU1Ea3hNVEkyV2hjTk1qVXdOVEUxTURreApNVEkyV2pBVE1SRXdEd1lEVlFRREV3aDJZWFZzZEMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQCkFEQ0NBUW9DZ2dFQkFMVm5CYjQwSktvUStVM2E5MnltVEhsUDhBL3hEaTBlOFhwS2ZSMmlvYWM1R25QMkxzS28KSVM5dTFuR2NIZGFZNFV4dVh5aCtrdEZzdmdmVXVHbkdOT3AyTHRSM1dIeWpNWG9COVl4a1E2bS9zS0tleDBFawo2bUJOMmozNVgzTW51d2hoVkhjaTNMN0hUdHhxNWZncXYxc1I3TXRvK2ZOOW9pZHZHOE4rMkZRNll1ZTRPRnZMCmh4MlA2SmdaZHlSTFpGa0pUUDZwdmREZEtZOWdTa0M4SmMwYzFiYzduUGJBVlZUWjRTZ0VCQkxzSURjWnRBOVQKRzhNdGJkVkltZ3hSbDBSREI5TEQweWlzNzB0cFJZU1NUQ0tmR3plR2NZczYwQ3lYbUVnN04wMkRoajVITkl4YwpQODJwenI4S3RXeFhKeVVVU2hYaHJqRUhFb3JweE9TU2JSRUNBd0VBQWFOaE1GOHdEZ1lEVlIwUEFRSC9CQVFECkFnS2tNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUZCUWNEQWpBUEJnTlZIUk1CQWY4RUJUQUQKQVFIL01CMEdBMVVkRGdRV0JCVCt1L21iUXh5ZlRPSFV6ekpFUDBkNTdkcGkyekFOQmdrcWhraUc5dzBCQVFzRgpBQU9DQVFFQXJtbmhEZVB0V0xPdEMrYUpESURQTjYzVlBodVFLZlM1MGoxL2x1ZVlsM3hSV2l0VXVSVW5lMHBUClY1VThOL2xHWjJMZFEwcEhTQXl4U1RZZjc4dWNDUEZlM3J0N3YyRUVodFp1a043VlRDRmhkOUNLNTNuTWx4WnQKcmlaYnJ6NVliN0RieHhYaFFORVBBSXZoS2FQL2lPVEU3Rk1vaHhxbDlFeTZrYU5KRWhTZ01TbHpkakRrQWdHMgpqbVBNeDlqZUtkakJTeldMSGt4aFUvTXFkYU9Jelp5T1pOUUp0dUtJNUNYRWI3Rm9jSlFTUjNJYzBmYmZ0ZWNxCm1KT0gyWWwxbGxCZVhZOGRrWXlNaVdRNUlyTkZ4bExBdWtnSURneTdRTHRqaTBnL3NKYTNTajIzWXVnd0N0VDIKOWFYSnFIRmtJMzl2clZ5ZDZxRDdrZjhsWVNsZEJRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  ca.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBdFdjRnZqUWtxaEQ1VGRyM2JLWk1lVS93RC9FT0xSN3hla3A5SGFLaHB6a2FjL1l1CndxZ2hMMjdXY1p3ZDFwamhURzVmS0g2UzBXeStCOVM0YWNZMDZuWXUxSGRZZktNeGVnSDFqR1JEcWIrd29wN0gKUVNUcVlFM2FQZmxmY3llN0NHRlVkeUxjdnNkTzNHcmwrQ3EvV3hIc3kyajU4MzJpSjI4YnczN1lWRHBpNTdnNApXOHVISFkvb21CbDNKRXRrV1FsTS9xbTkwTjBwajJCS1FMd2x6UnpWdHp1YzlzQlZWTm5oS0FRRUV1d2dOeG0wCkQxTWJ3eTF0MVVpYURGR1hSRU1IMHNQVEtLenZTMmxGaEpKTUlwOGJONFp4aXpyUUxKZVlTRHMzVFlPR1BrYzAKakZ3L3phbk92d3ExYkZjbkpSUktGZUd1TVFjU2l1bkU1Skp0RVFJREFRQUJBb0lCQVFDRG1nYi9reUthUXBBcQozRlV0L0lOMGF2clZCZU5yOW92blZVenBpQWZRb2t1L252VVRnUmY2S21YbXJBUzFuOW1yTWxOVXRHYmRDZy9lCjdJTVJNWnRJRVk4dDBwdGVhS0pIU2s2U21GYkNPbS94dWxFQndMOU1PSTdBOFQ0Kzg2N3JpSGpYcVhJTjhkZ1QKYm5ZQ0VUa2IzNmd6ZGFnSDdyZ0o5Y0JsbG90b3BtNUVUcEtTM2t6OFR1cmNwZU50TVhTcFBxZjdtVlBCMXRsMgovb2tCY0ZhRHdvVkFoN1IyOUIwRVRrM0R2aitlUDRqM2ZXRXhMVjBlYTJFNVNsc2M5WUdoTWZoam5Jd2RwY0t4Cm03U1F0RlB5bzlhYjNlL2xrbDFuK0lEMnhPSE4veE9lVFpaM25yUkxqbE51SUV6SUU4blFxanJieXY5bTc0YjcKcEs3eGZ4UkJBb0dCQU53M2E2eUFGekJVQVdCdDFSczZCV0wwTHBTTU1DTmF6eWxQcUswK1BTYmRLdWYxenFVcwp2b21LNWkvR1FDVGpLLzh5djBSbXYwcFo3c0h2NUpvVWdjOTFkN0JuRXRVcE8zcVhad2dJQlJVOXlISll0N1JnCmpITnJYSXo1STUwamxYVXNrVUZNd0wwYzQrdEdTTFhHQlU0dExaaUc0L2d1VkI2K0VuUHJNaGlKQW9HQkFOTGgKQXlXdWx1ZEhjYVRSVkUxQXg0aGUrOVBwVnJpeTZwZDVxSkhERGpocyt4SkM1MlhYbFZLWVhERkNyN3Q1aFY0LwplaW1nV051SGpsOTB0Vyt6N0JFYlcxcXFFSFZsTG51emEzSExJeG5nc0RWZ2krWUt5YjN5UVg2NHRSNXluVDV5ClZtd0FyMHhzNTYrME0rWndJanFOWXlKbmRGS0FsMmdGVzNUWUJuNUpBb0dBZGZNQkt1MllmZndnbUtON1J3LzIKbnArbTYwMkM0d3phZElnRUVuYUpqbTFiYzg1R2xsVzI0RGlUUGZkemw4NU5YR3l6NFZFZkdCVy9PZ1RoYmwyWgpnYUtyTHNLbVphR21CKzFiOUFOSHBhN24wOGNNN2dIZ2VGbUN3c2NXZWkzNitUMmJ0MXdDeDhmWGs4YWJYekRtCjJvNThJM3ZzVXB1TjFzRjdaTGNPcC9FQ2dZQkpjMXh3UkphRktpcFlPUjArNTBCWXJKVFVZK0x6NUVXM3l3VSsKK0F5ODlLQ2k1TERLbFVPS2lFMGNUMWo4V01CdWFuZTNoZ1ZOT2JNS1pwRkh2Z2lNa05YS0I1QkNBNk1rTFFOUQptR3U2ZUx1SGJBQnVlUFY1OXFaL2FBQ1dBVi9wdjFPQXZPQlNJMkN6bjNXd1h3QmRHcUFiL0tMVWxidW0zSzdWClRPVStHUUtCZ1FDVTZmMGtDWGlPanFvWlhvOTBoQnpOU2RST25MVUF1RXorMkNibFo0SEgxeEgvVmFtVVVDMkQKMlBzR2xNVFRsMnViTHFDVEphN0ZTQnNWa29lMTduaEprcUgwTVhLUURDcXNTVTZSWEloSGFBb3pHZFR1S2lmRgp4TG42WnErMkJXTmU3K3VrQmJPcnVpdi8rYUlWamg1M0Q5ZjJWd1ppTHMzeGwranlPK2tkcVE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
---
# Source: passbolt/charts/mariadb/templates/primary/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-mariadb-primary
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: primary
data:
  my.cnf: |-
    [mysqld]
    skip-name-resolve
    explicit_defaults_for_timestamp
    basedir=/opt/bitnami/mariadb
    plugin_dir=/opt/bitnami/mariadb/plugin
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    tmpdir=/opt/bitnami/mariadb/tmp
    max_allowed_packet=16M
    bind-address=*
    pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
    log-error=/opt/bitnami/mariadb/logs/mysqld.log
    character-set-server=UTF8
    collation-server=utf8_general_ci
    slow_query_log=0
    slow_query_log_file=/opt/bitnami/mariadb/logs/mysqld.log
    long_query_time=10.0
    
    [client]
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    default-character-set=UTF8
    plugin_dir=/opt/bitnami/mariadb/plugin
    
    [manager]
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
---
# Source: passbolt/charts/mariadb/templates/secondary/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-mariadb-secondary
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: secondary
data:
  my.cnf: |-
    [mysqld]
    skip-name-resolve
    explicit_defaults_for_timestamp
    basedir=/opt/bitnami/mariadb
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    tmpdir=/opt/bitnami/mariadb/tmp
    max_allowed_packet=16M
    bind-address=0.0.0.0
    pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
    log-error=/opt/bitnami/mariadb/logs/mysqld.log
    character-set-server=UTF8
    collation-server=utf8_general_ci
    slow_query_log=0
    slow_query_log_file=/opt/bitnami/mariadb/logs/mysqld.log
    long_query_time=10.0
    
    [client]
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    default-character-set=UTF8
    
    [manager]
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
---
# Source: passbolt/charts/redis/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-redis-configuration
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
data:
  redis.conf: |-
    # User-supplied common configuration:
    # Enable AOF https://redis.io/topics/persistence#append-only-file
    appendonly yes
    # Disable RDB persistence, AOF persistence already enabled.
    save ""
    # End of common configuration
  master.conf: |-
    dir /data
    # User-supplied master configuration:
    rename-command FLUSHDB ""
    rename-command FLUSHALL ""
    # End of master configuration
  replica.conf: |-
    dir /data
    # User-supplied replica configuration:
    rename-command FLUSHDB ""
    rename-command FLUSHALL ""
    # End of replica configuration
  sentinel.conf: |-
    dir "/tmp"
    port 26379
    sentinel monitor mymaster release-name-redis-node-0.release-name-redis-headless.default.svc.cluster.local 6379 2
    sentinel down-after-milliseconds mymaster 60000
    sentinel failover-timeout mymaster 180000
    sentinel parallel-syncs mymaster 1
    # User-supplied sentinel configuration:
    # End of sentinel configuration
---
# Source: passbolt/charts/redis/templates/health-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-redis-health
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
data:
  ping_readiness_local.sh: |-
    #!/bin/bash

    [[ -f $REDIS_PASSWORD_FILE ]] && export REDIS_PASSWORD="$(< "${REDIS_PASSWORD_FILE}")"
    [[ -n "$REDIS_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_PASSWORD"
    response=$(
      timeout -s 15 $1 \
      redis-cli \
        -h localhost \
        -p $REDIS_PORT \
        ping
    )
    if [ "$?" -eq "124" ]; then
      echo "Timed out"
      exit 1
    fi
    if [ "$response" != "PONG" ]; then
      echo "$response"
      exit 1
    fi
  ping_liveness_local.sh: |-
    #!/bin/bash

    [[ -f $REDIS_PASSWORD_FILE ]] && export REDIS_PASSWORD="$(< "${REDIS_PASSWORD_FILE}")"
    [[ -n "$REDIS_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_PASSWORD"
    response=$(
      timeout -s 15 $1 \
      redis-cli \
        -h localhost \
        -p $REDIS_PORT \
        ping
    )
    if [ "$?" -eq "124" ]; then
      echo "Timed out"
      exit 1
    fi
    responseFirstWord=$(echo $response | head -n1 | awk '{print $1;}')
    if [ "$response" != "PONG" ] && [ "$responseFirstWord" != "LOADING" ] && [ "$responseFirstWord" != "MASTERDOWN" ]; then
      echo "$response"
      exit 1
    fi
  ping_sentinel.sh: |-
    #!/bin/bash
    [[ -f $REDIS_PASSWORD_FILE ]] && export REDIS_PASSWORD="$(< "${REDIS_PASSWORD_FILE}")"
    [[ -n "$REDIS_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_PASSWORD"
    response=$(
      timeout -s 15 $1 \
      redis-cli \
        -h localhost \
        -p $REDIS_SENTINEL_PORT \
        ping
    )
    if [ "$?" -eq "124" ]; then
      echo "Timed out"
      exit 1
    fi
    if [ "$response" != "PONG" ]; then
      echo "$response"
      exit 1
    fi
  parse_sentinels.awk: |-
    /ip/ {FOUND_IP=1}
    /port/ {FOUND_PORT=1}
    /runid/ {FOUND_RUNID=1}
    !/ip|port|runid/ {
      if (FOUND_IP==1) {
        IP=$1; FOUND_IP=0;
      }
      else if (FOUND_PORT==1) {
        PORT=$1;
        FOUND_PORT=0;
      } else if (FOUND_RUNID==1) {
        printf "\nsentinel known-sentinel mymaster %s %s %s", IP, PORT, $0; FOUND_RUNID=0;
      }
    }
  ping_readiness_master.sh: |-
    #!/bin/bash

    [[ -f $REDIS_MASTER_PASSWORD_FILE ]] && export REDIS_MASTER_PASSWORD="$(< "${REDIS_MASTER_PASSWORD_FILE}")"
    [[ -n "$REDIS_MASTER_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_MASTER_PASSWORD"
    response=$(
      timeout -s 15 $1 \
      redis-cli \
        -h $REDIS_MASTER_HOST \
        -p $REDIS_MASTER_PORT_NUMBER \
        ping
    )
    if [ "$?" -eq "124" ]; then
      echo "Timed out"
      exit 1
    fi
    if [ "$response" != "PONG" ]; then
      echo "$response"
      exit 1
    fi
  ping_liveness_master.sh: |-
    #!/bin/bash

    [[ -f $REDIS_MASTER_PASSWORD_FILE ]] && export REDIS_MASTER_PASSWORD="$(< "${REDIS_MASTER_PASSWORD_FILE}")"
    [[ -n "$REDIS_MASTER_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_MASTER_PASSWORD"
    response=$(
      timeout -s 15 $1 \
      redis-cli \
        -h $REDIS_MASTER_HOST \
        -p $REDIS_MASTER_PORT_NUMBER \
        ping
    )
    if [ "$?" -eq "124" ]; then
      echo "Timed out"
      exit 1
    fi
    responseFirstWord=$(echo $response | head -n1 | awk '{print $1;}')
    if [ "$response" != "PONG" ] && [ "$responseFirstWord" != "LOADING" ]; then
      echo "$response"
      exit 1
    fi
  ping_readiness_local_and_master.sh: |-
    script_dir="$(dirname "$0")"
    exit_status=0
    "$script_dir/ping_readiness_local.sh" $1 || exit_status=$?
    "$script_dir/ping_readiness_master.sh" $1 || exit_status=$?
    exit $exit_status
  ping_liveness_local_and_master.sh: |-
    script_dir="$(dirname "$0")"
    exit_status=0
    "$script_dir/ping_liveness_local.sh" $1 || exit_status=$?
    "$script_dir/ping_liveness_master.sh" $1 || exit_status=$?
    exit $exit_status
---
# Source: passbolt/charts/redis/templates/scripts-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-redis-scripts
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
data:
  start-node.sh: |
    #!/bin/bash

    . /opt/bitnami/scripts/libos.sh
    . /opt/bitnami/scripts/liblog.sh
    . /opt/bitnami/scripts/libvalidations.sh

    get_port() {
        hostname="$1"
        type="$2"

        port_var=$(echo "${hostname^^}_SERVICE_PORT_$type" | sed "s/-/_/g")
        port=${!port_var}

        if [ -z "$port" ]; then
            case $type in
                "SENTINEL")
                    echo 26379
                    ;;
                "REDIS")
                    echo 6379
                    ;;
            esac
        else
            echo $port
        fi
    }

    get_full_hostname() {
        hostname="$1"
        full_hostname="${hostname}.${HEADLESS_SERVICE}"
        echo "${full_hostname}"
    }

    REDISPORT=$(get_port "$HOSTNAME" "REDIS")

    HEADLESS_SERVICE="release-name-redis-headless.default.svc.cluster.local"

    if [ -n "$REDIS_EXTERNAL_MASTER_HOST" ]; then
        REDIS_SERVICE="$REDIS_EXTERNAL_MASTER_HOST"
    else
        REDIS_SERVICE="release-name-redis.default.svc.cluster.local"
    fi

    SENTINEL_SERVICE_PORT=$(get_port "release-name-redis" "SENTINEL")
    validate_quorum() {
        if is_boolean_yes "$REDIS_TLS_ENABLED"; then
            quorum_info_command="REDISCLI_AUTH="\$REDIS_PASSWORD" redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT --tls --cert ${REDIS_TLS_CERT_FILE} --key ${REDIS_TLS_KEY_FILE} --cacert ${REDIS_TLS_CA_FILE} sentinel master mymaster"
        else
            quorum_info_command="REDISCLI_AUTH="\$REDIS_PASSWORD" redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT sentinel master mymaster"
        fi
        info "about to run the command: $quorum_info_command"
        eval $quorum_info_command | grep -Fq "s_down"
    }

    trigger_manual_failover() {
        if is_boolean_yes "$REDIS_TLS_ENABLED"; then
            failover_command="REDISCLI_AUTH="\$REDIS_PASSWORD" redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT --tls --cert ${REDIS_TLS_CERT_FILE} --key ${REDIS_TLS_KEY_FILE} --cacert ${REDIS_TLS_CA_FILE} sentinel failover mymaster"
        else
            failover_command="REDISCLI_AUTH="\$REDIS_PASSWORD" redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT sentinel failover mymaster"
        fi

        info "about to run the command: $failover_command"
        eval $failover_command
    }

    get_sentinel_master_info() {
        if is_boolean_yes "$REDIS_TLS_ENABLED"; then
            sentinel_info_command="REDISCLI_AUTH="\$REDIS_PASSWORD" timeout 99 redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT --tls --cert ${REDIS_TLS_CERT_FILE} --key ${REDIS_TLS_KEY_FILE} --cacert ${REDIS_TLS_CA_FILE} sentinel get-master-addr-by-name mymaster"
        else
            sentinel_info_command="REDISCLI_AUTH="\$REDIS_PASSWORD" timeout 99 redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT sentinel get-master-addr-by-name mymaster"
        fi

        info "about to run the command: $sentinel_info_command"
        retry_while "eval $sentinel_info_command" 2 1
    }

    [[ -f $REDIS_PASSWORD_FILE ]] && export REDIS_PASSWORD="$(< "${REDIS_PASSWORD_FILE}")"
    [[ -f $REDIS_MASTER_PASSWORD_FILE ]] && export REDIS_MASTER_PASSWORD="$(< "${REDIS_MASTER_PASSWORD_FILE}")"

    # check if there is a master
    master_in_persisted_conf="$(get_full_hostname "$HOSTNAME")"
    master_port_in_persisted_conf="$REDIS_MASTER_PORT_NUMBER"
    master_in_sentinel="$(get_sentinel_master_info)"
    redisRetVal=$?

    if [[ $redisRetVal -ne 0 ]]; then
        if [[ "$master_in_persisted_conf" == "$(get_full_hostname "$HOSTNAME")" ]]; then
            # Case 1: No active sentinel and in previous sentinel.conf we were the master --> MASTER
            info "Configuring the node as master"
            export REDIS_REPLICATION_MODE="master"
        else
            # Case 2: No active sentinel and in previous sentinel.conf we were not master --> REPLICA
            info "Configuring the node as replica"
            export REDIS_REPLICATION_MODE="replica"
            REDIS_MASTER_HOST=${master_in_persisted_conf}
            REDIS_MASTER_PORT_NUMBER=${master_port_in_persisted_conf}
        fi
    else
        # Fetches current master's host and port
        REDIS_SENTINEL_INFO=($(get_sentinel_master_info))
        info "Current master: REDIS_SENTINEL_INFO=(${REDIS_SENTINEL_INFO[0]},${REDIS_SENTINEL_INFO[1]})"
        REDIS_MASTER_HOST=${REDIS_SENTINEL_INFO[0]}
        REDIS_MASTER_PORT_NUMBER=${REDIS_SENTINEL_INFO[1]}

        if [[ "$REDIS_MASTER_HOST" == "$(get_full_hostname "$HOSTNAME")" ]]; then
            # Case 3: Active sentinel and master it is this node --> MASTER
            info "Configuring the node as master"
            export REDIS_REPLICATION_MODE="master"
        else
            # Case 4: Active sentinel and master is not this node --> REPLICA
            info "Configuring the node as replica"
            export REDIS_REPLICATION_MODE="replica"
        fi
    fi

    if [[ -n "$REDIS_EXTERNAL_MASTER_HOST" ]]; then
      REDIS_MASTER_HOST="$REDIS_EXTERNAL_MASTER_HOST"
      REDIS_MASTER_PORT_NUMBER="${REDIS_EXTERNAL_MASTER_PORT}"
    fi

    if [[ -f /opt/bitnami/redis/mounted-etc/replica.conf ]];then
        cp /opt/bitnami/redis/mounted-etc/replica.conf /opt/bitnami/redis/etc/replica.conf
    fi

    if [[ -f /opt/bitnami/redis/mounted-etc/redis.conf ]];then
        cp /opt/bitnami/redis/mounted-etc/redis.conf /opt/bitnami/redis/etc/redis.conf
    fi

    echo "" >> /opt/bitnami/redis/etc/replica.conf
    echo "replica-announce-port $REDISPORT" >> /opt/bitnami/redis/etc/replica.conf
    echo "replica-announce-ip $(get_full_hostname "$HOSTNAME")" >> /opt/bitnami/redis/etc/replica.conf
    ARGS=("--port" "${REDIS_PORT}")

    if [[ "$REDIS_REPLICATION_MODE" = "slave" ]] || [[ "$REDIS_REPLICATION_MODE" = "replica" ]]; then
        ARGS+=("--replicaof" "${REDIS_MASTER_HOST}" "${REDIS_MASTER_PORT_NUMBER}")
    fi
    ARGS+=("--requirepass" "${REDIS_PASSWORD}")
    ARGS+=("--masterauth" "${REDIS_MASTER_PASSWORD}")
    ARGS+=("--include" "/opt/bitnami/redis/etc/replica.conf")
    ARGS+=("--include" "/opt/bitnami/redis/etc/redis.conf")
    exec redis-server "${ARGS[@]}"

  start-sentinel.sh: |
    #!/bin/bash

    . /opt/bitnami/scripts/libos.sh
    . /opt/bitnami/scripts/libvalidations.sh
    . /opt/bitnami/scripts/libfile.sh

    HEADLESS_SERVICE="release-name-redis-headless.default.svc.cluster.local"
    REDIS_SERVICE="release-name-redis.default.svc.cluster.local"

    get_port() {
        hostname="$1"
        type="$2"

        port_var=$(echo "${hostname^^}_SERVICE_PORT_$type" | sed "s/-/_/g")
        port=${!port_var}

        if [ -z "$port" ]; then
            case $type in
                "SENTINEL")
                    echo 26379
                    ;;
                "REDIS")
                    echo 6379
                    ;;
            esac
        else
            echo $port
        fi
    }

    get_full_hostname() {
        hostname="$1"
        full_hostname="${hostname}.${HEADLESS_SERVICE}"
        echo "${full_hostname}"
    }

    SERVPORT=$(get_port "$HOSTNAME" "SENTINEL")
    REDISPORT=$(get_port "$HOSTNAME" "REDIS")
    SENTINEL_SERVICE_PORT=$(get_port "release-name-redis" "SENTINEL")

    sentinel_conf_set() {
        local -r key="${1:?missing key}"
        local value="${2:-}"

        # Sanitize inputs
        value="${value//\\/\\\\}"
        value="${value//&/\\&}"
        value="${value//\?/\\?}"
        [[ "$value" = "" ]] && value="\"$value\""

        replace_in_file "/opt/bitnami/redis-sentinel/etc/sentinel.conf" "^#*\s*${key} .*" "${key} ${value}" false
    }
    sentinel_conf_add() {
        echo $'\n'"$@" >> "/opt/bitnami/redis-sentinel/etc/sentinel.conf"
    }
    host_id() {
        echo "$1" | openssl sha1 | awk '{print $2}'
    }
    get_sentinel_master_info() {
        if is_boolean_yes "$REDIS_SENTINEL_TLS_ENABLED"; then
            sentinel_info_command="REDISCLI_AUTH="\$REDIS_PASSWORD" timeout 99 redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT --tls --cert ${REDIS_SENTINEL_TLS_CERT_FILE} --key ${REDIS_SENTINEL_TLS_KEY_FILE} --cacert ${REDIS_SENTINEL_TLS_CA_FILE} sentinel get-master-addr-by-name mymaster"
        else
            sentinel_info_command="REDISCLI_AUTH="\$REDIS_PASSWORD" timeout 99 redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT sentinel get-master-addr-by-name mymaster"
        fi
        info "about to run the command: $sentinel_info_command"
        retry_while "eval $sentinel_info_command" 2 1
    }

    [[ -f $REDIS_PASSWORD_FILE ]] && export REDIS_PASSWORD="$(< "${REDIS_PASSWORD_FILE}")"

    master_in_persisted_conf="$(get_full_hostname "$HOSTNAME")"
    if ! get_sentinel_master_info && [[ "$master_in_persisted_conf" == "$(get_full_hostname "$HOSTNAME")" ]]; then
        # No master found, lets create a master node
        export REDIS_REPLICATION_MODE="master"

        REDIS_MASTER_HOST=$(get_full_hostname "$HOSTNAME")
        REDIS_MASTER_PORT_NUMBER="$REDISPORT"
    else
        export REDIS_REPLICATION_MODE="replica"

        # Fetches current master's host and port
        REDIS_SENTINEL_INFO=($(get_sentinel_master_info))
        info "printing REDIS_SENTINEL_INFO=(${REDIS_SENTINEL_INFO[0]},${REDIS_SENTINEL_INFO[1]})"
        REDIS_MASTER_HOST=${REDIS_SENTINEL_INFO[0]}
        REDIS_MASTER_PORT_NUMBER=${REDIS_SENTINEL_INFO[1]}
    fi

    if [[ -n "$REDIS_EXTERNAL_MASTER_HOST" ]]; then
      REDIS_MASTER_HOST="$REDIS_EXTERNAL_MASTER_HOST"
      REDIS_MASTER_PORT_NUMBER="${REDIS_EXTERNAL_MASTER_PORT}"
    fi

    cp /opt/bitnami/redis-sentinel/mounted-etc/sentinel.conf /opt/bitnami/redis-sentinel/etc/sentinel.conf
    printf "\nsentinel auth-pass %s %s" "mymaster" "$REDIS_PASSWORD" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf
    printf "\nrequirepass %s" "$REDIS_PASSWORD" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf
    printf "\nsentinel myid %s" "$(host_id "$HOSTNAME")" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf

    if [[ -z "$REDIS_MASTER_HOST" ]] || [[ -z "$REDIS_MASTER_PORT_NUMBER" ]]
    then
        # Prevent incorrect configuration to be written to sentinel.conf
        error "Redis master host is configured incorrectly (host: $REDIS_MASTER_HOST, port: $REDIS_MASTER_PORT_NUMBER)"
        exit 1
    fi

    sentinel_conf_set "sentinel monitor" "mymaster "$REDIS_MASTER_HOST" "$REDIS_MASTER_PORT_NUMBER" 2"

    add_known_sentinel() {
        hostname="$1"
        ip="$2"

        if [[ -n "$hostname" && -n "$ip" && "$hostname" != "$HOSTNAME" ]]; then
            sentinel_conf_add "sentinel known-sentinel mymaster $(get_full_hostname "$hostname") $(get_port "$hostname" "SENTINEL") $(host_id "$hostname")"
        fi
    }
    add_known_replica() {
        hostname="$1"
        ip="$2"

        if [[ -n "$ip" && "$(get_full_hostname "$hostname")" != "$REDIS_MASTER_HOST" ]]; then
            sentinel_conf_add "sentinel known-replica mymaster $(get_full_hostname "$hostname") $(get_port "$hostname" "REDIS")"
        fi
    }

    # Add available hosts on the network as known replicas & sentinels
    for node in $(seq 0 $((3-1))); do
        hostname="release-name-redis-node-$node"
        ip="$(getent hosts "$hostname.$HEADLESS_SERVICE" | awk '{ print $1 }')"
        add_known_sentinel "$hostname" "$ip"
        add_known_replica "$hostname" "$ip"
    done

    echo "" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf
    echo "sentinel announce-hostnames yes" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf
    echo "sentinel resolve-hostnames yes" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf
    echo "sentinel announce-port $SERVPORT" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf
    echo "sentinel announce-ip $(get_full_hostname "$HOSTNAME")" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf
    exec redis-server /opt/bitnami/redis-sentinel/etc/sentinel.conf --sentinel
  prestop-sentinel.sh: |
    #!/bin/bash

    . /opt/bitnami/scripts/libvalidations.sh
    . /opt/bitnami/scripts/libos.sh

    HEADLESS_SERVICE="release-name-redis-headless.default.svc.cluster.local"

    get_full_hostname() {
        hostname="$1"
        full_hostname="${hostname}.${HEADLESS_SERVICE}"
        echo "${full_hostname}"
    }

    run_sentinel_command() {
        if is_boolean_yes "$REDIS_SENTINEL_TLS_ENABLED"; then
            redis-cli -h "$REDIS_SERVICE" -p "$REDIS_SENTINEL_PORT" --tls --cert "$REDIS_SENTINEL_TLS_CERT_FILE" --key "$REDIS_SENTINEL_TLS_KEY_FILE" --cacert "$REDIS_SENTINEL_TLS_CA_FILE" sentinel "$@"
        else
            redis-cli -h "$REDIS_SERVICE" -p "$REDIS_SENTINEL_PORT" sentinel "$@"
        fi
    }
    sentinel_failover_finished() {
      REDIS_SENTINEL_INFO=($(run_sentinel_command get-master-addr-by-name "mymaster"))
      REDIS_MASTER_HOST="${REDIS_SENTINEL_INFO[0]}"
      [[ "$REDIS_MASTER_HOST" != "$(get_full_hostname $HOSTNAME)" ]]
    }

    REDIS_SERVICE="release-name-redis.default.svc.cluster.local"

    # redis-cli automatically consumes credentials from the REDISCLI_AUTH variable
    [[ -n "$REDIS_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_PASSWORD"
    [[ -f "$REDIS_PASSWORD_FILE" ]] && export REDISCLI_AUTH="$(< "${REDIS_PASSWORD_FILE}")"

    if ! sentinel_failover_finished; then
        echo "I am the master pod and you are stopping me. Starting sentinel failover"
        if retry_while "sentinel_failover_finished" "20" 1; then
            echo "Master has been successfuly failed over to a different pod."
            exit 0
        else
            echo "Master failover failed"
            exit 1
        fi
    else
        exit 0
    fi
  prestop-redis.sh: |
    #!/bin/bash

    . /opt/bitnami/scripts/libvalidations.sh
    . /opt/bitnami/scripts/libos.sh

    run_redis_command() {
        if is_boolean_yes "$REDIS_TLS_ENABLED"; then
            redis-cli -h 127.0.0.1 -p "$REDIS_TLS_PORT" --tls --cert "$REDIS_TLS_CERT_FILE" --key "$REDIS_TLS_KEY_FILE" --cacert "$REDIS_TLS_CA_FILE" "$@"
        else
            redis-cli -h 127.0.0.1 -p "$REDIS_PORT" "$@"
        fi
    }
    is_master() {
        REDIS_ROLE=$(run_redis_command role | head -1)
        [[ "$REDIS_ROLE" == "master" ]]
    }

    HEADLESS_SERVICE="release-name-redis-headless.default.svc.cluster.local"

    get_full_hostname() {
        hostname="$1"
        full_hostname="${hostname}.${HEADLESS_SERVICE}"
        echo "${full_hostname}"
    }

    run_sentinel_command() {
        if is_boolean_yes "$REDIS_SENTINEL_TLS_ENABLED"; then
            redis-cli -h "$REDIS_SERVICE" -p "$REDIS_SENTINEL_PORT" --tls --cert "$REDIS_SENTINEL_TLS_CERT_FILE" --key "$REDIS_SENTINEL_TLS_KEY_FILE" --cacert "$REDIS_SENTINEL_TLS_CA_FILE" sentinel "$@"
        else
            redis-cli -h "$REDIS_SERVICE" -p "$REDIS_SENTINEL_PORT" sentinel "$@"
        fi
    }
    sentinel_failover_finished() {
        REDIS_SENTINEL_INFO=($(run_sentinel_command get-master-addr-by-name "mymaster"))
        REDIS_MASTER_HOST="${REDIS_SENTINEL_INFO[0]}"
        [[ "$REDIS_MASTER_HOST" != "$(get_full_hostname $HOSTNAME)" ]]
    }

    REDIS_SERVICE="release-name-redis.default.svc.cluster.local"

    # redis-cli automatically consumes credentials from the REDISCLI_AUTH variable
    [[ -n "$REDIS_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_PASSWORD"
    [[ -f "$REDIS_PASSWORD_FILE" ]] && export REDISCLI_AUTH="$(< "${REDIS_PASSWORD_FILE}")"


    if is_master && ! sentinel_failover_finished; then
        echo "I am the master pod and you are stopping me. Pausing client connections."
        # Pausing client write connections to avoid data loss
        run_redis_command CLIENT PAUSE "22000" WRITE

        echo "Issuing failover"
        # if I am the master, issue a command to failover once
        run_sentinel_command failover "mymaster"
        echo "Waiting for sentinel to complete failover for up to 20s"
        retry_while "sentinel_failover_finished" "20" 1
    else
        exit 0
    fi
---
# Source: passbolt/templates/configmap-app-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-passbolt-cm-app-php
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: app-php
    app.kubernetes.io/type: cm
data:
  app.php: |
    <?php
    use Cake\Cache\Engine\FileEngine;
    use Cake\Database\Connection;
    use Cake\Database\Driver\Mysql;
    use Cake\Error\ExceptionRenderer;
    use Cake\Log\Engine\FileLog;

    return [
        /**
         * Debug Level:
         *
         * Production Mode:
         * false: No error messages, errors, or warnings shown.
         *
         * Development Mode:
         * true: Errors and warnings shown.
         */
        'debug' => filter_var(env('DEBUG', false), FILTER_VALIDATE_BOOLEAN),
        'debugKit' => false,

        /**
         * Configure basic information about the application.
         *
         * - namespace - The namespace to find app classes under.
         * - defaultLocale - The default locale for translation, formatting currencies and numbers, date and time.
         * - encoding - The encoding used for HTML + database connections.
         * - base - The base directory the app resides in. If false this
         *   will be auto detected.
         * - dir - Name of app directory.
         * - webroot - The webroot directory.
         * - wwwRoot - The file path to webroot.
         * - baseUrl - To configure CakePHP to *not* use mod_rewrite and to
         *   use CakePHP pretty URLs, remove these .htaccess
         *   files:
         *      /.htaccess
         *      /webroot/.htaccess
         *   And uncomment the baseUrl key below.
         * - fullBaseUrl - A base URL to use for absolute links.
         * - imageBaseUrl - Web path to the public images directory under webroot.
         * - cssBaseUrl - Web path to the public css directory under webroot.
         * - jsBaseUrl - Web path to the public js directory under webroot.
         * - paths - Configure paths for non class based resources. Supports the
         *   `plugins`, `templates`, `locales` subkeys, which allow the definition of
         *   paths for plugins, view templates and locale files respectively.
         */
        'App' => [
            'namespace' => 'App',
            'encoding' => env('APP_ENCODING', 'UTF-8'),
            'defaultLocale' => 'en_UK',
            'base' => env('APP_BASE', false),
            'dir' => 'src',
            'webroot' => 'webroot',
            'wwwRoot' => WWW_ROOT,
            // 'baseUrl' => env('APP_BASE_URL'),
            'fullBaseUrl' => env('APP_FULL_BASE_URL', false),
            'imageBaseUrl' => 'img/',
            'cssBaseUrl' => 'css/',
            'jsBaseUrl' => 'js/',
            //
            // Customization of paths is not supported in passbolt v3
            // Default is overridden directly in bootstrap.php
            //
            //'paths' => [
            //    'plugins' => [ROOT . DS . 'plugins' . DS],
            //    'templates' => [ROOT . DS . 'templates' . DS],
            //    'locales' => [RESOURCES . 'locales' . DS],
            //],
        ],

        /**
         * Security and encryption configuration
         *
         * - salt - A random string used in security hashing methods.
         *   The salt value is also used as the encryption key.
         *   You should treat it as extremely sensitive data.
         */
        'Security' => [
            'salt' => env('SECURITY_SALT', '__SALT__'),
        ],

        /**
         * Apply timestamps with the last modified time to static assets (js, css, images).
         * Will append a querystring parameter containing the time the file was modified.
         * This is useful for busting browser caches.
         *
         * Set to true to apply timestamps when debug is true. Set to 'force' to always
         * enable timestamping regardless of debug value.
         */
        'Asset' => [
            // 'timestamp' => true,
            // 'cacheTime' => '+1 year'
        ],

        /**
         * Configure the cache adapters.
         */
        'Cache' => [
            'default' => [
                'className' => 'Redis',
                'prefix' => env('CACHE_PREFIX_ORG', 'passbolt'),
                'server' => env('CACHE_CAKE_DEFAULT_SERVER', '127.0.0.1'),
                'database' => (int)env('CACHE_DEFAULT_DATABASE', 1),
                'password' => env('CACHE_CAKE_DEFAULT_PASSWORD', ''),
                'port' => env('CACHE_CAKE_DEFAULT_PORT', 6379),
            ],

            /**
             * Configure the cache used for general framework caching.
             * Translation cache files are stored with this configuration.
             * Duration will be set to '+2 minutes' in bootstrap.php when debug = true
             * If you set 'className' => 'Null' core cache will be disabled.
             */
            '_cake_core_' => [
                'className' => 'Redis',
                'duration' => '+1 week',
                'server' => env('CACHE_CAKE_DEFAULT_SERVER', '127.0.0.1'),
                'database' => (int)env('CACHE_CAKE_CORE_DATABASE', 2),
                'password' => env('CACHE_CAKE_DEFAULT_PASSWORD', ''),
                'port' => env('CACHE_CAKE_DEFAULT_PORT', 6379),
            ],

            /**
             * Configure the cache for model and datasource caches. This cache
             * configuration is used to store schema descriptions, and table listings
             * in connections.
             * Duration will be set to '+2 minutes' in bootstrap.php when debug = true
             */
            '_cake_model_' => [
                'className' => 'Redis',
                'duration' => '+1 week',
                'server' => env('CACHE_CAKE_DEFAULT_SERVER', '127.0.0.1'),
                'database' => (int)env('CACHE_CAKE_MODEL_DATABASE', 3),
                'password' => env('CACHE_CAKE_DEFAULT_PASSWORD', ''),
                'port' => env('CACHE_CAKE_DEFAULT_PORT', 6379),
            ],
        ],

        /**
         * Configure the Error and Exception handlers used by your application.
         *
         * By default errors are displayed using Debugger, when debug is true and logged
         * by Cake\Log\Log when debug is false.
         *
         * In CLI environments exceptions will be printed to stderr with a backtrace.
         * In web environments an HTML page will be displayed for the exception.
         * With debug true, framework errors like Missing Controller will be displayed.
         * When debug is false, framework errors will be coerced into generic HTTP errors.
         *
         * Options:
         *
         * - `errorLevel` - int - The level of errors you are interested in capturing.
         * - `trace` - boolean - Whether or not backtraces should be included in
         *   logged errors/exceptions.
         * - `log` - boolean - Whether or not you want exceptions logged.
         * - `exceptionRenderer` - string - The class responsible for rendering
         *   uncaught exceptions. If you choose a custom class you should place
         *   the file for that class in src/Error. This class needs to implement a
         *   render method.
         * - `skipLog` - array - List of exceptions to skip for logging. Exceptions that
         *   extend one of the listed exceptions will also be skipped for logging.
         *   E.g.:
         *   `'skipLog' => ['Cake\Network\Exception\NotFoundException', 'Cake\Network\Exception\UnauthorizedException']`
         * - `extraFatalErrorMemory` - int - The number of megabytes to increase
         *   the memory limit by when a fatal error is encountered. This allows
         *   breathing room to complete logging or error handling.
         */
        'Error' => [
            'errorLevel' => E_ALL,
            'exceptionRenderer' => ExceptionRenderer::class,
            'skipLog' => [],
            'log' => true,
            'trace' => true,
            'ignoredDeprecationPaths' => [],
        ],

        /**
         * Debugger configuration
         *
         * Define development error values for Cake\Error\Debugger
         *
         * - `editor` Set the editor URL format you want to use.
         *   By default atom, emacs, macvim, phpstorm, sublime, textmate, and vscode are
         *   available. You can add additional editor link formats using
         *   `Debugger::addEditor()` during your application bootstrap.
         * - `outputMask` A mapping of `key` to `replacement` values that
         *   `Debugger` should replace in dumped data and logs generated by `Debugger`.
         */
        'Debugger' => [
            'editor' => 'phpstorm',
        ],

        /**
         * Email configuration.
         *
         * By defining transports separately from delivery profiles you can easily
         * re-use transport configuration across multiple profiles.
         *
         * You can specify multiple configurations for production, development and
         * testing.
         *
         * Each transport needs a `className`. Valid options are as follows:
         *
         *  Mail   - Send using PHP mail function
         *  Smtp   - Send using SMTP
         *  Debug  - Do not send the email, just return the result
         *
         * You can add custom transports (or override existing transports) by adding the
         * appropriate file to src/Mailer/Transport. Transports should be named
         * 'YourTransport.php', where 'Your' is the name of the transport.
         */
        'EmailTransport' => [
            'default' => [
                'className' => env('EMAIL_TRANSPORT_DEFAULT_CLASS_NAME', 'Smtp'),
                /*
                 * The keys host, port, timeout, username, password, client and tls
                 * are used in SMTP transports
                 */
                'host' => env('EMAIL_TRANSPORT_DEFAULT_HOST', 'localhost'),
                'port' => env('EMAIL_TRANSPORT_DEFAULT_PORT', 25),
                'timeout' => env('EMAIL_TRANSPORT_DEFAULT_TIMEOUT', 30),
                /*
                 * It is recommended to set these options through your environment or passbolt.php
                 */
                'username' => env('EMAIL_TRANSPORT_DEFAULT_USERNAME', null),
                'password' => env('EMAIL_TRANSPORT_DEFAULT_PASSWORD', null),
                'client' => env('EMAIL_TRANSPORT_DEFAULT_CLIENT', null),
                'tls' => env('EMAIL_TRANSPORT_DEFAULT_TLS', null),
                'url' => env('EMAIL_TRANSPORT_DEFAULT_URL', null),

            ],
            'Debug' => [
                'className' => 'Debug'
            ],
        ],

        /**
         * Email delivery profiles
         *
         * Delivery profiles allow you to predefine various properties about email
         * messages from your application and give the settings a name. This saves
         * duplication across your application and makes maintenance and development
         * easier. Each profile accepts a number of keys. See `Cake\Mailer\Email`
         * for more information.
         */
        'Email' => [
            'default' => [
                'transport' => env('EMAIL_DEFAULT_TRANSPORT', 'default'),
                'from' => [
                    env('EMAIL_DEFAULT_FROM', 'you@localhost.test') => env('EMAIL_DEFAULT_FROM_NAME', 'Passbolt')
                ],
                //'charset' => 'utf-8',
                //'headerCharset' => 'utf-8',
            ],
        ],

        /**
         * Connection information used by the ORM to connect
         * to your application's datastores.
         * Do not use periods in database name - it may lead to error.
         * See https://github.com/cakephp/cakephp/issues/6471 for details.
         * Drivers include Mysql Postgres Sqlite Sqlserver
         * See vendor\cakephp\cakephp\src\Database\Driver for complete list
         */
        'Datasources' => [
            'default' => [
                'className' => Connection::class,
                'driver' => env('DATASOURCES_DEFAULT_DRIVER', Mysql::class),
                'persistent' => false,
                'timezone' => 'UTC',

                /*
                 * For MariaDB/MySQL the internal default changed from utf8 to utf8mb4, aka full utf-8 support
                 */
                'flags' => [],
                'cacheMetadata' => true,
                'log' => env('DATASOURCES_DEFAULT_LOG', false),

                /*
                 * Set identifier quoting to true if you are using reserved words or
                 * special characters in your table or column names. Enabling this
                 * setting will result in queries built using the Query Builder having
                 * identifiers quoted when creating SQL. It should be noted that this
                 * decreases performance because each query needs to be traversed and
                 * manipulated before being executed.
                 */
                'quoteIdentifiers' => env('DATASOURCES_QUOTE_IDENTIFIER', true),

                /*
                 * During development, if using MySQL < 5.6, uncommenting the
                 * following line could boost the speed at which schema metadata is
                 * fetched from the database. It can also be set directly with the
                 * mysql configuration directive 'innodb_stats_on_metadata = 0'
                 * which is the recommended value in production environments
                 */
                //'init' => ['SET GLOBAL innodb_stats_on_metadata = 0'],

                /*
                 * Non default config
                 * Passbolt support setting these from environment variables
                 * They can also be overridden in passbolt.php
                 */
                'host' => env('DATASOURCES_DEFAULT_HOST', 'localhost'),
                'port' => env('DATASOURCES_DEFAULT_PORT', 3306),
                'url' => env('DATASOURCES_DEFAULT_URL', null),
                'username' => env('DATASOURCES_DEFAULT_USERNAME', ''),
                'password' => env('DATASOURCES_DEFAULT_PASSWORD', ''),
                'database' => env('DATASOURCES_DEFAULT_DATABASE', ''),
                'ssl_key' => env('DATASOURCES_DEFAULT_SSL_KEY', ''),
                'ssl_cert' => env('DATASOURCES_DEFAULT_SSL_CERT', ''),
                'ssl_ca' => env('DATASOURCES_DEFAULT_SSL_CA', ''),
                'encoding' => env('DATASOURCES_DEFAULT_ENCODING','utf8mb4'),

            ],

            /**
             * The test connection is used during the test suite.
             */
            'test' => [
                'className' => Connection::class,
                'driver' => env('DATASOURCES_TEST_DRIVER', Mysql::class),
                'persistent' => false,
                'timezone' => 'UTC',
                'encoding' => env('DATASOURCES_TEST_ENCODING','utf8mb4'),
                'flags' => [],
                'cacheMetadata' => true,
                'quoteIdentifiers' => env('DATASOURCES_QUOTE_IDENTIFIER', true),
                'log' => env('DATASOURCES_TEST_LOG', false),
                //'init' => ['SET GLOBAL innodb_stats_on_metadata = 0'],

                /*
                 * Non default config
                 * Passbolt support setting these from environment variables
                 * They can also be overridden in passbolt.php
                 */
                'host' => env('DATASOURCES_TEST_HOST', 'localhost'),
                'port' => env('DATASOURCES_TEST_PORT', 3306),
                'username' => env('DATASOURCES_TEST_USERNAME', 'my_app'),
                'password' => env('DATASOURCES_TEST_PASSWORD', 'secret'),
                'database' => env('DATASOURCES_TEST_DATABASE', 'my_app'),
                'ssl_key' => env('DATASOURCES_TEST_SSL_KEY', ''),
                'ssl_cert' => env('DATASOURCES_TEST_SSL_CERT', ''),
                'ssl_ca' => env('DATASOURCES_TEST_SSL_CA', ''),
                'url' => env('DATASOURCES_TEST_URL', null),
            ],
        ],

        /**
         * Configures logging options
         */
        'Log' => [
            'debug' => [
                'className' => FileLog::class,
                'path' => LOGS,
                'file' => 'debug',
                'levels' => ['notice', 'info', 'debug'],
                'url' => env('LOG_DEBUG_URL', null),
            ],
            'error' => [
                'className' => FileLog::class,
                'path' => LOGS,
                'file' => 'error',
                'levels' => ['warning', 'error', 'critical', 'alert', 'emergency'],
                'url' => env('LOG_ERROR_URL', null),
            ],
            // To enable this dedicated query log, you need set your datasource's log flag to true
            // See DATASOURCES_DEFAULT_LOG
            'queries' => [
                'className' => FileLog::class,
                'path' => LOGS,
                'file' => 'queries',
                'url' => env('LOG_QUERIES_URL', null),
                'scopes' => ['queriesLog'],
            ],
        ],

        /**
         * Session configuration.
         *
         * Contains an array of settings to use for session configuration. The
         * `defaults` key is used to define a default preset to use for sessions, any
         * settings declared here will override the settings of the default config.
         *
         * ## Options
         *
         * - `cookie` - The name of the cookie to use. Defaults to 'CAKEPHP'.
         * - `cookiePath` - The url path for which session cookie is set. Maps to the
         *   `session.cookie_path` php.ini config. Defaults to base path of app.
         * - `timeout` - The time in minutes the session should be valid for.
         *    Pass 0 to disable checking timeout.
         *    Please note that php.ini's session.gc_maxlifetime must be equal to or greater
         *    than the largest Session['timeout'] in all served websites for it to have the
         *    desired effect.
         * - `defaults` - The default configuration set to use as a basis for your session.
         *    There are four built-in options: php, cake, cache, database.
         * - `handler` - Can be used to enable a custom session handler. Expects an
         *    array with at least the `engine` key, being the name of the Session engine
         *    class to use for managing the session. CakePHP bundles the `CacheSession`
         *    and `DatabaseSession` engines.
         * - `ini` - An associative array of additional ini values to set.
         *
         * The built-in `defaults` options are:
         *
         * - 'php' - Uses settings defined in your php.ini.
         * - 'cake' - Saves session files in CakePHP's /tmp directory.
         * - 'database' - Uses CakePHP's database sessions.
         * - 'cache' - Use the Cache class to save sessions.
         *
         * To define a custom session handler, save it at src/Network/Session/<name>.php.
         * Make sure the class implements PHP's `SessionHandlerInterface` and set
         * Session.handler to <name>
         *
         * To use database sessions, load the SQL file located at config/Schema/sessions.sql
         */
        'Session' => [
            'defaults' => env('SESSION_DEFAULTS', 'cache'),
            'duration' => '+1 day',
        ],
      ];
---
# Source: passbolt/templates/rbac.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: release-name-passbolt-role-common
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: common
    app.kubernetes.io/type: role
rules:
- apiGroups: [""]
  resources: [ "configmaps", "secrets" ]
  resourceNames:
  - release-name-passbolt-sec-redis-proxy
  - release-name-passbolt-cm-env
  - release-name-passbolt-sec-env
  - release-name-passbolt-sec-gpg
  - release-name-passbolt-sec-jwt
  - release-name-passbolt-sec-tls
  - release-name-passbolt-sec-tls-ing
  - release-name-passbolt-sec-subscription
  verbs: ["get"]
---
# Source: passbolt/templates/rbac.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: release-name-passbolt-rolebind-common
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: common
    app.kubernetes.io/type: rolebind
subjects:
- kind: ServiceAccount
  name: release-name-passbolt-sa-common
roleRef:
  kind: Role
  name: release-name-passbolt-role-common
  apiGroup: rbac.authorization.k8s.io
---
# Source: passbolt/charts/mariadb/templates/primary/svc.yaml
apiVersion: v1
kind: Service
metadata:
  name: release-name-mariadb-primary
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: primary
  annotations:
spec:
  type: ClusterIP
  sessionAffinity: None
  ports:
    - name: mysql
      port: 3306
      protocol: TCP
      targetPort: mysql
      nodePort: null
  selector: 
    app.kubernetes.io/name: mariadb
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: primary
---
# Source: passbolt/charts/mariadb/templates/secondary/svc.yaml
apiVersion: v1
kind: Service
metadata:
  name: release-name-mariadb-secondary
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: secondary
  annotations:
spec:
  type: ClusterIP
  sessionAffinity: None
  ports:
    - name: mysql
      port: 3306
      protocol: TCP
      targetPort: mysql
      nodePort: null
  selector: 
    app.kubernetes.io/name: mariadb
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: secondary
---
# Source: passbolt/charts/redis/templates/headless-svc.yaml
apiVersion: v1
kind: Service
metadata:
  name: release-name-redis-headless
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
  annotations:
    
spec:
  type: ClusterIP
  clusterIP: None
  publishNotReadyAddresses: true
  ports:
    - name: tcp-redis
      port: 6379
      targetPort: redis
    - name: tcp-sentinel
      port: 26379
      targetPort: redis-sentinel
  selector:
    app.kubernetes.io/name: redis
    app.kubernetes.io/instance: release-name
---
# Source: passbolt/charts/redis/templates/sentinel/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: release-name-redis
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: node
spec:
  type: ClusterIP
  sessionAffinity: None
  ports:
    - name: tcp-redis
      port: 6379
      targetPort: 6379
      nodePort: null
    - name: tcp-sentinel
      port: 26379
      targetPort: 26379
      nodePort: null
  selector:
    app.kubernetes.io/name: redis
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: node
---
# Source: passbolt/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  # We make exception here to reduce the interservice naming
  name: release-name-passbolt
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: common
    app.kubernetes.io/type: svc
spec:
  type: ClusterIP
  ports:
    - port: 443
      targetPort: 443
      protocol: TCP
      name: https
    - port: 80
      targetPort: 80
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
---
# Source: passbolt/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-passbolt-depl-srv
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: srv
    app.kubernetes.io/type: depl
spec:
  replicas: 2
  
  selector:
    matchLabels:
      app.kubernetes.io/name: passbolt
      app.kubernetes.io/instance: release-name
    matchExpressions:
      - {key: app.kubernetes.io/type, operator: NotIn, values: [job, cron]}
  template:
    metadata:
      labels:
        app.kubernetes.io/name: passbolt
        app.kubernetes.io/instance: release-name
      annotations:
        checksum/sec-env: 0f1d2e5c09b65de31f33d5a0b796dfa9efdc8d9848ab81aa3a7e7d862b56dde6
        
        checksum/sec-gpg: fb81780fb9215ba7b8b61e6b4363ccd136df016bd563dee5eb33758c730f261c
        checksum/cm-env: 50e68c3931412f7d19b30c3781e4fc9ef4ed1836359a9544041165710ceb6ccf
        checksum/sec-jwt: 9e887c5719025aff30d6652eea7c04f17730f7b557a8bb32816bc4c0cc681e7b
        checksum/sec-redis-proxy: e8f5e2bd831808d3c4ea26c6a58c94ede568384d4958ead5b19a7d2ee301e6fb
    spec:
      
      serviceAccountName: release-name-passbolt-sa-common
      securityContext:
        {}
      initContainers:
        - name: release-name-passbolt-depl-srv-init
          
          image: mariadb
          imagePullPolicy: IfNotPresent
          command:
            - "/bin/bash"
          args:
            - "-c"
            - |
              set -e
              client="mariadb"
              cat <<-EOF > /tmp/defaultsfile.cnf
              [client]
              user=${DATASOURCES_DEFAULT_USERNAME}
              password=${DATASOURCES_DEFAULT_PASSWORD}
              host=${DATASOURCES_DEFAULT_HOST}
              connect-timeout=2
              EOF
              userhost="%"
              client="mariadb"
              while ! ${client} --defaults-file=/tmp/defaultsfile.cnf -e "SELECT 1" > /dev/null 2>&1; do
                echo "Waiting for database connection..."
                sleep 2
              done
          env:
            - name: DATASOURCES_DEFAULT_HOST
              value: "release-name-mariadb-primary"
            - name: DATASOURCES_DEFAULT_PORT
              value: "3306"
          envFrom:
            - configMapRef:
                name: release-name-passbolt-cm-env
            - secretRef:
                name: release-name-passbolt-sec-env
      containers:
        - name: passbolt
          command:
            - "/bin/bash"
          args:
            - "-c"
            - |
              set -e
              > /etc/supervisor/conf.d/cron.conf
              /docker-entrypoint.sh
          image: passbolt/passbolt:4.6.2-1-ce
          imagePullPolicy: IfNotPresent
          ports:
          - name: https
            containerPort: 443
            protocol: TCP
          - name: http
            containerPort: 80
            protocol: TCP
          livenessProbe:
            httpGet:
              httpHeaders:
              - name: Host
                value: passbolt.local
              path: /healthcheck/status.json
              port: https
              scheme: HTTPS
            initialDelaySeconds: 20
            periodSeconds: 10
          readinessProbe:
            httpGet:
              httpHeaders:
              - name: Host
                value: passbolt.local
              path: /healthcheck/status.json
              port: https
              scheme: HTTPS
            initialDelaySeconds: 5
            periodSeconds: 10
          env:
            - name: DATASOURCES_DEFAULT_HOST
              value: "release-name-mariadb-primary"
          envFrom:
            - configMapRef:
                name: release-name-passbolt-cm-env
            - secretRef:
                name: release-name-passbolt-sec-env
          volumeMounts:
            - mountPath: "/etc/passbolt/app.php"
              subPath: app.php
              name: cm-app-php
              readOnly: true
            - mountPath: /etc/ssl/certs/passbolt
              name: sec-tls
              readOnly: true
            - name: sec-gpg
              mountPath: /etc/passbolt/gpg
              readOnly: true
            - name: sec-jwt
              mountPath: "/etc/passbolt/jwt"
              readOnly: true
          resources:
            {}
        - name: redisproxy
          image: haproxy:latest
          imagePullPolicy: 
          volumeMounts:
            - mountPath: "/usr/local/etc/haproxy/haproxy.cfg"
              subPath: haproxy.cfg
              name: sec-redis-proxy
              readOnly: true
          resources:
            {}
      volumes:
        - name: sec-tls
          secret:
            secretName: release-name-passbolt-sec-tls-internal
        - name: sec-gpg
          secret:
            secretName: release-name-passbolt-sec-gpg
        - configMap:
            name: release-name-passbolt-cm-app-php
          name: cm-app-php
        - name: sec-jwt
          secret:
            secretName: release-name-passbolt-sec-jwt
        - name: sec-redis-proxy
          secret:
            secretName: release-name-passbolt-sec-redis-proxy
---
# Source: passbolt/charts/mariadb/templates/primary/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: release-name-mariadb-primary
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: primary
spec:
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels: 
      app.kubernetes.io/name: mariadb
      app.kubernetes.io/instance: release-name
      app.kubernetes.io/component: primary
  serviceName: release-name-mariadb-primary
  updateStrategy:
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configuration: 8be65c87f5736ac1cd51ef94f4f8dfc454aea9294f2e969a002f91f74f96692d
      labels:
        app.kubernetes.io/name: mariadb
        helm.sh/chart: mariadb-11.5.7
        app.kubernetes.io/instance: release-name
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: primary
    spec:
      
      serviceAccountName: release-name-mariadb
      affinity:
        podAffinity:
          
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app.kubernetes.io/name: mariadb
                    app.kubernetes.io/instance: release-name
                    app.kubernetes.io/component: primary
                topologyKey: kubernetes.io/hostname
              weight: 1
        nodeAffinity:
          
      securityContext:
        fsGroup: 1001
      containers:
        - name: mariadb
          image: docker.io/bitnami/mariadb:10.6.12-debian-11-r16
          imagePullPolicy: "IfNotPresent"
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            runAsNonRoot: true
            runAsUser: 1001
          env:
            - name: BITNAMI_DEBUG
              value: "false"
            - name: MARIADB_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: release-name-mariadb
                  key: mariadb-root-password
            - name: MARIADB_USER
              value: "CHANGEME"
            - name: MARIADB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: release-name-mariadb
                  key: mariadb-password
            - name: MARIADB_DATABASE
              value: "passbolt"
            - name: MARIADB_REPLICATION_MODE
              value: "master"
            - name: MARIADB_REPLICATION_USER
              value: "replicator"
            - name: MARIADB_REPLICATION_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: release-name-mariadb
                  key: mariadb-replication-password
          ports:
            - name: mysql
              containerPort: 3306
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 120
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
            exec:
              command:
                - /bin/bash
                - -ec
                - |
                  password_aux="${MARIADB_ROOT_PASSWORD:-}"
                  if [[ -f "${MARIADB_ROOT_PASSWORD_FILE:-}" ]]; then
                      password_aux=$(cat "$MARIADB_ROOT_PASSWORD_FILE")
                  fi
                  mysqladmin status -uroot -p"${password_aux}"
          readinessProbe:
            failureThreshold: 3
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
            exec:
              command:
                - /bin/bash
                - -ec
                - |
                  password_aux="${MARIADB_ROOT_PASSWORD:-}"
                  if [[ -f "${MARIADB_ROOT_PASSWORD_FILE:-}" ]]; then
                      password_aux=$(cat "$MARIADB_ROOT_PASSWORD_FILE")
                  fi
                  mysqladmin status -uroot -p"${password_aux}"
          resources: 
            limits: {}
            requests: {}
          volumeMounts:
            - name: data
              mountPath: /bitnami/mariadb
            - name: config
              mountPath: /opt/bitnami/mariadb/conf/my.cnf
              subPath: my.cnf
      volumes:
        - name: config
          configMap:
            name: release-name-mariadb-primary
  volumeClaimTemplates:
    - metadata:
        name: data
        labels: 
          app.kubernetes.io/name: mariadb
          app.kubernetes.io/instance: release-name
          app.kubernetes.io/component: primary
      spec:
        accessModes:
          - "ReadWriteOnce"
        resources:
          requests:
            storage: "8Gi"
---
# Source: passbolt/charts/mariadb/templates/secondary/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: release-name-mariadb-secondary
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: secondary
spec:
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels: 
      app.kubernetes.io/name: mariadb
      app.kubernetes.io/instance: release-name
      app.kubernetes.io/component: secondary
  serviceName: release-name-mariadb-secondary
  podManagementPolicy: 
  updateStrategy:
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configuration: 61632d6db027c06d230f65e3aa1a102ed560cf1909d4aa6c4fb873ea23ee56ff
      labels:
        app.kubernetes.io/name: mariadb
        helm.sh/chart: mariadb-11.5.7
        app.kubernetes.io/instance: release-name
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: secondary
    spec:
      
      serviceAccountName: release-name-mariadb
      affinity:
        podAffinity:
          
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app.kubernetes.io/name: mariadb
                    app.kubernetes.io/instance: release-name
                    app.kubernetes.io/component: secondary
                topologyKey: kubernetes.io/hostname
              weight: 1
        nodeAffinity:
          
      securityContext:
        fsGroup: 1001
      containers:
        - name: mariadb
          image: docker.io/bitnami/mariadb:10.6.12-debian-11-r16
          imagePullPolicy: "IfNotPresent"
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            runAsNonRoot: true
            runAsUser: 1001
          env:
            - name: BITNAMI_DEBUG
              value: "false"
            - name: MARIADB_REPLICATION_MODE
              value: "slave"
            - name: MARIADB_MASTER_HOST
              value: release-name-mariadb-primary
            - name: MARIADB_MASTER_PORT_NUMBER
              value: "3306"
            - name: MARIADB_MASTER_ROOT_USER
              value: "root"
            - name: MARIADB_MASTER_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: release-name-mariadb
                  key: mariadb-root-password
            - name: MARIADB_REPLICATION_USER
              value: "replicator"
            - name: MARIADB_REPLICATION_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: release-name-mariadb
                  key: mariadb-replication-password
          ports:
            - name: mysql
              containerPort: 3306
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 120
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
            exec:
              command:
                - /bin/bash
                - -ec
                - |
                  password_aux="${MARIADB_MASTER_ROOT_PASSWORD:-}"
                  if [[ -f "${MARIADB_MASTER_ROOT_PASSWORD_FILE:-}" ]]; then
                      password_aux=$(cat "$MARIADB_MASTER_ROOT_PASSWORD_FILE")
                  fi
                  mysqladmin status -uroot -p"${password_aux}"
          readinessProbe:
            failureThreshold: 3
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
            exec:
              command:
                - /bin/bash
                - -ec
                - |
                  password_aux="${MARIADB_MASTER_ROOT_PASSWORD:-}"
                  if [[ -f "${MARIADB_MASTER_ROOT_PASSWORD_FILE:-}" ]]; then
                      password_aux=$(cat "$MARIADB_MASTER_ROOT_PASSWORD_FILE")
                  fi
                  mysqladmin status -uroot -p"${password_aux}"
          resources: 
            limits: {}
            requests: {}
          volumeMounts:
            - name: data
              mountPath: /bitnami/mariadb
            - name: config
              mountPath: /opt/bitnami/mariadb/conf/my.cnf
              subPath: my.cnf
      volumes:
        - name: config
          configMap:
            name: release-name-mariadb-secondary
  volumeClaimTemplates:
    - metadata:
        name: data
        labels: 
          app.kubernetes.io/name: mariadb
          app.kubernetes.io/instance: release-name
          app.kubernetes.io/component: secondary
      spec:
        accessModes:
          - "ReadWriteOnce"
        resources:
          requests:
            storage: "8Gi"
---
# Source: passbolt/charts/redis/templates/sentinel/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: release-name-redis-node
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: node
spec:
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/name: redis
      app.kubernetes.io/instance: release-name
      app.kubernetes.io/component: node
  serviceName: release-name-redis-headless
  updateStrategy:
    type: RollingUpdate
  template:
    metadata:
      labels:
        app.kubernetes.io/name: redis
        helm.sh/chart: redis-17.15.2
        app.kubernetes.io/instance: release-name
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: node
      annotations:
        checksum/configmap: 9cca9faa12c4456a87f4bf62979b014d7f434168602b6715f693e8f66ff26bfd
        checksum/health: 1eace71641fb5bd753e90012419e82c10b1180d694f91d83743b727a5aacca73
        checksum/scripts: c3d2724011153c91a9b8fd267e4015256b3881b5eb16b71e33571ca35175031f
        checksum/secret: e2dbc9e83e89a3079b8d2b25e0314273781fe72e30a39b119a99af9c5b27588a
    spec:
      
      securityContext:
        fsGroup: 1001
      automountServiceAccountToken: true
      serviceAccountName: release-name-redis
      affinity:
        podAffinity:
          
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app.kubernetes.io/name: redis
                    app.kubernetes.io/instance: release-name
                    app.kubernetes.io/component: node
                topologyKey: kubernetes.io/hostname
              weight: 1
        nodeAffinity:
          
      terminationGracePeriodSeconds: 30
      containers:
        - name: redis
          image: docker.io/bitnami/redis:7.0.12-debian-11-r19
          imagePullPolicy: "IfNotPresent"
          lifecycle:
            preStop:
              exec:
                command:
                  - /bin/bash
                  - -c
                  - /opt/bitnami/scripts/start-scripts/prestop-redis.sh
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            runAsGroup: 0
            runAsNonRoot: true
            runAsUser: 1001
            seccompProfile:
              type: RuntimeDefault
          command:
            - /bin/bash
          args:
            - -c
            - /opt/bitnami/scripts/start-scripts/start-node.sh
          env:
            - name: BITNAMI_DEBUG
              value: "false"
            - name: REDIS_MASTER_PORT_NUMBER
              value: "6379"
            - name: ALLOW_EMPTY_PASSWORD
              value: "no"
            - name: REDIS_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: release-name-redis
                  key: redis-password
            - name: REDIS_MASTER_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: release-name-redis
                  key: redis-password
            - name: REDIS_TLS_ENABLED
              value: "no"
            - name: REDIS_PORT
              value: "6379"
            - name: REDIS_SENTINEL_TLS_ENABLED
              value: "no"
            - name: REDIS_SENTINEL_PORT
              value: "26379"
            - name: REDIS_DATA_DIR
              value: /data
          ports:
            - name: redis
              containerPort: 6379
          startupProbe:
            failureThreshold: 22
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
            exec:
              command:
                - sh
                - -c
                - /health/ping_liveness_local.sh 5
          livenessProbe:
            initialDelaySeconds: 20
            periodSeconds: 5
            timeoutSeconds: 5
            successThreshold: 1
            failureThreshold: 5
            exec:
              command:
                - sh
                - -c
                - /health/ping_liveness_local.sh 5
          readinessProbe:
            initialDelaySeconds: 20
            periodSeconds: 5
            timeoutSeconds: 1
            successThreshold: 1
            failureThreshold: 5
            exec:
              command:
                - sh
                - -c
                - /health/ping_readiness_local.sh 1
          resources:
            limits: {}
            requests: {}
          volumeMounts:
            - name: start-scripts
              mountPath: /opt/bitnami/scripts/start-scripts
            - name: health
              mountPath: /health
            - name: redis-data
              mountPath: /data
            - name: config
              mountPath: /opt/bitnami/redis/mounted-etc
            - name: redis-tmp-conf
              mountPath: /opt/bitnami/redis/etc
            - name: tmp
              mountPath: /tmp
        - name: sentinel
          image: docker.io/bitnami/redis-sentinel:7.0.12-debian-11-r18
          imagePullPolicy: "IfNotPresent"
          lifecycle:
            preStop:
              exec:
                command:
                  - /bin/bash
                  - -c
                  - /opt/bitnami/scripts/start-scripts/prestop-sentinel.sh
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            runAsGroup: 0
            runAsNonRoot: true
            runAsUser: 1001
            seccompProfile:
              type: RuntimeDefault
          command:
            - /bin/bash
          args:
            - -c
            - /opt/bitnami/scripts/start-scripts/start-sentinel.sh
          env:
            - name: BITNAMI_DEBUG
              value: "false"
            - name: REDIS_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: release-name-redis
                  key: redis-password
            - name: REDIS_SENTINEL_TLS_ENABLED
              value: "no"
            - name: REDIS_SENTINEL_PORT
              value: "26379"
          ports:
            - name: redis-sentinel
              containerPort: 26379
          startupProbe:
            failureThreshold: 22
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
            exec:
              command:
                - sh
                - -c
                - /health/ping_sentinel.sh 5
          livenessProbe:
            initialDelaySeconds: 20
            periodSeconds: 10
            timeoutSeconds: 5
            successThreshold: 1
            failureThreshold: 6
            exec:
              command:
                - sh
                - -c
                - /health/ping_sentinel.sh 5
          readinessProbe:
            initialDelaySeconds: 20
            periodSeconds: 5
            timeoutSeconds: 1
            successThreshold: 1
            failureThreshold: 6
            exec:
              command:
                - sh
                - -c
                - /health/ping_sentinel.sh 1
          resources:
            limits: {}
            requests: {}
          volumeMounts:
            - name: start-scripts
              mountPath: /opt/bitnami/scripts/start-scripts
            - name: health
              mountPath: /health
            - name: sentinel-data
              mountPath: /opt/bitnami/redis-sentinel/etc
            - name: redis-data
              mountPath: /data
            - name: config
              mountPath: /opt/bitnami/redis-sentinel/mounted-etc
      volumes:
        - name: start-scripts
          configMap:
            name: release-name-redis-scripts
            defaultMode: 0755
        - name: health
          configMap:
            name: release-name-redis-health
            defaultMode: 0755
        - name: config
          configMap:
            name: release-name-redis-configuration
        - name: sentinel-data
          emptyDir: {}
        - name: redis-tmp-conf
          emptyDir: {}
        - name: tmp
          emptyDir: {}
  volumeClaimTemplates:
    - metadata:
        name: redis-data
        labels:
          app.kubernetes.io/name: redis
          app.kubernetes.io/instance: release-name
          app.kubernetes.io/component: node
      spec:
        accessModes:
          - "ReadWriteOnce"
        resources:
          requests:
            storage: "8Gi"
---
# Source: passbolt/templates/cronjob-proc-email.yaml
apiVersion: batch/v1
kind: CronJob
metadata:
  name: release-name-passbolt-cron-proc-email
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/action: proc-email
    app.kubernetes.io/type: cron
spec:
  schedule: "* * * * *"
  concurrencyPolicy: Replace
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            app.kubernetes.io/action: proc-email
            app.kubernetes.io/type: cron
        spec:
          
          serviceAccountName: release-name-passbolt-sa-common
          restartPolicy: OnFailure
          securityContext:
            runAsUser: 33
            fsGroup: 33
          containers:
            - name: proc-email
              image: passbolt/passbolt:4.6.2-1-ce
              imagePullPolicy: IfNotPresent
              command:
                - "/bin/bash"
              args:
                - "-c"
                - |
                  sleep 10
                  echo "Sending emails" \
                  && bin/cron \
                  && touch /tmp/pod/success
              env:
                - name: DATASOURCES_DEFAULT_HOST
                  value: "release-name-mariadb-primary"
              envFrom:
                - configMapRef:
                    name: release-name-passbolt-cm-env
                - secretRef:
                    name: release-name-passbolt-sec-env
              volumeMounts:
                - name: vol-success
                  mountPath: /tmp/pod
                - name: sec-gpg
                  mountPath: /etc/passbolt/gpg
                  readOnly: true
            - name: redisproxy
              image: haproxy:latest
              imagePullPolicy: 
              command:
                - "/bin/bash"
              args:
                - "-c"
                - |
                  haproxy -f /usr/local/etc/haproxy/haproxy.cfg &
                  REDIS_PROXY_PID=$?
                  while true; do if [ -f "/tmp/pod/success" ]; then kill $REDIS_PROXY_PID; sleep 5;  exit 0; fi; done
              volumeMounts:
                - name: vol-success
                  mountPath: /tmp/pod
                - mountPath: "/usr/local/etc/haproxy/haproxy.cfg"
                  subPath: haproxy.cfg
                  name: sec-redis-proxy
                  readOnly: true
              resources:
                null
          volumes:
            - name: vol-success
              emptyDir: {}
            - name: sec-gpg
              secret:
                secretName: release-name-passbolt-sec-gpg
            - name: sec-redis-proxy
              secret:
                secretName: release-name-passbolt-sec-redis-proxy
---
# Source: passbolt/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-passbolt-sa-create-gpg-keys
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: create-gpg-keys
    app.kubernetes.io/type: sa
---
# Source: passbolt/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-passbolt-sa-create-jwt-keys
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: create-jwt-keys
    app.kubernetes.io/type: sa
---
# Source: passbolt/templates/secret-env.yaml
apiVersion: v1
kind: Secret
metadata:
  name: release-name-passbolt-sec-env
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: env
    app.kubernetes.io/type: sec
type: Opaque
data:

  
    CACHE_CAKE_DEFAULT_PASSWORD: "Q0hBTkdFTUU="
    DATASOURCES_DEFAULT_DATABASE: "cGFzc2JvbHQ="
    DATASOURCES_DEFAULT_PASSWORD: "Q0hBTkdFTUU="
    DATASOURCES_DEFAULT_USERNAME: "Q0hBTkdFTUU="
    EMAIL_TRANSPORT_DEFAULT_PASSWORD: "Q0hBTkdFTUU="
    EMAIL_TRANSPORT_DEFAULT_USERNAME: "Q0hBTkdFTUU="
---
# Source: passbolt/templates/secret-gpg.yaml
apiVersion: v1
kind: Secret
metadata:
  name: release-name-passbolt-sec-gpg
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: gpg
    app.kubernetes.io/type: sec
type: Opaque
data:
    serverkey_private.asc: ""
    serverkey.asc: ""
---
# Source: passbolt/templates/secret-jwt.yaml
apiVersion: v1
kind: Secret
metadata:
  name: release-name-passbolt-sec-jwt
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: jwt
    app.kubernetes.io/type: sec
type: Opaque
data:
  jwt.key: ""
  jwt.pem: ""
---
# Source: passbolt/templates/secret-redis-proxy.yaml
apiVersion: v1
kind: Secret
metadata:
  name: release-name-passbolt-sec-redis-proxy
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: redis-proxy
    app.kubernetes.io/type: sec
  annotations:
    helm.sh/hook: pre-upgrade,pre-install
    helm.sh/hook-weight: "-6"
    helm.sh/hook-delete-policy: before-hook-creation
type: Opaque
stringData:
  haproxy.cfg: |
    global
      log stdout format raw local0
      maxconn 1024

      resolvers mydns
        parse-resolv-conf
        hold valid 10s

    defaults REDIS
      default-server init-addr libc,none
      log global
      mode tcp
      timeout connect 4s
      timeout server 330s
      timeout client 330s
      timeout check 2s
      option redispatch
      retries 300

    frontend ft_redis_master
      bind 127.0.0.1:6379
      use_backend bk_redis_master

    backend bk_redis_master
      mode tcp
      option tcp-check
      tcp-check connect
      tcp-check send AUTH\ CHANGEME\r\n
      tcp-check send PING\r\n
      tcp-check expect string +PONG
      tcp-check send info\ replication\r\n
      tcp-check expect string role:master
      tcp-check send QUIT\r\n
      tcp-check expect string +OK
      server R0 release-name-redis-node-0.release-name-redis-headless.default.svc.cluster.local:6379 resolvers mydns check inter 1s fall 1 rise 1
      server R1 release-name-redis-node-1.release-name-redis-headless.default.svc.cluster.local:6379 resolvers mydns check inter 1s fall 1 rise 1
      server R2 release-name-redis-node-2.release-name-redis-headless.default.svc.cluster.local:6379 resolvers mydns check inter 1s fall 1 rise 1
---
# Source: passbolt/templates/configmap-env.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-passbolt-cm-env
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: env
    app.kubernetes.io/type: cm
data:

  
    APP_FULL_BASE_URL: "https://passbolt.local"
    CACHE_CAKE_DEFAULT_SERVER: "127.0.0.1"
    DEBUG: "false"
    EMAIL_DEFAULT_FROM: "no-reply@passbolt.local"
    EMAIL_DEFAULT_FROM_NAME: "Passbolt"
    EMAIL_TRANSPORT_DEFAULT_HOST: "127.0.0.1"
    EMAIL_TRANSPORT_DEFAULT_PORT: "587"
    EMAIL_TRANSPORT_DEFAULT_TIMEOUT: "30"
    EMAIL_TRANSPORT_DEFAULT_TLS: "true"
    KUBECTL_DOWNLOAD_CMD: "curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl\""
    PASSBOLT_JWT_SERVER_KEY: "/var/www/passbolt/config/jwt/jwt.key"
    PASSBOLT_JWT_SERVER_PEM: "/var/www/passbolt/config/jwt/jwt.pem"
    PASSBOLT_KEY_EMAIL: "passbolt@yourdomain.com"
    PASSBOLT_LEGAL_PRIVACYPOLICYURL: "https://www.passbolt.com/privacy"
    PASSBOLT_PLUGINS_JWT_AUTHENTICATION_ENABLED: "true"
    PASSBOLT_PLUGINS_LICENSE_LICENSE: "/etc/passbolt/subscription_key.txt"
    PASSBOLT_REGISTRATION_PUBLIC: "true"
    PASSBOLT_SELENIUM_ACTIVE: "false"
    PASSBOLT_SSL_FORCE: "true"
---
# Source: passbolt/templates/rbac.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: release-name-passbolt-role-create-gpg-keys
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: create-gpg-keys
    app.kubernetes.io/type: role
rules:
- apiGroups: [""]
  resources: [ "configmaps", "secrets" ]
  resourceNames:
  - release-name-passbolt-cm-env
  - release-name-passbolt-sec-gpg
  - release-name-passbolt-sec-env
  - release-name-passbolt-sec-redis-proxy
  verbs: ["get", "patch"]
---
# Source: passbolt/templates/rbac.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: release-name-passbolt-role-create-jwt-keys
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: create-jwt-keys
    app.kubernetes.io/type: role
rules:
- apiGroups: [""]
  resources: [ "configmaps", "secrets" ]
  resourceNames:
  - release-name-passbolt-cm-env
  - release-name-passbolt-sec-jwt
  - release-name-passbolt-sec-env
  - release-name-passbolt-sec-redis-proxy
  verbs: ["get", "patch"]
---
# Source: passbolt/templates/rbac.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: release-name-passbolt-rolebind-create-gpg-keys
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: create-gpg-keys
    app.kubernetes.io/type: rolebind
subjects:
- kind: ServiceAccount
  name: release-name-passbolt-sa-create-gpg-keys
roleRef:
  kind: Role
  name: release-name-passbolt-role-create-gpg-keys
  apiGroup: rbac.authorization.k8s.io
---
# Source: passbolt/templates/rbac.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: release-name-passbolt-rolebind-create-jwt-keys
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/action: create-jwt-keys
    app.kubernetes.io/type: rolebind
subjects:
- kind: ServiceAccount
  name: release-name-passbolt-sa-create-jwt-keys
roleRef:
  kind: Role
  name: release-name-passbolt-role-create-jwt-keys
  apiGroup: rbac.authorization.k8s.io
---
# Source: passbolt/templates/job-create-gpg.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: release-name-passbolt-job-create-gpg-keys
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/action: create-gpg-keys
    app.kubernetes.io/type: job
  annotations:
    helm.sh/hook: pre-install
    helm.sh/hook-weight: "0"
spec:
  template:
    metadata:
      labels:
        app.kubernetes.io/action: create-gpg-keys
        app.kubernetes.io/type: job
    spec:
      
      serviceAccountName: release-name-passbolt-sa-create-gpg-keys
      restartPolicy: OnFailure
      containers:
        - name: create-gpg-keys
          image: passbolt/passbolt:4.6.2-1-ce
          imagePullPolicy: IfNotPresent
          command:
            - "/bin/bash"
          args:
            - "-c"
            - |
              set -e
              key_email="${PASSBOLT_KEY_EMAIL:-passbolt@yourdomain.com}"
              key_name="${PASSBOLT_KEY_NAME:-Passbolt default user}"
              key_length="${PASSBOLT_KEY_LENGTH:-3072}"
              subkey_length="${PASSBOLT_SUBKEY_LENGTH:-4096}"
              expiration="${PASSBOLT_KEY_EXPIRATION:-0}"
              su -c "gpg --homedir $GNUPGHOME --batch --no-tty --gen-key <<EOF
                Key-Type: default
                Key-Length: $key_length
                Subkey-Type: default
                Subkey-Length: $subkey_length
                Name-Real: $key_name
                Name-Email: $key_email
                Expire-Date: $expiration
                %no-protection
                %commit
              EOF" -ls /bin/bash www-data || \
              gpg --homedir $GNUPGHOME --batch --no-tty --gen-key <<EOF
                Key-Type: default
                Key-Length: $key_length
                Subkey-Type: default
                Subkey-Length: $subkey_length
                Name-Real: $key_name
                Name-Email: $key_email
                Expire-Date: $expiration
                %no-protection
                %commit
              EOF

              PRIVATE_SERVERKEY="$(gpg --homedir $GNUPGHOME --armor --export-secret-keys $key_email | base64 -w0)"
              PUBLIC_SERVERKEY="$(gpg --homedir $GNUPGHOME --armor --export $key_email | base64 -w0)"

              cd /tmp
              cpuArch=${CPU_ARCH:-$(eval "case `uname -m` in 'x86_64') echo 'amd64';;'aarch64') echo 'arm64';;esac")}
              kubectlDownload=${KUBECTL_DOWNLOAD_CMD:-'curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/${cpuArch}/kubectl"'}
              eval $kubectlDownload
              chmod +x kubectl
              ./kubectl patch secret release-name-passbolt-sec-gpg --type='json' -p='[{"op": "replace", "path" : "/data/serverkey_private.asc", "value" : '"${PRIVATE_SERVERKEY}"'}]'
              ./kubectl patch secret release-name-passbolt-sec-gpg --type='json' -p='[{"op": "replace", "path" : "/data/serverkey.asc", "value" : '"${PUBLIC_SERVERKEY}"'}]'
              touch /tmp/pod/success
              echo "Success"
          env:
            - name: DATASOURCES_DEFAULT_HOST
              value: "release-name-mariadb-primary"
          envFrom:
            - configMapRef:
                name: release-name-passbolt-cm-env
            - secretRef:
                name: release-name-passbolt-sec-env
          volumeMounts:
            - name: vol-success
              mountPath: /tmp/pod
      volumes:
        - name: vol-success
          emptyDir: {}
---
# Source: passbolt/templates/job-create-jwt.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: release-name-passbolt-job-create-jwt-keys
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/action: create-jwt-keys
    app.kubernetes.io/type: job
  annotations:
    helm.sh/hook: pre-install
    helm.sh/hook-weight: "0"
spec:
  template:
    metadata:
      labels:
        app.kubernetes.io/action: create-jwt-keys
        app.kubernetes.io/type: job
    spec:
      
      serviceAccountName: release-name-passbolt-sa-create-jwt-keys
      restartPolicy: OnFailure
      containers:
        - name: create-jwt-keys
          image: passbolt/passbolt:4.6.2-1-ce
          imagePullPolicy: IfNotPresent
          command:
            - "/bin/bash"
          args:
            - "-c"
            - |
              set -e

              /usr/share/php/passbolt/bin/cake passbolt create_jwt_keys
              PRIVATE_JWT_KEY="$(cat /etc/passbolt/jwt/jwt.key | base64 -w0 )"
              PUBLIC_JWT_KEY="$(cat /etc/passbolt/jwt/jwt.pem | base64 -w0 )"

              cd /tmp
              cpuArch=${CPU_ARCH:-$(eval "case `uname -m` in 'x86_64') echo 'amd64';;'aarch64') echo 'arm64';;esac")}
              kubectlDownload=${KUBECTL_DOWNLOAD_CMD:-'curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/${cpuArch}/kubectl"'}
              eval $kubectlDownload
              chmod +x kubectl
              ./kubectl patch secret release-name-passbolt-sec-jwt --type='json' -p='[{"op": "replace", "path" : "/data/jwt.key", "value" : '"${PRIVATE_JWT_KEY}"'}]'
              ./kubectl patch secret release-name-passbolt-sec-jwt --type='json' -p='[{"op": "replace", "path" : "/data/jwt.pem", "value" : '"${PUBLIC_JWT_KEY}"'}]'
              touch /tmp/pod/success
              echo "Success"
          env:
            - name: DATASOURCES_DEFAULT_HOST
              value: "release-name-mariadb-primary"
          envFrom:
            - configMapRef:
                name: release-name-passbolt-cm-env
            - secretRef:
                name: release-name-passbolt-sec-env
          volumeMounts:
            - name: vol-success
              mountPath: /tmp/pod
      volumes:
        - name: vol-success
          emptyDir: {}
