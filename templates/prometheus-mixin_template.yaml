---
# Source: prometheus-mixin/templates/configmap-dashboards.yaml
apiVersion: v1
kind: ConfigMapList
items:
- apiVersion: v1
  kind: ConfigMap
  metadata:
    name: dashboard-prometheus-mixin-prometheus-remote-write
    namespace: default
    annotations:
      grafana-folder: monitoring      
      a8r.io/description: Monitoring Mixin for Prometheus
      a8r.io/owner: portefaix
      a8r.io/bugs: https://github.com/portefaix/portefaix-hub/issues
      a8r.io/documentation: https://artifacthub.io/packages/helm/portefaix-hub/prometheus-mixin
      a8r.io/repository: https://github.com/portefaix/portefaix-hub
      a8r.io/support: https://github.com/portefaix/portefaix-hub/issues
    labels:
      grafana-dashboard: prometheus-remote-write      
      helm.sh/chart: prometheus-mixin-1.4.0
      app.kubernetes.io/name: prometheus-mixin
      app.kubernetes.io/instance: release-name
      app.kubernetes.io/version: "2.48.0"
      app.kubernetes.io/component: monitoring-mixin
      app.kubernetes.io/part-of: prometheus-mixin
      app.kubernetes.io/managed-by: Helm
  data:
    prometheus-remote-write.json: |-
      {
          "__inputs": [],
          "__requires": [],
          "annotations": {
              "list": []
          },
          "editable": true,
          "gnetId": null,
          "graphTooltip": 0,
          "hideControls": false,
          "id": null,
          "links": [],
          "refresh": "60s",
          "rows": [
              {
                  "collapse": false,
                  "collapsed": false,
                  "panels": [
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 2,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 6,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "(\n  prometheus_remote_storage_highest_timestamp_in_seconds{cluster=~\"$cluster\", instance=~\"$instance\"} \n-  \n  ignoring(remote_name, url) group_right(instance) (prometheus_remote_storage_queue_highest_sent_timestamp_seconds{cluster=~\"$cluster\", instance=~\"$instance\"} != 0)\n)\n",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Highest Timestamp In vs. Highest Timestamp Sent",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      },
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 3,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 6,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "clamp_min(\n  rate(prometheus_remote_storage_highest_timestamp_in_seconds{cluster=~\"$cluster\", instance=~\"$instance\"}[5m])  \n- \n  ignoring (remote_name, url) group_right(instance) rate(prometheus_remote_storage_queue_highest_sent_timestamp_seconds{cluster=~\"$cluster\", instance=~\"$instance\"}[5m])\n, 0)\n",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Rate[5m]",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      }
                  ],
                  "repeat": null,
                  "repeatIteration": null,
                  "repeatRowId": null,
                  "showTitle": true,
                  "title": "Timestamps",
                  "titleSize": "h6",
                  "type": "row"
              },
              {
                  "collapse": false,
                  "collapsed": false,
                  "panels": [
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 4,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 12,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "rate(\n  prometheus_remote_storage_samples_in_total{cluster=~\"$cluster\", instance=~\"$instance\"}[5m])\n- \n  ignoring(remote_name, url) group_right(instance) (rate(prometheus_remote_storage_succeeded_samples_total{cluster=~\"$cluster\", instance=~\"$instance\"}[5m]) or rate(prometheus_remote_storage_samples_total{cluster=~\"$cluster\", instance=~\"$instance\"}[5m]))\n- \n  (rate(prometheus_remote_storage_dropped_samples_total{cluster=~\"$cluster\", instance=~\"$instance\"}[5m]) or rate(prometheus_remote_storage_samples_dropped_total{cluster=~\"$cluster\", instance=~\"$instance\"}[5m]))\n",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Rate, in vs. succeeded or dropped [5m]",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      }
                  ],
                  "repeat": null,
                  "repeatIteration": null,
                  "repeatRowId": null,
                  "showTitle": true,
                  "title": "Samples",
                  "titleSize": "h6",
                  "type": "row"
              },
              {
                  "collapse": false,
                  "collapsed": false,
                  "panels": [
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 5,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "minSpan": 6,
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 12,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "prometheus_remote_storage_shards{cluster=~\"$cluster\", instance=~\"$instance\"}",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Current Shards",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      },
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 6,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 4,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "prometheus_remote_storage_shards_max{cluster=~\"$cluster\", instance=~\"$instance\"}",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Max Shards",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      },
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 7,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 4,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "prometheus_remote_storage_shards_min{cluster=~\"$cluster\", instance=~\"$instance\"}",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Min Shards",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      },
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 8,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 4,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "prometheus_remote_storage_shards_desired{cluster=~\"$cluster\", instance=~\"$instance\"}",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Desired Shards",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      }
                  ],
                  "repeat": null,
                  "repeatIteration": null,
                  "repeatRowId": null,
                  "showTitle": true,
                  "title": "Shards",
                  "titleSize": "h6",
                  "type": "row"
              },
              {
                  "collapse": false,
                  "collapsed": false,
                  "panels": [
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 9,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 6,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "prometheus_remote_storage_shard_capacity{cluster=~\"$cluster\", instance=~\"$instance\"}",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Shard Capacity",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      },
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 10,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 6,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "prometheus_remote_storage_pending_samples{cluster=~\"$cluster\", instance=~\"$instance\"} or prometheus_remote_storage_samples_pending{cluster=~\"$cluster\", instance=~\"$instance\"}",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Pending Samples",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      }
                  ],
                  "repeat": null,
                  "repeatIteration": null,
                  "repeatRowId": null,
                  "showTitle": true,
                  "title": "Shard Details",
                  "titleSize": "h6",
                  "type": "row"
              },
              {
                  "collapse": false,
                  "collapsed": false,
                  "panels": [
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 11,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 6,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "prometheus_tsdb_wal_segment_current{cluster=~\"$cluster\", instance=~\"$instance\"}",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "TSDB Current Segment",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "none",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      },
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 12,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 6,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "prometheus_wal_watcher_current_segment{cluster=~\"$cluster\", instance=~\"$instance\"}",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}} {{consumer}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Remote Write Current Segment",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "none",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      }
                  ],
                  "repeat": null,
                  "repeatIteration": null,
                  "repeatRowId": null,
                  "showTitle": true,
                  "title": "Segments",
                  "titleSize": "h6",
                  "type": "row"
              },
              {
                  "collapse": false,
                  "collapsed": false,
                  "panels": [
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 13,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 3,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "rate(prometheus_remote_storage_dropped_samples_total{cluster=~\"$cluster\", instance=~\"$instance\"}[5m]) or rate(prometheus_remote_storage_samples_dropped_total{cluster=~\"$cluster\", instance=~\"$instance\"}[5m])",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Dropped Samples",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      },
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 14,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 3,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "rate(prometheus_remote_storage_failed_samples_total{cluster=~\"$cluster\", instance=~\"$instance\"}[5m]) or rate(prometheus_remote_storage_samples_failed_total{cluster=~\"$cluster\", instance=~\"$instance\"}[5m])",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Failed Samples",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      },
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 15,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 3,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "rate(prometheus_remote_storage_retried_samples_total{cluster=~\"$cluster\", instance=~\"$instance\"}[5m]) or rate(prometheus_remote_storage_samples_retried_total{cluster=~\"$cluster\", instance=~\"$instance\"}[5m])",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Retried Samples",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      },
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "fillGradient": 0,
                          "gridPos": {},
                          "id": 16,
                          "legend": {
                              "alignAsTable": false,
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "rightSide": false,
                              "show": true,
                              "sideWidth": null,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "repeat": null,
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 3,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "rate(prometheus_remote_storage_enqueue_retries_total{cluster=~\"$cluster\", instance=~\"$instance\"}[5m])",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}",
                                  "refId": "A"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Enqueue Retries",
                          "tooltip": {
                              "shared": true,
                              "sort": 0,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": true
                              }
                          ]
                      }
                  ],
                  "repeat": null,
                  "repeatIteration": null,
                  "repeatRowId": null,
                  "showTitle": true,
                  "title": "Misc. Rates",
                  "titleSize": "h6",
                  "type": "row"
              }
          ],
          "schemaVersion": 14,
          "style": "dark",
          "tags": [
              "prometheus-mixin",
              "portefaix"
          ],
          "templating": {
              "list": [
                  {
                      "hide": 0,
                      "label": null,
                      "name": "datasource",
                      "options": [],
                      "query": "prometheus",
                      "refresh": 1,
                      "regex": "",
                      "type": "datasource"
                  },
                  {
                      "allValue": null,
                      "current": {
                          "text": {
                              "selected": true,
                              "text": "All",
                              "value": "$__all"
                          },
                          "value": {
                              "selected": true,
                              "text": "All",
                              "value": "$__all"
                          }
                      },
                      "datasource": "$datasource",
                      "hide": 0,
                      "includeAll": true,
                      "label": null,
                      "multi": false,
                      "name": "cluster",
                      "options": [],
                      "query": "label_values(prometheus_build_info, cluster)",
                      "refresh": 2,
                      "regex": "",
                      "sort": 0,
                      "tagValuesQuery": "",
                      "tags": [],
                      "tagsQuery": "",
                      "type": "query",
                      "useTags": false
                  },
                  {
                      "allValue": null,
                      "current": {
                          "text": {
                              "selected": true,
                              "text": "All",
                              "value": "$__all"
                          },
                          "value": {
                              "selected": true,
                              "text": "All",
                              "value": "$__all"
                          }
                      },
                      "datasource": "$datasource",
                      "hide": 0,
                      "includeAll": true,
                      "label": null,
                      "multi": false,
                      "name": "instance",
                      "options": [],
                      "query": "label_values(prometheus_build_info{cluster=~\"$cluster\"}, instance)",
                      "refresh": 2,
                      "regex": "",
                      "sort": 0,
                      "tagValuesQuery": "",
                      "tags": [],
                      "tagsQuery": "",
                      "type": "query",
                      "useTags": false
                  },
                  {
                      "allValue": null,
                      "current": {},
                      "datasource": "$datasource",
                      "hide": 0,
                      "includeAll": true,
                      "label": null,
                      "multi": false,
                      "name": "url",
                      "options": [],
                      "query": "label_values(prometheus_remote_storage_shards{cluster=~\"$cluster\", instance=~\"$instance\"}, url)",
                      "refresh": 2,
                      "regex": "",
                      "sort": 0,
                      "tagValuesQuery": "",
                      "tags": [],
                      "tagsQuery": "",
                      "type": "query",
                      "useTags": false
                  }
              ]
          },
          "time": {
              "from": "now-6h",
              "to": "now"
          },
          "timepicker": {
              "refresh_intervals": [
                  "5s",
                  "10s",
                  "30s",
                  "1m",
                  "5m",
                  "15m",
                  "30m",
                  "1h",
                  "2h",
                  "1d"
              ],
              "time_options": [
                  "5m",
                  "15m",
                  "1h",
                  "6h",
                  "12h",
                  "24h",
                  "2d",
                  "7d",
                  "30d"
              ]
          },
          "timezone": "browser",
          "title": "Prometheus / Remote Write",
          "version": 0
      }
- apiVersion: v1
  kind: ConfigMap
  metadata:
    name: dashboard-prometheus-mixin-prometheus
    namespace: default
    annotations:
      grafana-folder: monitoring      
      a8r.io/description: Monitoring Mixin for Prometheus
      a8r.io/owner: portefaix
      a8r.io/bugs: https://github.com/portefaix/portefaix-hub/issues
      a8r.io/documentation: https://artifacthub.io/packages/helm/portefaix-hub/prometheus-mixin
      a8r.io/repository: https://github.com/portefaix/portefaix-hub
      a8r.io/support: https://github.com/portefaix/portefaix-hub/issues
    labels:
      grafana-dashboard: prometheus      
      helm.sh/chart: prometheus-mixin-1.4.0
      app.kubernetes.io/name: prometheus-mixin
      app.kubernetes.io/instance: release-name
      app.kubernetes.io/version: "2.48.0"
      app.kubernetes.io/component: monitoring-mixin
      app.kubernetes.io/part-of: prometheus-mixin
      app.kubernetes.io/managed-by: Helm
  data:
    prometheus.json: |-
      {
          "annotations": {
              "list": []
          },
          "editable": true,
          "gnetId": null,
          "graphTooltip": 0,
          "hideControls": false,
          "links": [],
          "refresh": "60s",
          "rows": [
              {
                  "collapse": false,
                  "height": "250px",
                  "panels": [
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "id": 1,
                          "legend": {
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "show": true,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null as zero",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 12,
                          "stack": false,
                          "steppedLine": false,
                          "styles": [
                              {
                                  "alias": "Time",
                                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                                  "pattern": "Time",
                                  "type": "hidden"
                              },
                              {
                                  "alias": "Count",
                                  "colorMode": null,
                                  "colors": [],
                                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                                  "decimals": 2,
                                  "link": false,
                                  "linkTargetBlank": false,
                                  "linkTooltip": "Drill down",
                                  "linkUrl": "",
                                  "pattern": "Value #A",
                                  "thresholds": [],
                                  "type": "hidden",
                                  "unit": "short"
                              },
                              {
                                  "alias": "Uptime",
                                  "colorMode": null,
                                  "colors": [],
                                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                                  "decimals": 2,
                                  "link": false,
                                  "linkTargetBlank": false,
                                  "linkTooltip": "Drill down",
                                  "linkUrl": "",
                                  "pattern": "Value #B",
                                  "thresholds": [],
                                  "type": "number",
                                  "unit": "s"
                              },
                              {
                                  "alias": "Instance",
                                  "colorMode": null,
                                  "colors": [],
                                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                                  "decimals": 2,
                                  "link": false,
                                  "linkTargetBlank": false,
                                  "linkTooltip": "Drill down",
                                  "linkUrl": "",
                                  "pattern": "instance",
                                  "thresholds": [],
                                  "type": "number",
                                  "unit": "short"
                              },
                              {
                                  "alias": "Job",
                                  "colorMode": null,
                                  "colors": [],
                                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                                  "decimals": 2,
                                  "link": false,
                                  "linkTargetBlank": false,
                                  "linkTooltip": "Drill down",
                                  "linkUrl": "",
                                  "pattern": "job",
                                  "thresholds": [],
                                  "type": "number",
                                  "unit": "short"
                              },
                              {
                                  "alias": "Version",
                                  "colorMode": null,
                                  "colors": [],
                                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                                  "decimals": 2,
                                  "link": false,
                                  "linkTargetBlank": false,
                                  "linkTooltip": "Drill down",
                                  "linkUrl": "",
                                  "pattern": "version",
                                  "thresholds": [],
                                  "type": "number",
                                  "unit": "short"
                              },
                              {
                                  "alias": "",
                                  "colorMode": null,
                                  "colors": [],
                                  "dateFormat": "YYYY-MM-DD HH:mm:ss",
                                  "decimals": 2,
                                  "pattern": "/.*/",
                                  "thresholds": [],
                                  "type": "string",
                                  "unit": "short"
                              }
                          ],
                          "targets": [
                              {
                                  "expr": "count by (job, instance, version) (prometheus_build_info{job=~\"$job\", instance=~\"$instance\"})",
                                  "format": "table",
                                  "instant": true,
                                  "intervalFactor": 2,
                                  "legendFormat": "",
                                  "refId": "A"
                              },
                              {
                                  "expr": "max by (job, instance) (time() - process_start_time_seconds{job=~\"$job\", instance=~\"$instance\"})",
                                  "format": "table",
                                  "instant": true,
                                  "intervalFactor": 2,
                                  "legendFormat": "",
                                  "refId": "B"
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Prometheus Stats",
                          "tooltip": {
                              "shared": true,
                              "sort": 2,
                              "value_type": "individual"
                          },
                          "transform": "table",
                          "type": "table",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": 0,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": false
                              }
                          ]
                      }
                  ],
                  "repeat": null,
                  "repeatIteration": null,
                  "repeatRowId": null,
                  "showTitle": true,
                  "title": "Prometheus Stats",
                  "titleSize": "h6"
              },
              {
                  "collapse": false,
                  "height": "250px",
                  "panels": [
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "id": 2,
                          "legend": {
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "show": true,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null as zero",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 6,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "sum(rate(prometheus_target_sync_length_seconds_sum{job=~\"$job\",instance=~\"$instance\"}[5m])) by (scrape_job) * 1e3",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{scrape_job}}",
                                  "legendLink": null
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Target Sync",
                          "tooltip": {
                              "shared": true,
                              "sort": 2,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "ms",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": 0,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": false
                              }
                          ]
                      },
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 10,
                          "id": 3,
                          "legend": {
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "show": true,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 0,
                          "links": [],
                          "nullPointMode": "null as zero",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 6,
                          "stack": true,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "sum(prometheus_sd_discovered_targets{job=~\"$job\",instance=~\"$instance\"})",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "Targets",
                                  "legendLink": null
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Targets",
                          "tooltip": {
                              "shared": true,
                              "sort": 2,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": 0,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": false
                              }
                          ]
                      }
                  ],
                  "repeat": null,
                  "repeatIteration": null,
                  "repeatRowId": null,
                  "showTitle": true,
                  "title": "Discovery",
                  "titleSize": "h6"
              },
              {
                  "collapse": false,
                  "height": "250px",
                  "panels": [
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 1,
                          "id": 4,
                          "legend": {
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "show": true,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 1,
                          "links": [],
                          "nullPointMode": "null as zero",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 4,
                          "stack": false,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "rate(prometheus_target_interval_length_seconds_sum{job=~\"$job\",instance=~\"$instance\"}[5m]) / rate(prometheus_target_interval_length_seconds_count{job=~\"$job\",instance=~\"$instance\"}[5m]) * 1e3",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{interval}} configured",
                                  "legendLink": null
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Average Scrape Interval Duration",
                          "tooltip": {
                              "shared": true,
                              "sort": 2,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "ms",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": 0,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": false
                              }
                          ]
                      },
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 10,
                          "id": 5,
                          "legend": {
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "show": true,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 0,
                          "links": [],
                          "nullPointMode": "null as zero",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 4,
                          "stack": true,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "sum by (job) (rate(prometheus_target_scrapes_exceeded_body_size_limit_total[1m]))",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "exceeded body size limit: {{job}}",
                                  "legendLink": null
                              },
                              {
                                  "expr": "sum by (job) (rate(prometheus_target_scrapes_exceeded_sample_limit_total[1m]))",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "exceeded sample limit: {{job}}",
                                  "legendLink": null
                              },
                              {
                                  "expr": "sum by (job) (rate(prometheus_target_scrapes_sample_duplicate_timestamp_total[1m]))",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "duplicate timestamp: {{job}}",
                                  "legendLink": null
                              },
                              {
                                  "expr": "sum by (job) (rate(prometheus_target_scrapes_sample_out_of_bounds_total[1m]))",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "out of bounds: {{job}}",
                                  "legendLink": null
                              },
                              {
                                  "expr": "sum by (job) (rate(prometheus_target_scrapes_sample_out_of_order_total[1m]))",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "out of order: {{job}}",
                                  "legendLink": null
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Scrape failures",
                          "tooltip": {
                              "shared": true,
                              "sort": 2,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": 0,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": false
                              }
                          ]
                      },
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 10,
                          "id": 6,
                          "legend": {
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "show": true,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 0,
                          "links": [],
                          "nullPointMode": "null as zero",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 4,
                          "stack": true,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "rate(prometheus_tsdb_head_samples_appended_total{job=~\"$job\",instance=~\"$instance\"}[5m])",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{job}} {{instance}}",
                                  "legendLink": null
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Appended Samples",
                          "tooltip": {
                              "shared": true,
                              "sort": 2,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": 0,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": false
                              }
                          ]
                      }
                  ],
                  "repeat": null,
                  "repeatIteration": null,
                  "repeatRowId": null,
                  "showTitle": true,
                  "title": "Retrieval",
                  "titleSize": "h6"
              },
              {
                  "collapse": false,
                  "height": "250px",
                  "panels": [
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 10,
                          "id": 7,
                          "legend": {
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "show": true,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 0,
                          "links": [],
                          "nullPointMode": "null as zero",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 6,
                          "stack": true,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "prometheus_tsdb_head_series{job=~\"$job\",instance=~\"$instance\"}",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{job}} {{instance}} head series",
                                  "legendLink": null
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Head Series",
                          "tooltip": {
                              "shared": true,
                              "sort": 2,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": 0,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": false
                              }
                          ]
                      },
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 10,
                          "id": 8,
                          "legend": {
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "show": true,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 0,
                          "links": [],
                          "nullPointMode": "null as zero",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 6,
                          "stack": true,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "prometheus_tsdb_head_chunks{job=~\"$job\",instance=~\"$instance\"}",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{job}} {{instance}} head chunks",
                                  "legendLink": null
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Head Chunks",
                          "tooltip": {
                              "shared": true,
                              "sort": 2,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": 0,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": false
                              }
                          ]
                      }
                  ],
                  "repeat": null,
                  "repeatIteration": null,
                  "repeatRowId": null,
                  "showTitle": true,
                  "title": "Storage",
                  "titleSize": "h6"
              },
              {
                  "collapse": false,
                  "height": "250px",
                  "panels": [
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 10,
                          "id": 9,
                          "legend": {
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "show": true,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 0,
                          "links": [],
                          "nullPointMode": "null as zero",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 6,
                          "stack": true,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "rate(prometheus_engine_query_duration_seconds_count{job=~\"$job\",instance=~\"$instance\",slice=\"inner_eval\"}[5m])",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{job}} {{instance}}",
                                  "legendLink": null
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Query Rate",
                          "tooltip": {
                              "shared": true,
                              "sort": 2,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": 0,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": false
                              }
                          ]
                      },
                      {
                          "aliasColors": {},
                          "bars": false,
                          "dashLength": 10,
                          "dashes": false,
                          "datasource": "$datasource",
                          "fill": 10,
                          "id": 10,
                          "legend": {
                              "avg": false,
                              "current": false,
                              "max": false,
                              "min": false,
                              "show": true,
                              "total": false,
                              "values": false
                          },
                          "lines": true,
                          "linewidth": 0,
                          "links": [],
                          "nullPointMode": "null as zero",
                          "percentage": false,
                          "pointradius": 5,
                          "points": false,
                          "renderer": "flot",
                          "seriesOverrides": [],
                          "spaceLength": 10,
                          "span": 6,
                          "stack": true,
                          "steppedLine": false,
                          "targets": [
                              {
                                  "expr": "max by (slice) (prometheus_engine_query_duration_seconds{quantile=\"0.9\",job=~\"$job\",instance=~\"$instance\"}) * 1e3",
                                  "format": "time_series",
                                  "intervalFactor": 2,
                                  "legendFormat": "{{slice}}",
                                  "legendLink": null
                              }
                          ],
                          "thresholds": [],
                          "timeFrom": null,
                          "timeShift": null,
                          "title": "Stage Duration",
                          "tooltip": {
                              "shared": true,
                              "sort": 2,
                              "value_type": "individual"
                          },
                          "type": "graph",
                          "xaxis": {
                              "buckets": null,
                              "mode": "time",
                              "name": null,
                              "show": true,
                              "values": []
                          },
                          "yaxes": [
                              {
                                  "format": "ms",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": 0,
                                  "show": true
                              },
                              {
                                  "format": "short",
                                  "label": null,
                                  "logBase": 1,
                                  "max": null,
                                  "min": null,
                                  "show": false
                              }
                          ]
                      }
                  ],
                  "repeat": null,
                  "repeatIteration": null,
                  "repeatRowId": null,
                  "showTitle": true,
                  "title": "Query",
                  "titleSize": "h6"
              }
          ],
          "schemaVersion": 14,
          "style": "dark",
          "tags": [
              "prometheus-mixin",
              "portefaix"
          ],
          "templating": {
              "list": [
                  {
                      "current": {
                          "text": "default",
                          "value": "default"
                      },
                      "hide": 0,
                      "label": "Data Source",
                      "name": "datasource",
                      "options": [],
                      "query": "prometheus",
                      "refresh": 1,
                      "regex": "",
                      "type": "datasource"
                  },
                  {
                      "allValue": ".+",
                      "current": {
                          "selected": true,
                          "text": "All",
                          "value": "$__all"
                      },
                      "datasource": "$datasource",
                      "hide": 0,
                      "includeAll": true,
                      "label": "job",
                      "multi": true,
                      "name": "job",
                      "options": [],
                      "query": "label_values(prometheus_build_info{job=\"prometheus\"}, job)",
                      "refresh": 1,
                      "regex": "",
                      "sort": 2,
                      "tagValuesQuery": "",
                      "tags": [],
                      "tagsQuery": "",
                      "type": "query",
                      "useTags": false
                  },
                  {
                      "allValue": ".+",
                      "current": {
                          "selected": true,
                          "text": "All",
                          "value": "$__all"
                      },
                      "datasource": "$datasource",
                      "hide": 0,
                      "includeAll": true,
                      "label": "instance",
                      "multi": true,
                      "name": "instance",
                      "options": [],
                      "query": "label_values(prometheus_build_info{job=~\"$job\"}, instance)",
                      "refresh": 1,
                      "regex": "",
                      "sort": 2,
                      "tagValuesQuery": "",
                      "tags": [],
                      "tagsQuery": "",
                      "type": "query",
                      "useTags": false
                  }
              ]
          },
          "time": {
              "from": "now-1h",
              "to": "now"
          },
          "timepicker": {
              "refresh_intervals": [
                  "5s",
                  "10s",
                  "30s",
                  "1m",
                  "5m",
                  "15m",
                  "30m",
                  "1h",
                  "2h",
                  "1d"
              ],
              "time_options": [
                  "5m",
                  "15m",
                  "1h",
                  "6h",
                  "12h",
                  "24h",
                  "2d",
                  "7d",
                  "30d"
              ]
          },
          "timezone": "utc",
          "title": "Prometheus / Overview",
          "uid": "",
          "version": 0
      }
---
# Source: prometheus-mixin/templates/alerts.yaml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: release-name-prometheus-mixin-alerts
  namespace: default
  annotations:    
    a8r.io/description: Monitoring Mixin for Prometheus
    a8r.io/owner: portefaix
    a8r.io/bugs: https://github.com/portefaix/portefaix-hub/issues
    a8r.io/documentation: https://artifacthub.io/packages/helm/portefaix-hub/prometheus-mixin
    a8r.io/repository: https://github.com/portefaix/portefaix-hub
    a8r.io/support: https://github.com/portefaix/portefaix-hub/issues
  labels:    
    helm.sh/chart: prometheus-mixin-1.4.0
    app.kubernetes.io/name: prometheus-mixin
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2.48.0"
    app.kubernetes.io/component: monitoring-mixin
    app.kubernetes.io/part-of: prometheus-mixin
    app.kubernetes.io/managed-by: Helm
spec:
  groups:
      - name: prometheus
        rules:
          - alert: PrometheusBadConfig
            annotations:
              description: Prometheus {{.instance}} has failed to reload its configuration.
              summary: Failed Prometheus configuration reload.
            expr: |
              # Without max_over_time, failed scrapes could create false negatives, see
              # https://www.robustperception.io/alerting-on-gauges-in-prometheus-2-0 for details.
              max_over_time(prometheus_config_last_reload_successful{job="prometheus"}[5m]) == 0
            for: 10m
            labels:
              severity: critical
          - alert: PrometheusSDRefreshFailure
            annotations:
              description: Prometheus {{.instance}} has failed to refresh SD with mechanism {{$labels.mechanism}}.
              summary: Failed Prometheus SD refresh.
            expr: |
              increase(prometheus_sd_refresh_failures_total{job="prometheus"}[10m]) > 0
            for: 20m
            labels:
              severity: warning
          - alert: PrometheusNotificationQueueRunningFull
            annotations:
              description: Alert notification queue of Prometheus {{.instance}} is running full.
              summary: Prometheus alert notification queue predicted to run full in less than 30m.
            expr: |
              # Without min_over_time, failed scrapes could create false negatives, see
              # https://www.robustperception.io/alerting-on-gauges-in-prometheus-2-0 for details.
              (
                predict_linear(prometheus_notifications_queue_length{job="prometheus"}[5m], 60 * 30)
              >
                min_over_time(prometheus_notifications_queue_capacity{job="prometheus"}[5m])
              )
            for: 15m
            labels:
              severity: warning
          - alert: PrometheusErrorSendingAlertsToSomeAlertmanagers
            annotations:
              description: '{{ printf "%.1f" $value }}% errors while sending alerts from Prometheus {{.instance}} to Alertmanager {{$labels.alertmanager}}.'
              summary: Prometheus has encountered more than 1% errors sending alerts to a specific Alertmanager.
            expr: |
              (
                rate(prometheus_notifications_errors_total{job="prometheus"}[5m])
              /
                rate(prometheus_notifications_sent_total{job="prometheus"}[5m])
              )
              * 100
              > 1
            for: 15m
            labels:
              severity: warning
          - alert: PrometheusNotConnectedToAlertmanagers
            annotations:
              description: Prometheus {{.instance}} is not connected to any Alertmanagers.
              summary: Prometheus is not connected to any Alertmanagers.
            expr: |
              # Without max_over_time, failed scrapes could create false negatives, see
              # https://www.robustperception.io/alerting-on-gauges-in-prometheus-2-0 for details.
              max_over_time(prometheus_notifications_alertmanagers_discovered{job="prometheus"}[5m]) < 1
            for: 10m
            labels:
              severity: warning
          - alert: PrometheusTSDBReloadsFailing
            annotations:
              description: Prometheus {{.instance}} has detected {{$value | humanize}} reload failures over the last 3h.
              summary: Prometheus has issues reloading blocks from disk.
            expr: |
              increase(prometheus_tsdb_reloads_failures_total{job="prometheus"}[3h]) > 0
            for: 4h
            labels:
              severity: warning
          - alert: PrometheusTSDBCompactionsFailing
            annotations:
              description: Prometheus {{.instance}} has detected {{$value | humanize}} compaction failures over the last 3h.
              summary: Prometheus has issues compacting blocks.
            expr: |
              increase(prometheus_tsdb_compactions_failed_total{job="prometheus"}[3h]) > 0
            for: 4h
            labels:
              severity: warning
          - alert: PrometheusNotIngestingSamples
            annotations:
              description: Prometheus {{.instance}} is not ingesting samples.
              summary: Prometheus is not ingesting samples.
            expr: |
              (
                rate(prometheus_tsdb_head_samples_appended_total{job="prometheus"}[5m]) <= 0
              and
                (
                  sum without(scrape_job) (prometheus_target_metadata_cache_entries{job="prometheus"}) > 0
                or
                  sum without(rule_group) (prometheus_rule_group_rules{job="prometheus"}) > 0
                )
              )
            for: 10m
            labels:
              severity: warning
          - alert: PrometheusDuplicateTimestamps
            annotations:
              description: Prometheus {{.instance}} is dropping {{ printf "%.4g" $value  }} samples/s with different values but duplicated timestamp.
              summary: Prometheus is dropping samples with duplicate timestamps.
            expr: |
              rate(prometheus_target_scrapes_sample_duplicate_timestamp_total{job="prometheus"}[5m]) > 0
            for: 10m
            labels:
              severity: warning
          - alert: PrometheusOutOfOrderTimestamps
            annotations:
              description: Prometheus {{.instance}} is dropping {{ printf "%.4g" $value  }} samples/s with timestamps arriving out of order.
              summary: Prometheus drops samples with out-of-order timestamps.
            expr: |
              rate(prometheus_target_scrapes_sample_out_of_order_total{job="prometheus"}[5m]) > 0
            for: 10m
            labels:
              severity: warning
          - alert: PrometheusRemoteStorageFailures
            annotations:
              description: Prometheus {{.instance}} failed to send {{ printf "%.1f" $value }}% of the samples to {{ $labels.remote_name}}:{{ $labels.url }}
              summary: Prometheus fails to send samples to remote storage.
            expr: |
              (
                (rate(prometheus_remote_storage_failed_samples_total{job="prometheus"}[5m]) or rate(prometheus_remote_storage_samples_failed_total{job="prometheus"}[5m]))
              /
                (
                  (rate(prometheus_remote_storage_failed_samples_total{job="prometheus"}[5m]) or rate(prometheus_remote_storage_samples_failed_total{job="prometheus"}[5m]))
                +
                  (rate(prometheus_remote_storage_succeeded_samples_total{job="prometheus"}[5m]) or rate(prometheus_remote_storage_samples_total{job="prometheus"}[5m]))
                )
              )
              * 100
              > 1
            for: 15m
            labels:
              severity: critical
          - alert: PrometheusRemoteWriteBehind
            annotations:
              description: Prometheus {{.instance}} remote write is {{ printf "%.1f" $value }}s behind for {{ $labels.remote_name}}:{{ $labels.url }}.
              summary: Prometheus remote write is behind.
            expr: |
              # Without max_over_time, failed scrapes could create false negatives, see
              # https://www.robustperception.io/alerting-on-gauges-in-prometheus-2-0 for details.
              (
                max_over_time(prometheus_remote_storage_highest_timestamp_in_seconds{job="prometheus"}[5m])
              - ignoring(remote_name, url) group_right
                max_over_time(prometheus_remote_storage_queue_highest_sent_timestamp_seconds{job="prometheus"}[5m])
              )
              > 120
            for: 15m
            labels:
              severity: critical
          - alert: PrometheusRemoteWriteDesiredShards
            annotations:
              description: Prometheus {{.instance}} remote write desired shards calculation wants to run {{ $value }} shards for queue {{ $labels.remote_name}}:{{ $labels.url }}, which is more than the max of {{ printf `prometheus_remote_storage_shards_max{instance="%s",job="prometheus"}` $labels.instance | query | first | value }}.
              summary: Prometheus remote write desired shards calculation wants to run more than configured max shards.
            expr: |
              # Without max_over_time, failed scrapes could create false negatives, see
              # https://www.robustperception.io/alerting-on-gauges-in-prometheus-2-0 for details.
              (
                max_over_time(prometheus_remote_storage_shards_desired{job="prometheus"}[5m])
              >
                max_over_time(prometheus_remote_storage_shards_max{job="prometheus"}[5m])
              )
            for: 15m
            labels:
              severity: warning
          - alert: PrometheusRuleFailures
            annotations:
              description: Prometheus {{.instance}} has failed to evaluate {{ printf "%.0f" $value }} rules in the last 5m.
              summary: Prometheus is failing rule evaluations.
            expr: |
              increase(prometheus_rule_evaluation_failures_total{job="prometheus"}[5m]) > 0
            for: 15m
            labels:
              severity: critical
          - alert: PrometheusMissingRuleEvaluations
            annotations:
              description: Prometheus {{.instance}} has missed {{ printf "%.0f" $value }} rule group evaluations in the last 5m.
              summary: Prometheus is missing rule evaluations due to slow rule group evaluation.
            expr: |
              increase(prometheus_rule_group_iterations_missed_total{job="prometheus"}[5m]) > 0
            for: 15m
            labels:
              severity: warning
          - alert: PrometheusTargetLimitHit
            annotations:
              description: Prometheus {{.instance}} has dropped {{ printf "%.0f" $value }} targets because the number of targets exceeded the configured target_limit.
              summary: Prometheus has dropped targets because some scrape configs have exceeded the targets limit.
            expr: |
              increase(prometheus_target_scrape_pool_exceeded_target_limit_total{job="prometheus"}[5m]) > 0
            for: 15m
            labels:
              severity: warning
          - alert: PrometheusLabelLimitHit
            annotations:
              description: Prometheus {{.instance}} has dropped {{ printf "%.0f" $value }} targets because some samples exceeded the configured label_limit, label_name_length_limit or label_value_length_limit.
              summary: Prometheus has dropped targets because some scrape configs have exceeded the labels limit.
            expr: |
              increase(prometheus_target_scrape_pool_exceeded_label_limits_total{job="prometheus"}[5m]) > 0
            for: 15m
            labels:
              severity: warning
          - alert: PrometheusScrapeBodySizeLimitHit
            annotations:
              description: Prometheus {{.instance}} has failed {{ printf "%.0f" $value }} scrapes in the last 5m because some targets exceeded the configured body_size_limit.
              summary: Prometheus has dropped some targets that exceeded body size limit.
            expr: |
              increase(prometheus_target_scrapes_exceeded_body_size_limit_total{job="prometheus"}[5m]) > 0
            for: 15m
            labels:
              severity: warning
          - alert: PrometheusScrapeSampleLimitHit
            annotations:
              description: Prometheus {{.instance}} has failed {{ printf "%.0f" $value }} scrapes in the last 5m because some targets exceeded the configured sample_limit.
              summary: Prometheus has failed scrapes that have exceeded the configured sample limit.
            expr: |
              increase(prometheus_target_scrapes_exceeded_sample_limit_total{job="prometheus"}[5m]) > 0
            for: 15m
            labels:
              severity: warning
          - alert: PrometheusTargetSyncFailure
            annotations:
              description: '{{ printf "%.0f" $value }} targets in Prometheus {{.instance}} have failed to sync because invalid configuration was supplied.'
              summary: Prometheus has failed to sync targets.
            expr: |
              increase(prometheus_target_sync_failed_total{job="prometheus"}[30m]) > 0
            for: 5m
            labels:
              severity: critical
          - alert: PrometheusHighQueryLoad
            annotations:
              description: Prometheus {{.instance}} query API has less than 20% available capacity in its query engine for the last 15 minutes.
              summary: Prometheus is reaching its maximum capacity serving concurrent requests.
            expr: |
              avg_over_time(prometheus_engine_queries{job="prometheus"}[5m]) / max_over_time(prometheus_engine_queries_concurrent_max{job="prometheus"}[5m]) > 0.8
            for: 15m
            labels:
              severity: warning
          - alert: PrometheusErrorSendingAlertsToAnyAlertmanager
            annotations:
              description: '{{ printf "%.1f" $value }}% minimum errors while sending alerts from Prometheus {{.instance}} to any Alertmanager.'
              summary: Prometheus encounters more than 3% errors sending alerts to any Alertmanager.
            expr: |
              min without (alertmanager) (
                rate(prometheus_notifications_errors_total{job="prometheus",alertmanager!~``}[5m])
              /
                rate(prometheus_notifications_sent_total{job="prometheus",alertmanager!~``}[5m])
              )
              * 100
              > 3
            for: 15m
            labels:
              severity: critical
