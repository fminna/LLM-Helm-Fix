---
# Source: prometheus-postgres-exporter/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-prometheus-postgres-exporter-master
  labels:
    app.kubernetes.io/name: prometheus-postgres-exporter
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: "Monitoring"
    app.kubernetes.io/managed-by: Helm
    helm.sh/chart: prometheus-postgres-exporter-2.3.7
data:
  queries.yaml: |-
    ---
    pg_is_in:
      query: "SELECT CASE WHEN pg_is_in_recovery() THEN 1 ELSE 0 END AS recovery"
      master: true
      metrics:
        - recovery:
            usage: "GAUGE"
            description: "0 for master, 1 for slaves"
    
    pg_xlog:
      query: "SELECT CASE WHEN pg_is_in_recovery() THEN pg_wal_lsn_diff(pg_last_wal_replay_lsn(), '0/0') ELSE pg_wal_lsn_diff(pg_current_wal_flush_lsn(), '0/0') END AS position"
      master: true
      metrics:
        - position:
            usage: "COUNTER"
            description: "Position in the WAL"
    
    pg_replication_replay:
      master: true
      query: "SELECT client_addr, sum(coalesce(pg_wal_lsn_diff(pg_current_wal_flush_lsn(), replay_lsn), 0)) AS lag FROM pg_stat_replication WHERE state <> 'backup' group by client_addr"
      metrics:
        - lag:
            usage: "GAUGE"
            description: "Replication lag behind master in bytes"
        - client_addr:
            usage: "LABEL"
            description: "Address of client"
    
    pg_postmaster:
      query: "SELECT pg_postmaster_start_time as start_time_seconds from pg_postmaster_start_time()"
      master: true
      metrics:
        - start_time_seconds:
            usage: "GAUGE"
            description: "Time at which postmaster started"
    
    pg_wals:
      # >= 10
      query: |
        WITH ls AS (
          SELECT './pg_wal/' || pg_ls_dir AS filename, (pg_stat_file('./pg_wal/' || pg_ls_dir)).* FROM pg_ls_dir('./pg_wal/')
        )
        SELECT count(*) AS count, sum(size) AS size FROM ls WHERE NOT isdir;
      master: true
      metrics:
        - count:
            usage: "GAUGE"
            description: "Number of wal segments"
        - size:
            usage: "GAUGE"
            description: "Disk usage of wal segments"
    
    pg_archive_wals:
      # >= 10
      query: |
        WITH ls AS (
          select './pg_wal/archive_status/' || pg_ls_dir AS filename, (pg_stat_file('./pg_wal/archive_status/' || pg_ls_dir)).* from pg_ls_dir('./pg_wal/archive_status/')
        )
        SELECT (SELECT count(*) FROM ls WHERE filename LIKE '%.done') AS done, (SELECT count(*) FROM ls WHERE filename LIKE '%.ready') AS ready;
      master: true
      metrics:
        - done:
            usage: "GAUGE"
            description: "Number of wal segments archived"
        - ready:
            usage: "GAUGE"
            description: "Number of wal segments ready for archival"
    
    pg_stat_user_tables:
      query: "SELECT current_database() datname, schemaname, relname, COALESCE(seq_scan, 0) AS seq_scan, COALESCE(seq_tup_read, 0) AS seq_tup_read, COALESCE(idx_scan, 0) AS idx_scan, COALESCE(idx_tup_fetch, 0) AS idx_tup_fetch, n_tup_ins, n_tup_upd, n_tup_del, n_tup_hot_upd, n_live_tup, n_dead_tup, n_mod_since_analyze, COALESCE(last_vacuum, '1970-01-01Z'), COALESCE(last_vacuum, '1970-01-01Z') as last_vacuum, COALESCE(last_autovacuum, '1970-01-01Z') as last_autovacuum, COALESCE(last_analyze, '1970-01-01Z') as last_analyze, COALESCE(last_autoanalyze, '1970-01-01Z') as last_autoanalyze, vacuum_count, autovacuum_count, analyze_count, autoanalyze_count FROM pg_stat_user_tables"
      metrics:
        - datname:
            usage: "LABEL"
            description: "Name of current database"
        - schemaname:
            usage: "LABEL"
            description: "Name of the schema that this table is in"
        - relname:
            usage: "LABEL"
            description: "Name of this table"
        - seq_scan:
            usage: "COUNTER"
            description: "Number of sequential scans initiated on this table"
        - seq_tup_read:
            usage: "COUNTER"
            description: "Number of live rows fetched by sequential scans"
        - idx_scan:
            usage: "COUNTER"
            description: "Number of index scans initiated on this table"
        - idx_tup_fetch:
            usage: "COUNTER"
            description: "Number of live rows fetched by index scans"
        - n_tup_ins:
            usage: "COUNTER"
            description: "Number of rows inserted"
        - n_tup_upd:
            usage: "COUNTER"
            description: "Number of rows updated"
        - n_tup_del:
            usage: "COUNTER"
            description: "Number of rows deleted"
        - n_tup_hot_upd:
            usage: "COUNTER"
            description: "Number of rows HOT updated (i.e., with no separate index update required)"
        - n_live_tup:
            usage: "GAUGE"
            description: "Estimated number of live rows"
        - n_dead_tup:
            usage: "GAUGE"
            description: "Estimated number of dead rows"
        - n_mod_since_analyze:
            usage: "GAUGE"
            description: "Estimated number of rows changed since last analyze"
        - last_vacuum:
            usage: "GAUGE"
            description: "Last time at which this table was manually vacuumed (not counting VACUUM FULL)"
        - last_autovacuum:
            usage: "GAUGE"
            description: "Last time at which this table was vacuumed by the autovacuum daemon"
        - last_analyze:
            usage: "GAUGE"
            description: "Last time at which this table was manually analyzed"
        - last_autoanalyze:
            usage: "GAUGE"
            description: "Last time at which this table was analyzed by the autovacuum daemon"
        - vacuum_count:
            usage: "COUNTER"
            description: "Number of times this table has been manually vacuumed (not counting VACUUM FULL)"
        - autovacuum_count:
            usage: "COUNTER"
            description: "Number of times this table has been vacuumed by the autovacuum daemon"
        - analyze_count:
            usage: "COUNTER"
            description: "Number of times this table has been manually analyzed"
        - autoanalyze_count:
            usage: "COUNTER"
            description: "Number of times this table has been analyzed by the autovacuum daemon"
    
    pg_statio_user_tables:
      query: "SELECT current_database() datname, schemaname, relname, COALESCE(heap_blks_read, 0) AS heap_blks_read, COALESCE(heap_blks_hit, 0) AS heap_blks_hit, COALESCE(idx_blks_read, 0) AS idx_blks_read, COALESCE(idx_blks_hit, 0) AS idx_blks_hit, COALESCE(toast_blks_read, 0) AS toast_blks_read, COALESCE(toast_blks_hit, 0) AS toast_blks_hit, COALESCE(tidx_blks_read, 0) AS tidx_blks_read, COALESCE(tidx_blks_hit, 0) AS tidx_blks_hit FROM pg_statio_user_tables"
      metrics:
        - datname:
            usage: "LABEL"
            description: "Name of current database"
        - schemaname:
            usage: "LABEL"
            description: "Name of the schema that this table is in"
        - relname:
            usage: "LABEL"
            description: "Name of this table"
        - heap_blks_read:
            usage: "COUNTER"
            description: "Number of disk blocks read from this table"
        - heap_blks_hit:
            usage: "COUNTER"
            description: "Number of buffer hits in this table"
        - idx_blks_read:
            usage: "COUNTER"
            description: "Number of disk blocks read from all indexes on this table"
        - idx_blks_hit:
            usage: "COUNTER"
            description: "Number of buffer hits in all indexes on this table"
        - toast_blks_read:
            usage: "COUNTER"
            description: "Number of disk blocks read from this table's TOAST table (if any)"
        - toast_blks_hit:
            usage: "COUNTER"
            description: "Number of buffer hits in this table's TOAST table (if any)"
        - tidx_blks_read:
            usage: "COUNTER"
            description: "Number of disk blocks read from this table's TOAST table indexes (if any)"
        - tidx_blks_hit:
            usage: "COUNTER"
            description: "Number of buffer hits in this table's TOAST table indexes (if any)"
    pg_table_size:
      query: "SELECT current_database() AS datname, schemaname, relname, pg_table_size(relid) AS data_bytes, pg_indexes_size(relid) AS index_bytes FROM pg_stat_user_tables WHERE pg_total_relation_size(relid) > 100000"
      metrics:
        - datname:
            usage: "LABEL"
            description: "Name of the database"
        - schemaname:
            usage: "LABEL"
            description: "Name of the relation schema"
        - relname:
            usage: "LABEL"
            description: "Name of the relation"
        - data_bytes:
            usage: "GAUGE"
            description: "Size of relation data"
        - index_bytes:
            usage: "GAUGE"
            description: "Size of relation indexes"
    
    pg_client_connections:
      master: true
      query: "SELECT count(datname) as count, datname, usename, application_name as appname, client_addr FROM pg_stat_activity WHERE backend_type = 'client backend' GROUP BY datname, usename, client_addr, application_name"
      metrics:
        - datname:
            usage: "LABEL"
            description: "Name of the database"
        - usename:
            usage: "LABEL"
            description: "Username connected as"
        - appname:
            usage: "LABEL"
            description: "Application Name connection string"
        - client_addr:
            usage: "LABEL"
            description: "Client connection address"
        - count:
            usage: "GAUGE"
            description: "Clients connected"
    
    pg_database:
      query: "SELECT pg_database.datname, pg_database_size(pg_database.datname) as size_bytes FROM pg_database WHERE datname NOT IN ('template0', 'template1', 'azure_maintenance', 'azure_sys');"
      master: true
      metrics:
        - datname:
            usage: "LABEL"
            description: "Name of the database"
        - size_bytes:
            usage: "GAUGE"
            description: "Disk space used by the database"
    
    pg_stat_statements_most_frequent:
      query: "WITH data AS (SELECT ROW_NUMBER() OVER(PARTITION BY t3.datname ORDER BY calls DESC) as rank, t2.rolname, t3.datname, queryid, regexp_replace(substring(query FOR 1000), '[ \t\n]+', ' ', 'g') AS shrunk_query_text, calls, total_time / 1000 as total_time_seconds, min_time / 1000 as min_time_seconds, max_time / 1000 as max_time_seconds, mean_time / 1000 as mean_time_seconds, stddev_time / 1000 as stddev_time_seconds, rows, shared_blks_hit, shared_blks_read, shared_blks_dirtied, shared_blks_written, local_blks_hit, local_blks_read, local_blks_dirtied, local_blks_written, temp_blks_read, temp_blks_written, blk_read_time / 1000 as blk_read_time_seconds, blk_write_time / 1000 as blk_write_time_seconds FROM pg_stat_statements t1 JOIN pg_roles t2 ON (t1.userid=t2.oid) JOIN pg_database t3 ON (t1.dbid=t3.oid) WHERE t1.query NOT LIKE '%pg_%' AND (t2.rolname NOT IN ('rdsadmin', 'azuresu', 'psqladmin'))) SELECT * FROM data WHERE rank <= 10 ORDER BY calls DESC;"
      master: true
      metrics:
        - rolname:
            usage: "LABEL"
            description: "Name of user"
        - datname:
            usage: "LABEL"
            description: "Name of database"
        - queryid:
            usage: "LABEL"
            description: "Query ID"
        - shrunk_query_text:
            usage: "LABEL"
            description: "First 1000 characters of the query"
        - calls:
            usage: "COUNTER"
            description: "Number of times executed"
        - total_time_seconds:
            usage: "COUNTER"
            description: "Total time spent in the statement, in milliseconds"
        - min_time_seconds:
            usage: "GAUGE"
            description: "Minimum time spent in the statement, in milliseconds"
        - max_time_seconds:
            usage: "GAUGE"
            description: "Maximum time spent in the statement, in milliseconds"
        - mean_time_seconds:
            usage: "GAUGE"
            description: "Mean time spent in the statement, in milliseconds"
        - stddev_time_seconds:
            usage: "GAUGE"
            description: "Population standard deviation of time spent in the statement, in milliseconds"
        - rows:
            usage: "COUNTER"
            description: "Total number of rows retrieved or affected by the statement"
        - shared_blks_hit:
            usage: "COUNTER"
            description: "Total number of shared block cache hits by the statement"
        - shared_blks_read:
            usage: "COUNTER"
            description: "Total number of shared blocks read by the statement"
        - shared_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of shared blocks dirtied by the statement"
        - shared_blks_written:
            usage: "COUNTER"
            description: "Total number of shared blocks written by the statement"
        - local_blks_hit:
            usage: "COUNTER"
            description: "Total number of local block cache hits by the statement"
        - local_blks_read:
            usage: "COUNTER"
            description: "Total number of local blocks read by the statement"
        - local_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of local blocks dirtied by the statement"
        - local_blks_written:
            usage: "COUNTER"
            description: "Total number of local blocks written by the statement"
        - temp_blks_read:
            usage: "COUNTER"
            description: "Total number of temp blocks read by the statement"
        - temp_blks_written:
            usage: "COUNTER"
            description: "Total number of temp blocks written by the statement"
        - blk_read_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent reading blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
        - blk_write_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent writing blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
    
    pg_stat_statements_total_time:
      query: "WITH data AS (SELECT ROW_NUMBER() OVER(PARTITION BY t3.datname ORDER BY total_time DESC) as rank, t2.rolname, t3.datname, queryid, regexp_replace(substring(query FOR 1000), '[ \t\n]+', ' ', 'g') AS shrunk_query_text, calls, total_time / 1000 as total_time_seconds, min_time / 1000 as min_time_seconds, max_time / 1000 as max_time_seconds, mean_time / 1000 as mean_time_seconds, stddev_time / 1000 as stddev_time_seconds, rows, shared_blks_hit, shared_blks_read, shared_blks_dirtied, shared_blks_written, local_blks_hit, local_blks_read, local_blks_dirtied, local_blks_written, temp_blks_read, temp_blks_written, blk_read_time / 1000 as blk_read_time_seconds, blk_write_time / 1000 as blk_write_time_seconds FROM pg_stat_statements t1 JOIN pg_roles t2 ON (t1.userid=t2.oid) JOIN pg_database t3 ON (t1.dbid=t3.oid) WHERE t1.query NOT LIKE '%pg_%' AND (t2.rolname NOT IN ('rdsadmin', 'azuresu', 'psqladmin'))) SELECT * FROM data WHERE rank <= 10 ORDER BY total_time_seconds DESC;"
      master: true
      metrics:
        - rolname:
            usage: "LABEL"
            description: "Name of user"
        - datname:
            usage: "LABEL"
            description: "Name of database"
        - queryid:
            usage: "LABEL"
            description: "Query ID"
        - shrunk_query_text:
            usage: "LABEL"
            description: "First 1000 characters of the query"
        - calls:
            usage: "COUNTER"
            description: "Number of times executed"
        - total_time_seconds:
            usage: "COUNTER"
            description: "Total time spent in the statement, in milliseconds"
        - min_time_seconds:
            usage: "GAUGE"
            description: "Minimum time spent in the statement, in milliseconds"
        - max_time_seconds:
            usage: "GAUGE"
            description: "Maximum time spent in the statement, in milliseconds"
        - mean_time_seconds:
            usage: "GAUGE"
            description: "Mean time spent in the statement, in milliseconds"
        - stddev_time_seconds:
            usage: "GAUGE"
            description: "Population standard deviation of time spent in the statement, in milliseconds"
        - rows:
            usage: "COUNTER"
            description: "Total number of rows retrieved or affected by the statement"
        - shared_blks_hit:
            usage: "COUNTER"
            description: "Total number of shared block cache hits by the statement"
        - shared_blks_read:
            usage: "COUNTER"
            description: "Total number of shared blocks read by the statement"
        - shared_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of shared blocks dirtied by the statement"
        - shared_blks_written:
            usage: "COUNTER"
            description: "Total number of shared blocks written by the statement"
        - local_blks_hit:
            usage: "COUNTER"
            description: "Total number of local block cache hits by the statement"
        - local_blks_read:
            usage: "COUNTER"
            description: "Total number of local blocks read by the statement"
        - local_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of local blocks dirtied by the statement"
        - local_blks_written:
            usage: "COUNTER"
            description: "Total number of local blocks written by the statement"
        - temp_blks_read:
            usage: "COUNTER"
            description: "Total number of temp blocks read by the statement"
        - temp_blks_written:
            usage: "COUNTER"
            description: "Total number of temp blocks written by the statement"
        - blk_read_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent reading blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
        - blk_write_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent writing blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
    
    pg_stat_statements_max_time:
      query: "WITH data AS (SELECT ROW_NUMBER() OVER(PARTITION BY t3.datname ORDER BY max_time DESC) as rank, t2.rolname, t3.datname, queryid, regexp_replace(substring(query FOR 1000), '[ \t\n]+', ' ', 'g') AS shrunk_query_text, calls, total_time / 1000 as total_time_seconds, min_time / 1000 as min_time_seconds, max_time / 1000 as max_time_seconds, mean_time / 1000 as mean_time_seconds, stddev_time / 1000 as stddev_time_seconds, rows, shared_blks_hit, shared_blks_read, shared_blks_dirtied, shared_blks_written, local_blks_hit, local_blks_read, local_blks_dirtied, local_blks_written, temp_blks_read, temp_blks_written, blk_read_time / 1000 as blk_read_time_seconds, blk_write_time / 1000 as blk_write_time_seconds FROM pg_stat_statements t1 JOIN pg_roles t2 ON (t1.userid=t2.oid) JOIN pg_database t3 ON (t1.dbid=t3.oid) WHERE t1.query NOT LIKE '%pg_%' AND (t2.rolname NOT IN ('rdsadmin', 'azuresu', 'psqladmin'))) SELECT * FROM data WHERE rank <= 10 ORDER BY max_time_seconds DESC;"
      master: true
      metrics:
        - rolname:
            usage: "LABEL"
            description: "Name of user"
        - datname:
            usage: "LABEL"
            description: "Name of database"
        - queryid:
            usage: "LABEL"
            description: "Query ID"
        - shrunk_query_text:
            usage: "LABEL"
            description: "First 1000 characters of the query"
        - calls:
            usage: "COUNTER"
            description: "Number of times executed"
        - total_time_seconds:
            usage: "COUNTER"
            description: "Total time spent in the statement, in milliseconds"
        - min_time_seconds:
            usage: "GAUGE"
            description: "Minimum time spent in the statement, in milliseconds"
        - max_time_seconds:
            usage: "GAUGE"
            description: "Maximum time spent in the statement, in milliseconds"
        - mean_time_seconds:
            usage: "GAUGE"
            description: "Mean time spent in the statement, in milliseconds"
        - stddev_time_seconds:
            usage: "GAUGE"
            description: "Population standard deviation of time spent in the statement, in milliseconds"
        - rows:
            usage: "COUNTER"
            description: "Total number of rows retrieved or affected by the statement"
        - shared_blks_hit:
            usage: "COUNTER"
            description: "Total number of shared block cache hits by the statement"
        - shared_blks_read:
            usage: "COUNTER"
            description: "Total number of shared blocks read by the statement"
        - shared_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of shared blocks dirtied by the statement"
        - shared_blks_written:
            usage: "COUNTER"
            description: "Total number of shared blocks written by the statement"
        - local_blks_hit:
            usage: "COUNTER"
            description: "Total number of local block cache hits by the statement"
        - local_blks_read:
            usage: "COUNTER"
            description: "Total number of local blocks read by the statement"
        - local_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of local blocks dirtied by the statement"
        - local_blks_written:
            usage: "COUNTER"
            description: "Total number of local blocks written by the statement"
        - temp_blks_read:
            usage: "COUNTER"
            description: "Total number of temp blocks read by the statement"
        - temp_blks_written:
            usage: "COUNTER"
            description: "Total number of temp blocks written by the statement"
        - blk_read_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent reading blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
        - blk_write_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent writing blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
    
    pg_stat_statements_most_rows:
      query: "WITH data AS (SELECT ROW_NUMBER() OVER(PARTITION BY t3.datname ORDER BY rows DESC) as rank, t2.rolname, t3.datname, queryid, regexp_replace(substring(query FOR 1000), '[ \t\n]+', ' ', 'g') AS shrunk_query_text, calls, total_time / 1000 as total_time_seconds, min_time / 1000 as min_time_seconds, max_time / 1000 as max_time_seconds, mean_time / 1000 as mean_time_seconds, stddev_time / 1000 as stddev_time_seconds, rows, shared_blks_hit, shared_blks_read, shared_blks_dirtied, shared_blks_written, local_blks_hit, local_blks_read, local_blks_dirtied, local_blks_written, temp_blks_read, temp_blks_written, blk_read_time / 1000 as blk_read_time_seconds, blk_write_time / 1000 as blk_write_time_seconds FROM pg_stat_statements t1 JOIN pg_roles t2 ON (t1.userid=t2.oid) JOIN pg_database t3 ON (t1.dbid=t3.oid) WHERE t1.query NOT LIKE '%pg_%' AND (t2.rolname NOT IN ('rdsadmin', 'azuresu', 'psqladmin'))) SELECT * FROM data WHERE rank <= 10 ORDER BY rows DESC;"
      master: true
      metrics:
        - rolname:
            usage: "LABEL"
            description: "Name of user"
        - datname:
            usage: "LABEL"
            description: "Name of database"
        - queryid:
            usage: "LABEL"
            description: "Query ID"
        - shrunk_query_text:
            usage: "LABEL"
            description: "First 1000 characters of the query"
        - calls:
            usage: "COUNTER"
            description: "Number of times executed"
        - total_time_seconds:
            usage: "COUNTER"
            description: "Total time spent in the statement, in milliseconds"
        - min_time_seconds:
            usage: "GAUGE"
            description: "Minimum time spent in the statement, in milliseconds"
        - max_time_seconds:
            usage: "GAUGE"
            description: "Maximum time spent in the statement, in milliseconds"
        - mean_time_seconds:
            usage: "GAUGE"
            description: "Mean time spent in the statement, in milliseconds"
        - stddev_time_seconds:
            usage: "GAUGE"
            description: "Population standard deviation of time spent in the statement, in milliseconds"
        - rows:
            usage: "COUNTER"
            description: "Total number of rows retrieved or affected by the statement"
        - shared_blks_hit:
            usage: "COUNTER"
            description: "Total number of shared block cache hits by the statement"
        - shared_blks_read:
            usage: "COUNTER"
            description: "Total number of shared blocks read by the statement"
        - shared_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of shared blocks dirtied by the statement"
        - shared_blks_written:
            usage: "COUNTER"
            description: "Total number of shared blocks written by the statement"
        - local_blks_hit:
            usage: "COUNTER"
            description: "Total number of local block cache hits by the statement"
        - local_blks_read:
            usage: "COUNTER"
            description: "Total number of local blocks read by the statement"
        - local_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of local blocks dirtied by the statement"
        - local_blks_written:
            usage: "COUNTER"
            description: "Total number of local blocks written by the statement"
        - temp_blks_read:
            usage: "COUNTER"
            description: "Total number of temp blocks read by the statement"
        - temp_blks_written:
            usage: "COUNTER"
            description: "Total number of temp blocks written by the statement"
        - blk_read_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent reading blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
        - blk_write_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent writing blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
    
    pg_stat_statements_temp_files:
      query: "SELECT t2.rolname, t3.datname, queryid, regexp_replace(substring(query FOR 1000), '[ \t\n]+', ' ', 'g') AS shrunk_query_text, calls, total_time / 1000 as total_time_seconds, min_time / 1000 as min_time_seconds, max_time / 1000 as max_time_seconds, mean_time / 1000 as mean_time_seconds, stddev_time / 1000 as stddev_time_seconds, rows, shared_blks_hit, shared_blks_read, shared_blks_dirtied, shared_blks_written, local_blks_hit, local_blks_read, local_blks_dirtied, local_blks_written, temp_blks_read, temp_blks_written, blk_read_time / 1000 as blk_read_time_seconds, blk_write_time / 1000 as blk_write_time_seconds FROM pg_stat_statements t1 JOIN pg_roles t2 ON (t1.userid=t2.oid) JOIN pg_database t3 ON (t1.dbid=t3.oid) WHERE t1.query NOT LIKE '%pg_%' AND (t2.rolname NOT IN ('rdsadmin', 'azuresu', 'psqladmin')) AND (temp_blks_written > 0 OR temp_blks_read > 0)"
      master: true
      metrics:
        - rolname:
            usage: "LABEL"
            description: "Name of user"
        - datname:
            usage: "LABEL"
            description: "Name of database"
        - queryid:
            usage: "LABEL"
            description: "Query ID"
        - shrunk_query_text:
            usage: "LABEL"
            description: "First 1000 characters of the query"
        - calls:
            usage: "COUNTER"
            description: "Number of times executed"
        - total_time_seconds:
            usage: "COUNTER"
            description: "Total time spent in the statement, in milliseconds"
        - min_time_seconds:
            usage: "GAUGE"
            description: "Minimum time spent in the statement, in milliseconds"
        - max_time_seconds:
            usage: "GAUGE"
            description: "Maximum time spent in the statement, in milliseconds"
        - mean_time_seconds:
            usage: "GAUGE"
            description: "Mean time spent in the statement, in milliseconds"
        - stddev_time_seconds:
            usage: "GAUGE"
            description: "Population standard deviation of time spent in the statement, in milliseconds"
        - rows:
            usage: "COUNTER"
            description: "Total number of rows retrieved or affected by the statement"
        - shared_blks_hit:
            usage: "COUNTER"
            description: "Total number of shared block cache hits by the statement"
        - shared_blks_read:
            usage: "COUNTER"
            description: "Total number of shared blocks read by the statement"
        - shared_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of shared blocks dirtied by the statement"
        - shared_blks_written:
            usage: "COUNTER"
            description: "Total number of shared blocks written by the statement"
        - local_blks_hit:
            usage: "COUNTER"
            description: "Total number of local block cache hits by the statement"
        - local_blks_read:
            usage: "COUNTER"
            description: "Total number of local blocks read by the statement"
        - local_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of local blocks dirtied by the statement"
        - local_blks_written:
            usage: "COUNTER"
            description: "Total number of local blocks written by the statement"
        - temp_blks_read:
            usage: "COUNTER"
            description: "Total number of temp blocks read by the statement"
        - temp_blks_written:
            usage: "COUNTER"
            description: "Total number of temp blocks written by the statement"
        - blk_read_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent reading blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
        - blk_write_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent writing blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
---
# Source: prometheus-postgres-exporter/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-prometheus-postgres-exporter-replica
  labels:
    app.kubernetes.io/name: prometheus-postgres-exporter
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: "Monitoring"
    app.kubernetes.io/managed-by: Helm
    helm.sh/chart: prometheus-postgres-exporter-2.3.7
data:
  queries.yaml: |-
    ---
    pg_is_in:
      query: "SELECT CASE WHEN pg_is_in_recovery() THEN 1 ELSE 0 END AS recovery"
      master: true
      metrics:
        - recovery:
            usage: "GAUGE"
            description: "0 for master, 1 for slaves"
    
    pg_xlog:
      query: "SELECT CASE WHEN pg_is_in_recovery() THEN pg_wal_lsn_diff(pg_last_wal_replay_lsn(), '0/0') ELSE pg_wal_lsn_diff(pg_current_wal_flush_lsn(), '0/0') END AS position"
      master: true
      metrics:
        - position:
            usage: "COUNTER"
            description: "Position in the WAL"
    
    pg_replication:
      query: "SELECT CASE WHEN NOT pg_is_in_recovery() THEN -1 WHEN pg_last_wal_receive_lsn() = pg_last_wal_replay_lsn() THEN 0 ELSE EXTRACT (EPOCH FROM now() - pg_last_xact_replay_timestamp()) * 1000 END AS replag"
      master: true
      metrics:
        - replag:
            usage: "GAUGE"
            description: "Replication lag behind master in milliseconds"
    
    pg_postmaster:
      query: "SELECT pg_postmaster_start_time as start_time_seconds from pg_postmaster_start_time()"
      master: true
      metrics:
        - start_time_seconds:
            usage: "GAUGE"
            description: "Time at which postmaster started"
    
    pg_wals:
      # >= 10
      query: |
        WITH ls AS (
          SELECT './pg_wal/' || pg_ls_dir AS filename, (pg_stat_file('./pg_wal/' || pg_ls_dir)).* FROM pg_ls_dir('./pg_wal/')
        )
        SELECT count(*) AS count, sum(size) AS size FROM ls WHERE NOT isdir;
      master: true
      metrics:
        - count:
            usage: "GAUGE"
            description: "Number of wal segments"
        - size:
            usage: "GAUGE"
            description: "Disk usage of wal segments"
    
    pg_archive_wals:
      # >= 10
      query: |
        WITH ls AS (
          select './pg_wal/archive_status/' || pg_ls_dir AS filename, (pg_stat_file('./pg_wal/archive_status/' || pg_ls_dir)).* from pg_ls_dir('./pg_wal/archive_status/')
        )
        SELECT (SELECT count(*) FROM ls WHERE filename LIKE '%.done') AS done, (SELECT count(*) FROM ls WHERE filename LIKE '%.ready') AS ready;
      master: true
      metrics:
        - done:
            usage: "GAUGE"
            description: "Number of wal segments archived"
        - ready:
            usage: "GAUGE"
            description: "Number of wal segments ready for archival"
    
    pg_stat_user_tables:
      query: "SELECT current_database() datname, schemaname, relname, COALESCE(seq_scan, 0) AS seq_scan, COALESCE(seq_tup_read, 0) AS seq_tup_read, COALESCE(idx_scan, 0) AS idx_scan, COALESCE(idx_tup_fetch, 0) AS idx_tup_fetch, n_tup_ins, n_tup_upd, n_tup_del, n_tup_hot_upd, n_live_tup, n_dead_tup, n_mod_since_analyze, COALESCE(last_vacuum, '1970-01-01Z'), COALESCE(last_vacuum, '1970-01-01Z') as last_vacuum, COALESCE(last_autovacuum, '1970-01-01Z') as last_autovacuum, COALESCE(last_analyze, '1970-01-01Z') as last_analyze, COALESCE(last_autoanalyze, '1970-01-01Z') as last_autoanalyze, vacuum_count, autovacuum_count, analyze_count, autoanalyze_count FROM pg_stat_user_tables"
      metrics:
        - datname:
            usage: "LABEL"
            description: "Name of current database"
        - schemaname:
            usage: "LABEL"
            description: "Name of the schema that this table is in"
        - relname:
            usage: "LABEL"
            description: "Name of this table"
        - seq_scan:
            usage: "COUNTER"
            description: "Number of sequential scans initiated on this table"
        - seq_tup_read:
            usage: "COUNTER"
            description: "Number of live rows fetched by sequential scans"
        - idx_scan:
            usage: "COUNTER"
            description: "Number of index scans initiated on this table"
        - idx_tup_fetch:
            usage: "COUNTER"
            description: "Number of live rows fetched by index scans"
        - n_tup_ins:
            usage: "COUNTER"
            description: "Number of rows inserted"
        - n_tup_upd:
            usage: "COUNTER"
            description: "Number of rows updated"
        - n_tup_del:
            usage: "COUNTER"
            description: "Number of rows deleted"
        - n_tup_hot_upd:
            usage: "COUNTER"
            description: "Number of rows HOT updated (i.e., with no separate index update required)"
        - n_live_tup:
            usage: "GAUGE"
            description: "Estimated number of live rows"
        - n_dead_tup:
            usage: "GAUGE"
            description: "Estimated number of dead rows"
        - n_mod_since_analyze:
            usage: "GAUGE"
            description: "Estimated number of rows changed since last analyze"
        - last_vacuum:
            usage: "GAUGE"
            description: "Last time at which this table was manually vacuumed (not counting VACUUM FULL)"
        - last_autovacuum:
            usage: "GAUGE"
            description: "Last time at which this table was vacuumed by the autovacuum daemon"
        - last_analyze:
            usage: "GAUGE"
            description: "Last time at which this table was manually analyzed"
        - last_autoanalyze:
            usage: "GAUGE"
            description: "Last time at which this table was analyzed by the autovacuum daemon"
        - vacuum_count:
            usage: "COUNTER"
            description: "Number of times this table has been manually vacuumed (not counting VACUUM FULL)"
        - autovacuum_count:
            usage: "COUNTER"
            description: "Number of times this table has been vacuumed by the autovacuum daemon"
        - analyze_count:
            usage: "COUNTER"
            description: "Number of times this table has been manually analyzed"
        - autoanalyze_count:
            usage: "COUNTER"
            description: "Number of times this table has been analyzed by the autovacuum daemon"
    
    pg_statio_user_tables:
      query: "SELECT current_database() datname, schemaname, relname, COALESCE(heap_blks_read, 0) AS heap_blks_read, COALESCE(heap_blks_hit, 0) AS heap_blks_hit, COALESCE(idx_blks_read, 0) AS idx_blks_read, COALESCE(idx_blks_hit, 0) AS idx_blks_hit, COALESCE(toast_blks_read, 0) AS toast_blks_read, COALESCE(toast_blks_hit, 0) AS toast_blks_hit, COALESCE(tidx_blks_read, 0) AS tidx_blks_read, COALESCE(tidx_blks_hit, 0) AS tidx_blks_hit FROM pg_statio_user_tables"
      metrics:
        - datname:
            usage: "LABEL"
            description: "Name of current database"
        - schemaname:
            usage: "LABEL"
            description: "Name of the schema that this table is in"
        - relname:
            usage: "LABEL"
            description: "Name of this table"
        - heap_blks_read:
            usage: "COUNTER"
            description: "Number of disk blocks read from this table"
        - heap_blks_hit:
            usage: "COUNTER"
            description: "Number of buffer hits in this table"
        - idx_blks_read:
            usage: "COUNTER"
            description: "Number of disk blocks read from all indexes on this table"
        - idx_blks_hit:
            usage: "COUNTER"
            description: "Number of buffer hits in all indexes on this table"
        - toast_blks_read:
            usage: "COUNTER"
            description: "Number of disk blocks read from this table's TOAST table (if any)"
        - toast_blks_hit:
            usage: "COUNTER"
            description: "Number of buffer hits in this table's TOAST table (if any)"
        - tidx_blks_read:
            usage: "COUNTER"
            description: "Number of disk blocks read from this table's TOAST table indexes (if any)"
        - tidx_blks_hit:
            usage: "COUNTER"
            description: "Number of buffer hits in this table's TOAST table indexes (if any)"
    pg_table_size:
      query: "SELECT current_database() AS datname, schemaname, relname, pg_table_size(relid) AS data_bytes, pg_indexes_size(relid) AS index_bytes FROM pg_stat_user_tables WHERE pg_total_relation_size(relid) > 100000"
      metrics:
        - datname:
            usage: "LABEL"
            description: "Name of the database"
        - schemaname:
            usage: "LABEL"
            description: "Name of the relation schema"
        - relname:
            usage: "LABEL"
            description: "Name of the relation"
        - data_bytes:
            usage: "GAUGE"
            description: "Size of relation data"
        - index_bytes:
            usage: "GAUGE"
            description: "Size of relation indexes"
    
    pg_client_connections:
      master: true
      query: "SELECT count(datname) as count, datname, usename, application_name as appname, client_addr FROM pg_stat_activity WHERE backend_type = 'client backend' GROUP BY datname, usename, client_addr, application_name"
      metrics:
        - datname:
            usage: "LABEL"
            description: "Name of the database"
        - usename:
            usage: "LABEL"
            description: "Username connected as"
        - appname:
            usage: "LABEL"
            description: "Application Name connection string"
        - client_addr:
            usage: "LABEL"
            description: "Client connection address"
        - count:
            usage: "GAUGE"
            description: "Clients connected"
    
    pg_database:
      query: "SELECT pg_database.datname, pg_database_size(pg_database.datname) as size_bytes FROM pg_database WHERE datname NOT IN ('template0', 'template1', 'azure_maintenance', 'azure_sys');"
      master: true
      metrics:
        - datname:
            usage: "LABEL"
            description: "Name of the database"
        - size_bytes:
            usage: "GAUGE"
            description: "Disk space used by the database"
    
    pg_stat_statements_most_frequent:
      query: "WITH data AS (SELECT ROW_NUMBER() OVER(PARTITION BY t3.datname ORDER BY calls DESC) as rank, t2.rolname, t3.datname, queryid, regexp_replace(substring(query FOR 1000), '[ \t\n]+', ' ', 'g') AS shrunk_query_text, calls, total_time / 1000 as total_time_seconds, min_time / 1000 as min_time_seconds, max_time / 1000 as max_time_seconds, mean_time / 1000 as mean_time_seconds, stddev_time / 1000 as stddev_time_seconds, rows, shared_blks_hit, shared_blks_read, shared_blks_dirtied, shared_blks_written, local_blks_hit, local_blks_read, local_blks_dirtied, local_blks_written, temp_blks_read, temp_blks_written, blk_read_time / 1000 as blk_read_time_seconds, blk_write_time / 1000 as blk_write_time_seconds FROM pg_stat_statements t1 JOIN pg_roles t2 ON (t1.userid=t2.oid) JOIN pg_database t3 ON (t1.dbid=t3.oid) WHERE t1.query NOT LIKE '%pg_%' AND (t2.rolname NOT IN ('rdsadmin', 'azuresu', 'psqladmin'))) SELECT * FROM data WHERE rank <= 10 ORDER BY calls DESC;"
      master: true
      metrics:
        - rolname:
            usage: "LABEL"
            description: "Name of user"
        - datname:
            usage: "LABEL"
            description: "Name of database"
        - queryid:
            usage: "LABEL"
            description: "Query ID"
        - shrunk_query_text:
            usage: "LABEL"
            description: "First 1000 characters of the query"
        - calls:
            usage: "COUNTER"
            description: "Number of times executed"
        - total_time_seconds:
            usage: "COUNTER"
            description: "Total time spent in the statement, in milliseconds"
        - min_time_seconds:
            usage: "GAUGE"
            description: "Minimum time spent in the statement, in milliseconds"
        - max_time_seconds:
            usage: "GAUGE"
            description: "Maximum time spent in the statement, in milliseconds"
        - mean_time_seconds:
            usage: "GAUGE"
            description: "Mean time spent in the statement, in milliseconds"
        - stddev_time_seconds:
            usage: "GAUGE"
            description: "Population standard deviation of time spent in the statement, in milliseconds"
        - rows:
            usage: "COUNTER"
            description: "Total number of rows retrieved or affected by the statement"
        - shared_blks_hit:
            usage: "COUNTER"
            description: "Total number of shared block cache hits by the statement"
        - shared_blks_read:
            usage: "COUNTER"
            description: "Total number of shared blocks read by the statement"
        - shared_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of shared blocks dirtied by the statement"
        - shared_blks_written:
            usage: "COUNTER"
            description: "Total number of shared blocks written by the statement"
        - local_blks_hit:
            usage: "COUNTER"
            description: "Total number of local block cache hits by the statement"
        - local_blks_read:
            usage: "COUNTER"
            description: "Total number of local blocks read by the statement"
        - local_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of local blocks dirtied by the statement"
        - local_blks_written:
            usage: "COUNTER"
            description: "Total number of local blocks written by the statement"
        - temp_blks_read:
            usage: "COUNTER"
            description: "Total number of temp blocks read by the statement"
        - temp_blks_written:
            usage: "COUNTER"
            description: "Total number of temp blocks written by the statement"
        - blk_read_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent reading blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
        - blk_write_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent writing blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
    
    pg_stat_statements_total_time:
      query: "WITH data AS (SELECT ROW_NUMBER() OVER(PARTITION BY t3.datname ORDER BY total_time DESC) as rank, t2.rolname, t3.datname, queryid, regexp_replace(substring(query FOR 1000), '[ \t\n]+', ' ', 'g') AS shrunk_query_text, calls, total_time / 1000 as total_time_seconds, min_time / 1000 as min_time_seconds, max_time / 1000 as max_time_seconds, mean_time / 1000 as mean_time_seconds, stddev_time / 1000 as stddev_time_seconds, rows, shared_blks_hit, shared_blks_read, shared_blks_dirtied, shared_blks_written, local_blks_hit, local_blks_read, local_blks_dirtied, local_blks_written, temp_blks_read, temp_blks_written, blk_read_time / 1000 as blk_read_time_seconds, blk_write_time / 1000 as blk_write_time_seconds FROM pg_stat_statements t1 JOIN pg_roles t2 ON (t1.userid=t2.oid) JOIN pg_database t3 ON (t1.dbid=t3.oid) WHERE t1.query NOT LIKE '%pg_%' AND (t2.rolname NOT IN ('rdsadmin', 'azuresu', 'psqladmin'))) SELECT * FROM data WHERE rank <= 10 ORDER BY total_time_seconds DESC;"
      master: true
      metrics:
        - rolname:
            usage: "LABEL"
            description: "Name of user"
        - datname:
            usage: "LABEL"
            description: "Name of database"
        - queryid:
            usage: "LABEL"
            description: "Query ID"
        - shrunk_query_text:
            usage: "LABEL"
            description: "First 1000 characters of the query"
        - calls:
            usage: "COUNTER"
            description: "Number of times executed"
        - total_time_seconds:
            usage: "COUNTER"
            description: "Total time spent in the statement, in milliseconds"
        - min_time_seconds:
            usage: "GAUGE"
            description: "Minimum time spent in the statement, in milliseconds"
        - max_time_seconds:
            usage: "GAUGE"
            description: "Maximum time spent in the statement, in milliseconds"
        - mean_time_seconds:
            usage: "GAUGE"
            description: "Mean time spent in the statement, in milliseconds"
        - stddev_time_seconds:
            usage: "GAUGE"
            description: "Population standard deviation of time spent in the statement, in milliseconds"
        - rows:
            usage: "COUNTER"
            description: "Total number of rows retrieved or affected by the statement"
        - shared_blks_hit:
            usage: "COUNTER"
            description: "Total number of shared block cache hits by the statement"
        - shared_blks_read:
            usage: "COUNTER"
            description: "Total number of shared blocks read by the statement"
        - shared_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of shared blocks dirtied by the statement"
        - shared_blks_written:
            usage: "COUNTER"
            description: "Total number of shared blocks written by the statement"
        - local_blks_hit:
            usage: "COUNTER"
            description: "Total number of local block cache hits by the statement"
        - local_blks_read:
            usage: "COUNTER"
            description: "Total number of local blocks read by the statement"
        - local_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of local blocks dirtied by the statement"
        - local_blks_written:
            usage: "COUNTER"
            description: "Total number of local blocks written by the statement"
        - temp_blks_read:
            usage: "COUNTER"
            description: "Total number of temp blocks read by the statement"
        - temp_blks_written:
            usage: "COUNTER"
            description: "Total number of temp blocks written by the statement"
        - blk_read_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent reading blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
        - blk_write_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent writing blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
    
    pg_stat_statements_max_time:
      query: "WITH data AS (SELECT ROW_NUMBER() OVER(PARTITION BY t3.datname ORDER BY max_time DESC) as rank, t2.rolname, t3.datname, queryid, regexp_replace(substring(query FOR 1000), '[ \t\n]+', ' ', 'g') AS shrunk_query_text, calls, total_time / 1000 as total_time_seconds, min_time / 1000 as min_time_seconds, max_time / 1000 as max_time_seconds, mean_time / 1000 as mean_time_seconds, stddev_time / 1000 as stddev_time_seconds, rows, shared_blks_hit, shared_blks_read, shared_blks_dirtied, shared_blks_written, local_blks_hit, local_blks_read, local_blks_dirtied, local_blks_written, temp_blks_read, temp_blks_written, blk_read_time / 1000 as blk_read_time_seconds, blk_write_time / 1000 as blk_write_time_seconds FROM pg_stat_statements t1 JOIN pg_roles t2 ON (t1.userid=t2.oid) JOIN pg_database t3 ON (t1.dbid=t3.oid) WHERE t1.query NOT LIKE '%pg_%' AND (t2.rolname NOT IN ('rdsadmin', 'azuresu', 'psqladmin'))) SELECT * FROM data WHERE rank <= 10 ORDER BY max_time_seconds DESC;"
      master: true
      metrics:
        - rolname:
            usage: "LABEL"
            description: "Name of user"
        - datname:
            usage: "LABEL"
            description: "Name of database"
        - queryid:
            usage: "LABEL"
            description: "Query ID"
        - shrunk_query_text:
            usage: "LABEL"
            description: "First 1000 characters of the query"
        - calls:
            usage: "COUNTER"
            description: "Number of times executed"
        - total_time_seconds:
            usage: "COUNTER"
            description: "Total time spent in the statement, in milliseconds"
        - min_time_seconds:
            usage: "GAUGE"
            description: "Minimum time spent in the statement, in milliseconds"
        - max_time_seconds:
            usage: "GAUGE"
            description: "Maximum time spent in the statement, in milliseconds"
        - mean_time_seconds:
            usage: "GAUGE"
            description: "Mean time spent in the statement, in milliseconds"
        - stddev_time_seconds:
            usage: "GAUGE"
            description: "Population standard deviation of time spent in the statement, in milliseconds"
        - rows:
            usage: "COUNTER"
            description: "Total number of rows retrieved or affected by the statement"
        - shared_blks_hit:
            usage: "COUNTER"
            description: "Total number of shared block cache hits by the statement"
        - shared_blks_read:
            usage: "COUNTER"
            description: "Total number of shared blocks read by the statement"
        - shared_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of shared blocks dirtied by the statement"
        - shared_blks_written:
            usage: "COUNTER"
            description: "Total number of shared blocks written by the statement"
        - local_blks_hit:
            usage: "COUNTER"
            description: "Total number of local block cache hits by the statement"
        - local_blks_read:
            usage: "COUNTER"
            description: "Total number of local blocks read by the statement"
        - local_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of local blocks dirtied by the statement"
        - local_blks_written:
            usage: "COUNTER"
            description: "Total number of local blocks written by the statement"
        - temp_blks_read:
            usage: "COUNTER"
            description: "Total number of temp blocks read by the statement"
        - temp_blks_written:
            usage: "COUNTER"
            description: "Total number of temp blocks written by the statement"
        - blk_read_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent reading blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
        - blk_write_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent writing blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
    
    pg_stat_statements_most_rows:
      query: "WITH data AS (SELECT ROW_NUMBER() OVER(PARTITION BY t3.datname ORDER BY rows DESC) as rank, t2.rolname, t3.datname, queryid, regexp_replace(substring(query FOR 1000), '[ \t\n]+', ' ', 'g') AS shrunk_query_text, calls, total_time / 1000 as total_time_seconds, min_time / 1000 as min_time_seconds, max_time / 1000 as max_time_seconds, mean_time / 1000 as mean_time_seconds, stddev_time / 1000 as stddev_time_seconds, rows, shared_blks_hit, shared_blks_read, shared_blks_dirtied, shared_blks_written, local_blks_hit, local_blks_read, local_blks_dirtied, local_blks_written, temp_blks_read, temp_blks_written, blk_read_time / 1000 as blk_read_time_seconds, blk_write_time / 1000 as blk_write_time_seconds FROM pg_stat_statements t1 JOIN pg_roles t2 ON (t1.userid=t2.oid) JOIN pg_database t3 ON (t1.dbid=t3.oid) WHERE t1.query NOT LIKE '%pg_%' AND (t2.rolname NOT IN ('rdsadmin', 'azuresu', 'psqladmin'))) SELECT * FROM data WHERE rank <= 10 ORDER BY rows DESC;"
      master: true
      metrics:
        - rolname:
            usage: "LABEL"
            description: "Name of user"
        - datname:
            usage: "LABEL"
            description: "Name of database"
        - queryid:
            usage: "LABEL"
            description: "Query ID"
        - shrunk_query_text:
            usage: "LABEL"
            description: "First 1000 characters of the query"
        - calls:
            usage: "COUNTER"
            description: "Number of times executed"
        - total_time_seconds:
            usage: "COUNTER"
            description: "Total time spent in the statement, in milliseconds"
        - min_time_seconds:
            usage: "GAUGE"
            description: "Minimum time spent in the statement, in milliseconds"
        - max_time_seconds:
            usage: "GAUGE"
            description: "Maximum time spent in the statement, in milliseconds"
        - mean_time_seconds:
            usage: "GAUGE"
            description: "Mean time spent in the statement, in milliseconds"
        - stddev_time_seconds:
            usage: "GAUGE"
            description: "Population standard deviation of time spent in the statement, in milliseconds"
        - rows:
            usage: "COUNTER"
            description: "Total number of rows retrieved or affected by the statement"
        - shared_blks_hit:
            usage: "COUNTER"
            description: "Total number of shared block cache hits by the statement"
        - shared_blks_read:
            usage: "COUNTER"
            description: "Total number of shared blocks read by the statement"
        - shared_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of shared blocks dirtied by the statement"
        - shared_blks_written:
            usage: "COUNTER"
            description: "Total number of shared blocks written by the statement"
        - local_blks_hit:
            usage: "COUNTER"
            description: "Total number of local block cache hits by the statement"
        - local_blks_read:
            usage: "COUNTER"
            description: "Total number of local blocks read by the statement"
        - local_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of local blocks dirtied by the statement"
        - local_blks_written:
            usage: "COUNTER"
            description: "Total number of local blocks written by the statement"
        - temp_blks_read:
            usage: "COUNTER"
            description: "Total number of temp blocks read by the statement"
        - temp_blks_written:
            usage: "COUNTER"
            description: "Total number of temp blocks written by the statement"
        - blk_read_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent reading blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
        - blk_write_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent writing blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
    
    pg_stat_statements_temp_files:
      query: "SELECT t2.rolname, t3.datname, queryid, regexp_replace(substring(query FOR 1000), '[ \t\n]+', ' ', 'g') AS shrunk_query_text, calls, total_time / 1000 as total_time_seconds, min_time / 1000 as min_time_seconds, max_time / 1000 as max_time_seconds, mean_time / 1000 as mean_time_seconds, stddev_time / 1000 as stddev_time_seconds, rows, shared_blks_hit, shared_blks_read, shared_blks_dirtied, shared_blks_written, local_blks_hit, local_blks_read, local_blks_dirtied, local_blks_written, temp_blks_read, temp_blks_written, blk_read_time / 1000 as blk_read_time_seconds, blk_write_time / 1000 as blk_write_time_seconds FROM pg_stat_statements t1 JOIN pg_roles t2 ON (t1.userid=t2.oid) JOIN pg_database t3 ON (t1.dbid=t3.oid) WHERE t1.query NOT LIKE '%pg_%' AND (t2.rolname NOT IN ('rdsadmin', 'azuresu', 'psqladmin')) AND (temp_blks_written > 0 OR temp_blks_read > 0)"
      master: true
      metrics:
        - rolname:
            usage: "LABEL"
            description: "Name of user"
        - datname:
            usage: "LABEL"
            description: "Name of database"
        - queryid:
            usage: "LABEL"
            description: "Query ID"
        - shrunk_query_text:
            usage: "LABEL"
            description: "First 1000 characters of the query"
        - calls:
            usage: "COUNTER"
            description: "Number of times executed"
        - total_time_seconds:
            usage: "COUNTER"
            description: "Total time spent in the statement, in milliseconds"
        - min_time_seconds:
            usage: "GAUGE"
            description: "Minimum time spent in the statement, in milliseconds"
        - max_time_seconds:
            usage: "GAUGE"
            description: "Maximum time spent in the statement, in milliseconds"
        - mean_time_seconds:
            usage: "GAUGE"
            description: "Mean time spent in the statement, in milliseconds"
        - stddev_time_seconds:
            usage: "GAUGE"
            description: "Population standard deviation of time spent in the statement, in milliseconds"
        - rows:
            usage: "COUNTER"
            description: "Total number of rows retrieved or affected by the statement"
        - shared_blks_hit:
            usage: "COUNTER"
            description: "Total number of shared block cache hits by the statement"
        - shared_blks_read:
            usage: "COUNTER"
            description: "Total number of shared blocks read by the statement"
        - shared_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of shared blocks dirtied by the statement"
        - shared_blks_written:
            usage: "COUNTER"
            description: "Total number of shared blocks written by the statement"
        - local_blks_hit:
            usage: "COUNTER"
            description: "Total number of local block cache hits by the statement"
        - local_blks_read:
            usage: "COUNTER"
            description: "Total number of local blocks read by the statement"
        - local_blks_dirtied:
            usage: "COUNTER"
            description: "Total number of local blocks dirtied by the statement"
        - local_blks_written:
            usage: "COUNTER"
            description: "Total number of local blocks written by the statement"
        - temp_blks_read:
            usage: "COUNTER"
            description: "Total number of temp blocks read by the statement"
        - temp_blks_written:
            usage: "COUNTER"
            description: "Total number of temp blocks written by the statement"
        - blk_read_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent reading blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
        - blk_write_time_seconds:
            usage: "COUNTER"
            description: "Total time the statement spent writing blocks, in milliseconds (if track_io_timing is enabled, otherwise zero)"
---
# Source: prometheus-postgres-exporter/templates/dashboard-cm.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-dashboard
  labels:
    grafana_dashboard: '1'
    app.kubernetes.io/name: prometheus-postgres-exporter
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: "Monitoring"
    app.kubernetes.io/managed-by: Helm
    helm.sh/chart: prometheus-postgres-exporter-2.3.7
data:
  dashboard.json: |-
    {"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":true,"gnetId":null,"graphTooltip":1,"id":476,"iteration":1620656767634,"links":[],"panels":[{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"$env","decimals":null,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":4,"w":2,"x":0,"y":0},"id":184,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"pluginVersion":"6.7.4","postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false,"ymax":null,"ymin":null},"tableColumn":"12.1.0","targets":[{"expr":"1","hide":false,"interval":"","legendFormat":"$pg_version","refId":"A"}],"thresholds":"","timeFrom":null,"timeShift":null,"title":"Version","transformations":[],"type":"singlestat","valueFontSize":"70%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"name"},{"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"mappings":[],"max":1,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"dark-green","value":null},{"color":"super-light-green","value":1}]}},"overrides":[{"matcher":{"id":"byRegexp","options":".*"},"properties":[{"id":"mappings","value":[{"from":"","id":1,"text":"Main","to":"","type":1,"value":"0"},{"from":"","id":2,"text":"Replica","to":"","type":1,"value":"1"}]}]}]},"gridPos":{"h":4,"w":5,"x":2,"y":0},"id":171,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"name"},"pluginVersion":"7.3.4","targets":[{"expr":"pg_is_in_recovery{site=\"$site\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Main/replica","type":"stat"},{"cacheTimeout":null,"datasource":"$env","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{},"mappings":[{"id":0,"op":"=","text":"N/A","type":1,"value":"null"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"rgba(237, 129, 40, 0.89)","value":1000000},{"color":"#d44a3a","value":5000000}]},"unit":"decbytes"},"overrides":[]},"gridPos":{"h":4,"w":3,"x":7,"y":0},"id":355,"interval":null,"links":[],"maxDataPoints":100,"options":{"colorMode":"background","graphMode":"area","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7.3.4","targets":[{"expr":"max(pg_replication_replay_lag{site=\"$site\"})","format":"time_series","instant":false,"interval":"","intervalFactor":1,"legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Replication lag","type":"stat"},{"datasource":"$env","description":"Postgres server Uptime","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"dateTimeFromNow"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":10,"y":0},"id":186,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7.3.4","targets":[{"expr":"pg_postmaster_start_time_seconds{site=\"$site\"} * 1000","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"PostgreSQL Uptime","type":"stat"},{"cacheTimeout":null,"datasource":"$env","description":"master only","fieldConfig":{"defaults":{"custom":{"align":null,"filterable":false},"links":[],"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"#EAB839","value":100},{"color":"orange","value":1000},{"color":"red","value":10000}]},"unit":"rows/s"},"overrides":[]},"gridPos":{"h":8,"w":8,"x":16,"y":0},"id":87,"interval":null,"links":[],"maxDataPoints":1,"options":{"displayMode":"lcd","orientation":"horizontal","reduceOptions":{"calcs":["max"],"fields":"","values":false},"showUnfilled":true},"pluginVersion":"7.3.4","targets":[{"expr":"topk(5, sum by (relname,datname) (rate(pg_stat_user_tables_n_tup_ins{site=\"$site\", server=\"$pg_master\"}[$__rate_interval])))","format":"time_series","hide":false,"instant":true,"interval":"","intervalFactor":1,"legendFormat":"{{datname}}/{{relname}} INSERTs","refId":"B","step":5},{"expr":"topk(5, sum by (relname,datname) (rate(pg_stat_user_tables_n_tup_upd{site=\"$site\", server=\"$pg_master\"}[$__rate_interval])))","format":"time_series","hide":false,"instant":true,"interval":"","intervalFactor":1,"legendFormat":"{{datname}}/{{relname}} UPDATEs","refId":"A","step":5}],"timeFrom":null,"timeShift":null,"title":"Top10 rows touched by INSERTs/UPDATEs per table","type":"bargauge"},{"datasource":"$env","description":"storage IO blocks hit/miss ratio","fieldConfig":{"defaults":{"custom":{},"mappings":[],"max":1,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"orange","value":0.75},{"color":"#EAB839","value":0.9},{"color":"green","value":0.95}]},"unit":"percentunit"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":0,"y":4},"id":91,"options":{"reduceOptions":{"calcs":["min"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true},"pluginVersion":"7.3.4","targets":[{"expr":"avg by (server) (rate(pg_stat_database_blks_hit{server=~\"$dbserver\", datname=~\"$database\"}[$__rate_interval])) / avg by (server) (rate(pg_stat_database_blks_hit{server=~\"$dbserver\", datname=~\"$database\"}[$__rate_interval]) + rate(pg_stat_database_blks_read{server=~\"$dbserver\", datname=~\"$database\"}[$__rate_interval]))","hide":false,"interval":"","legendFormat":"{{server}}","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"%cache usage","type":"gauge"},{"cacheTimeout":null,"datasource":"$env","description":"ratio dead / total rows","fieldConfig":{"defaults":{"custom":{},"mappings":[{"id":0,"op":"=","text":"N/A","type":1,"value":"null"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"orange","value":0.015},{"color":"red","value":0.02}]},"unit":"percentunit"},"overrides":[]},"gridPos":{"h":4,"w":2,"x":6,"y":4},"id":57,"interval":null,"links":[],"maxDataPoints":100,"options":{"colorMode":"background","graphMode":"area","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7.3.4","targets":[{"expr":"sum(pg_stat_user_tables_n_dead_tup{site=\"$site\", datname=~\"$database\", server=\"$pg_master\"}) / (sum(pg_stat_user_tables_n_live_tup{site=\"$site\", datname=~\"$database\", server=\"$pg_master\"}) + sum(pg_stat_user_tables_n_dead_tup{site=\"$site\", datname=~\"$database\", server=\"$pg_master\"}))","hide":false,"instant":false,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Global fragmentation","type":"stat"},{"cacheTimeout":null,"datasource":"$env","fieldConfig":{"defaults":{"custom":{"align":null,"filterable":false},"links":[],"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"#EAB839","value":100},{"color":"orange","value":1000},{"color":"red","value":10000}]},"unit":"scan/s"},"overrides":[]},"gridPos":{"h":8,"w":8,"x":8,"y":4},"id":85,"interval":null,"links":[],"maxDataPoints":1,"options":{"displayMode":"lcd","orientation":"horizontal","reduceOptions":{"calcs":["max"],"fields":"","values":false},"showUnfilled":true},"pluginVersion":"7.3.4","targets":[{"expr":"topk(10, sum by (relname,datname) (rate(pg_stat_user_tables_seq_scan{site=\"$site\"}[$__rate_interval])))","format":"time_series","hide":false,"instant":true,"interval":"","intervalFactor":1,"legendFormat":"{{datname}}/{{relname}}","refId":"A","step":5}],"timeFrom":null,"timeShift":null,"title":"Top10 table seq scan rates","type":"bargauge"},{"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"decimals":1,"links":[],"mappings":[],"max":1,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"orange","value":0.75},{"color":"red","value":0.9}]},"unit":"percentunit"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":0,"y":8},"id":84,"links":[],"options":{"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true},"pluginVersion":"7.3.4","targets":[{"expr":"(sum by (server) (pg_stat_database_numbackends{server=~\"$dbserver\"})) / on(server) (sum by (server) (pg_settings_max_connections{server=~\"$dbserver\"}))","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{server}}","refId":"C","step":2}],"timeFrom":null,"timeShift":null,"title":"% client connected","type":"gauge"},{"datasource":"$env","description":"Maximum count over sliding 10m window","fieldConfig":{"defaults":{"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":1}]}},"overrides":[]},"gridPos":{"h":4,"w":2,"x":6,"y":8},"id":73,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["max"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7.3.4","targets":[{"expr":"sum({__name__=~\"pg_stat_database_(deadlocks|conflicts).*\",server=~\"$dbserver\"}) - sum({__name__=~\"pg_stat_database_(deadlocks|conflicts).*\",server=~\"$dbserver\"} offset 10m)","interval":"","legendFormat":"","refId":"B"}],"timeFrom":null,"timeShift":null,"title":"Conflict/Deadlock","type":"stat"},{"datasource":"$env","description":"writes/s, instant, master only","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"gridPos":{"h":8,"w":4,"x":16,"y":8},"id":149,"options":{"datasource_tags_field":"relname","series_index":0,"wordCloudOptions":{"deterministic":true,"enableTooltip":true,"fontFamily":"arial","fontSizes":[15,80],"padding":1,"rotationAngles":[0,0],"rotations":2,"scale":"linear","spiral":"archimedean","transitionDuration":800}},"pluginVersion":"7.3.4","targets":[{"expr":"topk(25, sum(rate(pg_stat_user_tables_n_tup_ins{server=\"$pg_master\"}[5m]) + rate(pg_stat_user_tables_n_tup_upd{server=\"$pg_master\"}[5m]) + rate(pg_stat_user_tables_n_tup_del{server=\"$pg_master\"}[5m])) by (relname))","format":"table","instant":true,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Most written tables","type":"magnesium-wordcloud-panel"},{"datasource":"$env","description":"sed + idx reads/s, instant, selected server(s)","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"gridPos":{"h":8,"w":4,"x":20,"y":8},"id":148,"options":{"datasource_tags_field":"relname","series_index":0,"wordCloudOptions":{"deterministic":true,"enableTooltip":true,"fontFamily":"arial","fontSizes":[15,80],"padding":1,"rotationAngles":[0,0],"rotations":2,"scale":"linear","spiral":"archimedean","transitionDuration":800}},"pluginVersion":"7.3.4","targets":[{"expr":"topk(25, sum(rate(pg_stat_user_tables_idx_tup_fetch{site=\"$site\"}[5m]) + rate(pg_stat_user_tables_seq_tup_read{site=\"$site\"}[5m])) by (relname))","format":"table","instant":true,"interval":"","legendFormat":"","queryType":"randomWalk","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Most read tables","type":"magnesium-wordcloud-panel"},{"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"mappings":[],"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"ops"},"overrides":[]},"gridPos":{"h":8,"w":2,"x":6,"y":12},"id":89,"options":{"colorMode":"background","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7.3.4","targets":[{"expr":"sum(rate(pg_stat_database_xact_commit{datname!~\"(template|postgres|rdsadmin).*\",server=~\"$dbserver\"}[$__rate_interval]))","hide":false,"interval":"","legendFormat":"commit","refId":"A"},{"expr":"sum(rate(pg_stat_database_xact_rollback{datname!~\"(template|postgres|rdsadmin).*\",server=~\"$dbserver\"}[$__rate_interval]))","hide":false,"interval":"","legendFormat":"rollback","refId":"B"}],"timeFrom":null,"timeShift":null,"title":"Transaction rate","type":"stat"},{"cacheTimeout":null,"datasource":"$env","fieldConfig":{"defaults":{"custom":{"align":null,"filterable":false},"links":[],"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"#EAB839","value":1000},{"color":"orange","value":10000},{"color":"red","value":100000}]},"unit":"scan/s"},"overrides":[]},"gridPos":{"h":8,"w":8,"x":8,"y":12},"id":86,"interval":null,"links":[],"maxDataPoints":1,"options":{"displayMode":"lcd","orientation":"horizontal","reduceOptions":{"calcs":["max"],"fields":"","values":false},"showUnfilled":true},"pluginVersion":"7.3.4","targets":[{"expr":"topk(10, sum by (relname,datname) (rate(pg_stat_user_tables_idx_scan{site=\"$site\"}[$__rate_interval])))","hide":false,"instant":true,"interval":"","legendFormat":"{{datname}}/{{relname}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Top10 table idx scan rates","transformations":[],"type":"bargauge"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":20},"id":407,"panels":[{"aliasColors":{"Max connections":"dark-red"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":24,"x":0,"y":21},"hiddenSeries":false,"id":176,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","repeat":"node","repeatDirection":"h","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"pg_database_size_bytes{site=\"$site\", server=\"$pg_master\", datname=~\"$database\"}","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{datname}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"DB Size","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":12,"w":12,"x":0,"y":29},"hiddenSeries":false,"id":27,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideZero":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/seq tuple read/","linewidth":2,"yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (datname) (rate(pg_stat_user_tables_seq_scan{site=\"$site\", datname=~\"$database\"}[$__rate_interval]))","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"seq scan {{datname}}","refId":"A","step":5},{"expr":"sum by (datname) (rate(pg_stat_user_tables_seq_tup_read{site=\"$site\", datname=~\"$database\"}[$__rate_interval]))","interval":"","legendFormat":"seq tuple read {{datname}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Table scans per DB","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"seq scans/s","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":"tuples read/s","logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":12,"w":12,"x":12,"y":29},"hiddenSeries":false,"id":29,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"hideZero":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/index tuple fetch/","linewidth":2,"yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":true,"targets":[{"expr":"sum by (datname) (rate(pg_stat_user_tables_idx_scan{site=\"$site\", datname=~\"$database\"}[$__rate_interval]))","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"index scan {{datname}}","refId":"A","step":5},{"expr":"sum by (datname) (rate(pg_stat_user_tables_idx_tup_fetch{site=\"$site\", datname=~\"$database\"}[$__rate_interval]))","hide":false,"interval":"","legendFormat":"index tuple fetch {{datname}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Index scans per DB","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"index scans/s","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":"tuples fetched/s","logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":41},"hiddenSeries":false,"id":31,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideZero":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (datname) (rate(pg_stat_user_tables_n_tup_ins{site=\"$site\", datname=~\"$database\"}[2m]) or rate(pg_stat_user_tables_light_n_tup_ins{site=\"$site\", datname=~\"$database\"}[2m]))","format":"time_series","hide":false,"interval":"","intervalFactor":1,"legendFormat":"Tuple inserted on {{datname}}","refId":"A","step":5},{"expr":"sum by (datname) (rate(pg_stat_user_tables_n_tup_upd{site=\"$site\", datname=~\"$database\"}[2m]) or rate(pg_stat_user_tables_light_n_tup_upd{site=\"$site\", datname=~\"$database\"}[2m]))","hide":false,"interval":"","legendFormat":"Tuple updated on {{datname}}","refId":"C"},{"expr":"sum by (datname) (rate(pg_stat_user_tables_n_tup_del{site=\"$site\", datname=~\"$database\"}[2m]) or rate(pg_stat_user_tables_light_n_tup_del{site=\"$site\", datname=~\"$database\"}[2m]))","hide":false,"interval":"","legendFormat":"Tuple deleted on {{datname}}","refId":"D"},{"expr":"sum by (datname) (rate(pg_stat_user_tables_n_tup_hot_upd{site=\"$site\", datname=~\"$database\"}[2m]) or rate(pg_stat_user_tables_light_n_tup_hot_upd{site=\"$site\", datname=~\"$database\"}[2m]))","interval":"","legendFormat":"Tuple hot updated on {{datname}}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Write ops rate per DB","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"rows/s","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Activity by Database","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":21},"id":13,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":10,"w":12,"x":0,"y":110},"hiddenSeries":false,"id":65,"legend":{"alignAsTable":true,"avg":false,"current":true,"hideEmpty":false,"hideZero":false,"max":true,"min":false,"show":true,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":false},"percentage":false,"pluginVersion":"7.3.4","pointradius":3,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/active/","color":"#F2495C"},{"alias":"/idle in transaction/","color":"#FF9830"},{"alias":"/idle on/","color":"#73BF69"}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"pg_stat_activity_max_tx_duration{server=~\"$dbserver\", datname=~\"$database\"} > 0","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{state}} on {{server}}/{{datname}}","refId":"A","step":5}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Longest transaction","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"","logBase":10,"max":null,"min":0,"show":true},{"format":"short","label":"","logBase":1,"max":null,"min":"0","show":false}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":110},"hiddenSeries":false,"id":431,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (server) (rate(pg_stat_user_tables_n_tup_ins{server=~\"dbserver\", datname=~\"$database\"}[$__rate_interval])) > 0","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"Tuple inserted on {{server}}","refId":"A","step":5},{"expr":"sum by (server) (rate(pg_stat_user_tables_n_tup_upd{server=~\"$dbserver\", datname=~\"$database\"}[$__rate_interval])) > 0","interval":"","legendFormat":"Tuple updated on {{server}}","refId":"C"},{"expr":"sum by (server) (rate(pg_stat_user_tables_n_tup_del{server=~\"$dbserver\", datname=~\"$database\"}[$__rate_interval])) > 0","interval":"","legendFormat":"Tuple deleted on {{server}}","refId":"D"},{"expr":"sum by (server) (rate(pg_stat_user_tables_n_tup_hot_upd{server=~\"$dbserver\", datname=~\"$database\"}[$__rate_interval])) > 0","interval":"","legendFormat":"Tuple hot updated on {{server}}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Write ops rate","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"rows/s","logBase":10,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"repeat":null,"title":"Queries","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":22},"id":39,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":0,"y":23},"hiddenSeries":false,"id":47,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"hideZero":true,"max":true,"min":false,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"(sum(pg_stat_user_tables_n_live_tup{server=\"$pg_master\", datname=~\"$database\"}) by (relname,datname)) - (sum(pg_stat_user_tables_n_live_tup{server=\"$pg_master\", datname=~\"$database\"} offset $__interval) by (relname,datname)) != 0","hide":false,"interval":"","legendFormat":"{{datname}} {{relname}}","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Rows added/removed","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"rows","logBase":10,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","description":"","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":12,"y":23},"hiddenSeries":false,"id":48,"legend":{"avg":false,"current":false,"hideZero":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/vacuum/","color":"#FF9830","points":true,"yaxis":2},{"alias":"/analyze/","color":"#73BF69","points":true,"yaxis":2},{"alias":"/Total/","color":"#E02F44","fill":0,"linewidth":2,"stack":false}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"topk(25, sum(pg_stat_user_tables_n_dead_tup{server=\"$pg_master\", datname=~\"$database\"}) by (datname, schemaname, relname))","interval":"","legendFormat":"{{datname}} {{schemaname}}.{{relname}}","refId":"A"},{"expr":"sum(pg_stat_user_tables_n_dead_tup{server=\"$pg_master\", datname=~\"$database\"})","interval":"","legendFormat":"Total dead tuples","refId":"F"},{"expr":"rate(pg_stat_user_tables_autovacuum_count{server=\"$pg_master\", datname=~\"$database\"}[$__rate_interval]) > 0","interval":"","legendFormat":"auto vacuum {{datname}} {{schemaname}}.{{relname}}","refId":"B"},{"expr":"rate(pg_stat_user_tables_vacuum_count{server=\"$pg_master\", datname=~\"$database\"}[$__rate_interval]) > 0","interval":"","legendFormat":"vacuum {{datname}} {{schemaname}}.{{relname}}","refId":"C"},{"expr":"rate(pg_stat_user_tables_analyze_count{server=\"$pg_master\", datname=~\"$database\"}[$__rate_interval]) > 0","interval":"","legendFormat":"analyze {{datname}} {{schemaname}}.{{relname}}","refId":"D"},{"expr":"rate(pg_stat_user_tables_autoanalyze_count{server=\"$pg_master\", datname=~\"$database\"}[$__rate_interval]) > 0","interval":"","legendFormat":"auto analyze {{datname}} {{schemaname}}.{{relname}}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Top25 & total dead tuples, VACUUM/ANALYZE activity","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"rows","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":0}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","description":"Only tables with > 1000 records","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":9,"w":12,"x":0,"y":31},"hiddenSeries":false,"id":49,"legend":{"alignAsTable":false,"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":3,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"topk(5, sum(rate(pg_stat_user_tables_n_mod_since_analyze{server=\"$pg_master\", datname=~\"$database\"}[$__rate_interval]) > 0) by (relname,schemaname,datname))","interval":"","legendFormat":"{{datname}} {{schemaname}}.{{relname}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Top5 modif rate since last ANALYZE","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"none","label":"rows/s","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","description":"Only tables with > 1000 records","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":9,"w":12,"x":12,"y":31},"hiddenSeries":false,"id":45,"legend":{"alignAsTable":false,"avg":false,"current":false,"max":true,"min":true,"rightSide":false,"show":false,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"topk(25,sum(((pg_stat_user_tables_n_dead_tup{server=\"$pg_master\", datname=~\"$database\"} > 0) / (pg_stat_user_tables_n_live_tup{server=\"$pg_master\", datname=~\"$database\"} + pg_stat_user_tables_n_dead_tup{server=\"$pg_master\", datname=~\"$database\"} > 0))) by (relname,schemaname,datname))","interval":"","legendFormat":"{{datname}} {{schemaname}}.{{relname}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Most fragmented Tables","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"datasource":"$env","description":"Only tables with > 1000 records","fieldConfig":{"defaults":{"custom":{"align":null,"filterable":false},"mappings":[{"from":"","id":2,"text":"","to":"","type":1}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[{"matcher":{"id":"byRegexp","options":"Last.*"},"properties":[{"id":"unit","value":"dateTimeAsIsoNoDateIfToday"},{"id":"mappings","value":[{"from":"","id":1,"text":"-","to":"","type":1,"value":"1970-01-01 01:00:00"}]}]}]},"gridPos":{"h":12,"w":24,"x":0,"y":40},"id":43,"links":[],"options":{"showHeader":true,"sortBy":[{"desc":true,"displayName":"Dead Tuples"}]},"pluginVersion":"7.3.4","targets":[{"expr":"sum(pg_stat_user_tables_n_live_tup{server=\"$pg_master\", datname=~\"$database\"}) by (relname, schemaname,datname)","format":"table","hide":false,"instant":true,"interval":"","intervalFactor":1,"legendFormat":"","refId":"A"},{"expr":"sum(pg_stat_user_tables_n_dead_tup{server=\"$pg_master\", datname=~\"$database\"}) by (relname, schemaname,datname)","format":"table","hide":false,"instant":true,"interval":"","intervalFactor":1,"legendFormat":"","refId":"B"},{"expr":"sum(pg_stat_user_tables_n_mod_since_analyze{server=\"$pg_master\", datname=~\"$database\"}) by (relname, schemaname, datname)","format":"table","hide":false,"instant":true,"interval":"","intervalFactor":1,"legendFormat":"","refId":"H"},{"expr":"sum(pg_stat_user_tables_last_autovacuum{server=\"$pg_master\", datname=~\"$database\"}) by (relname, schemaname,datname) * 1000","format":"table","hide":false,"instant":true,"interval":"","intervalFactor":1,"legendFormat":"","refId":"C"},{"expr":"sum(pg_stat_user_tables_last_vacuum{server=\"$pg_master\", datname=~\"$database\"}) by (relname, schemaname,datname) * 1000","format":"table","hide":false,"instant":true,"interval":"","intervalFactor":1,"legendFormat":"","refId":"D"},{"expr":"sum(pg_stat_user_tables_last_autoanalyze{server=\"$pg_master\", datname=~\"$database\"}) by (relname, schemaname,datname) * 1000","format":"table","hide":false,"instant":true,"interval":"","intervalFactor":1,"legendFormat":"","refId":"E"},{"expr":"sum(pg_stat_user_tables_last_analyze{server=\"$pg_master\", datname=~\"$database\"}) by (relname, schemaname,datname) * 1000","format":"table","hide":false,"instant":true,"interval":"","intervalFactor":1,"legendFormat":"","refId":"F"},{"expr":"sum(((pg_stat_user_tables_n_dead_tup{server=\"$pg_master\", datname=~\"$database\"} > 0)/ (pg_stat_user_tables_n_live_tup{server=\"$pg_master\"} > 0) )* 100) by (relname,schemaname,datname)","format":"table","hide":false,"instant":true,"interval":"","intervalFactor":1,"legendFormat":"fragmentation","refId":"G"}],"title":"Tables Statistics","transformations":[{"id":"merge","options":{}},{"id":"organize","options":{"excludeByName":{"Time":true},"indexByName":{"Time":0,"Value #A":4,"Value #B":5,"Value #C":8,"Value #D":9,"Value #E":10,"Value #F":11,"Value #G":6,"Value #H":7,"datname":1,"relname":3,"schemaname":2},"renameByName":{"Value #A":"Live tuples","Value #B":"Dead Tuples","Value #C":"Last Autovacuum","Value #D":"Last Vacuum","Value #E":"Last Auto Analyse","Value #F":"Last Analyse","Value #G":"% Fragmentation","Value #H":"Mod since analyse","datname":"Database","relname":"Table","schemaname":"Schema"}}}],"type":"table"}],"title":"Table fragmentation (only master server)","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":23},"id":59,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","description":"Sum accross selected servers","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":17,"w":6,"x":0,"y":82},"hiddenSeries":false,"id":60,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/seq tuple read/","linewidth":2,"yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (relname) (rate(pg_stat_user_tables_seq_scan{relname=~\"$focus_table\",site=\"$site\", datname=~\"$database\"}[$__rate_interval]))","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"seq scan {{relname}}","refId":"A","step":5},{"expr":"sum by (relname) (rate(pg_stat_user_tables_seq_tup_read{relname=~\"$focus_table\",site=\"$site\", datname=~\"$database\"}[$__rate_interval]))","interval":"","legendFormat":"seq tuple read {{relname}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Table scans","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"seq scans/s","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":"tuples read/s","logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","description":"Sum accross selected servers","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"grid":{},"gridPos":{"h":17,"w":6,"x":6,"y":82},"hiddenSeries":false,"id":61,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/index tuple fetch/","linewidth":2,"yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (relname) (rate(pg_stat_user_tables_idx_scan{relname=~\"$focus_table\",site=~\"$site\", datname=~\"$database\"}[$__rate_interval]))","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"index scan {{relname}}","refId":"A","step":5},{"expr":"sum by (relname) (rate(pg_stat_user_tables_idx_tup_fetch{relname=~\"$focus_table\",site=~\"$site\", datname=~\"$database\"}[$__rate_interval]))","hide":false,"interval":"","legendFormat":"index tuple fetch {{relname}}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Index scans","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"cumulative"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"index scans/s","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":"tuples fetched/s","logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","description":"Master server only","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":17,"w":6,"x":12,"y":82},"hiddenSeries":false,"id":62,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (relname) (rate(pg_stat_user_tables_n_tup_ins{relname=~\"$focus_table\",server=\"$pg_master\", datname=~\"$database\"}[$__rate_interval])) + sum by (relname) (rate(pg_stat_user_tables_n_tup_upd{relname=~\"$focus_table\",server=\"$pg_master\", datname=~\"$database\"}[$__rate_interval])) + sum by (relname) (rate(pg_stat_user_tables_n_tup_del{relname=~\"$focus_table\",server=\"$pg_master\", datname=~\"$database\"}[$__rate_interval])) + sum by (relname) (rate(pg_stat_user_tables_n_tup_hot_upd{relname=~\"$focus_table\",server=\"$pg_master\", datname=~\"$database\"}[$__rate_interval]))","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{relname}} Total","refId":"A","step":5},{"expr":"sum by (relname) (rate(pg_stat_user_tables_n_tup_ins{relname=~\"$focus_table\",server=\"$pg_master\", datname=~\"$database\"}[$__rate_interval]))","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{relname}} inserts","refId":"B","step":5},{"expr":"sum by (relname) (rate(pg_stat_user_tables_n_tup_upd{relname=~\"$focus_table\",server=\"$pg_master\", datname=~\"$database\"}[$__rate_interval]))","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{relname}} updates","refId":"C","step":5},{"expr":"sum by (relname) (rate(pg_stat_user_tables_n_tup_hot_upd{relname=~\"$focus_table\",server=\"$pg_master\", datname=~\"$database\"}[$__rate_interval]))","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{relname}} hot updates","refId":"D","step":5},{"expr":"sum by (relname) (rate(pg_stat_user_tables_n_tup_del{relname=~\"$focus_table\",server=\"$pg_master\", datname=~\"$database\"}[$__rate_interval]))","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{relname}} deletes","refId":"E","step":5}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Write ops rate","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":10,"max":null,"min":null,"show":true},{"format":"ops","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":7,"w":6,"x":18,"y":82},"hiddenSeries":false,"id":51,"legend":{"avg":false,"current":false,"hideZero":true,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/(vacuum|analyze) .+/","bars":true,"hideTooltip":false,"lines":false,"yaxis":2},{"alias":"/vacuum .+/","color":"#FF9830"},{"alias":"/analyze .+/","color":"#73BF69"}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(((pg_stat_user_tables_n_dead_tup{server=\"$pg_master\", relname=~\"$focus_table\", datname=~\"$database\"} > 0)/ (pg_stat_user_tables_n_live_tup{server=\"$pg_master\", relname=~\"$focus_table\", datname=~\"$database\"} > 0) )* 100) by (relname,schemaname,datname)","hide":false,"interval":"","legendFormat":"{{datname}} {{schemaname}}.{{relname}} fragmentation %","refId":"A"},{"expr":"pg_stat_user_tables_n_dead_tup{server=\"$pg_master\", relname=~\"$focus_table\", datname=~\"$database\"} /\n(\n    (pg_stat_user_tables_n_live_tup{server=\"$pg_master\", relname=~\"$focus_table\", datname=~\"$database\"} *\n     ignoring (datname,relname,schemaname) group_left (server) pg_settings_autovacuum_vacuum_scale_factor{server=\"$pg_master\"}\n    ) + ignoring (datname,relname,schemaname) group_left (server) pg_settings_autovacuum_vacuum_threshold{server=\"$pg_master\"}\n) * 100","hide":false,"interval":"","legendFormat":"{{datname}} {{schemaname}}.{{relname}} maintenance  needed %","refId":"B"},{"expr":"pg_stat_user_tables_vacuum_count{server=\"$pg_master\",relname=~\"$focus_table\", datname=~\"$database\"} - (pg_stat_user_tables_vacuum_count{server=\"$pg_master\",relname=~\"$focus_table\", datname=~\"$database\"} offset $__interval)","interval":"","legendFormat":"vacuum {{relname}}","refId":"C"},{"expr":"pg_stat_user_tables_autovacuum_count{server=\"$pg_master\",relname=~\"$focus_table\", datname=~\"$database\"} - (pg_stat_user_tables_autovacuum_count{server=\"$pg_master\",relname=~\"$focus_table\", datname=~\"$database\"} offset $__interval)","interval":"","legendFormat":"autovacuum {{relname}}","refId":"D"},{"expr":"pg_stat_user_tables_autoanalyze_count{server=\"$pg_master\",relname=~\"$focus_table\", datname=~\"$database\"} - (pg_stat_user_tables_autoanalyze_count{server=\"$pg_master\",relname=~\"$focus_table\", datname=~\"$database\"} offset $__interval)","interval":"","legendFormat":"autoanalyze {{relname}}","refId":"E"},{"expr":"pg_stat_user_tables_analyze_count{server=\"$pg_master\",relname=~\"$focus_table\", datname=~\"$database\"} - (pg_stat_user_tables_analyze_count{server=\"$pg_master\",relname=~\"$focus_table\", datname=~\"$database\"} offset $__interval)","interval":"","legendFormat":"analyze {{relname}}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Focus Tables live/dead tuples ratio (fragmentation) + VACUUM/ANALYZE activity","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":null,"format":"none","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":"1","min":"0","show":false}],"yaxis":{"align":false,"alignLevel":null}},{"cacheTimeout":null,"datasource":"$env","fieldConfig":{"defaults":{"custom":{"align":null,"filterable":false},"mappings":[],"max":1,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"orange","value":0.75},{"color":"#EAB839","value":0.9},{"color":"green","value":0.95}]},"unit":"percentunit"},"overrides":[]},"gridPos":{"h":10,"w":6,"x":18,"y":89},"id":92,"interval":null,"links":[],"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7.3.4","targets":[{"expr":"sum(rate(pg_statio_user_tables_idx_blks_hit{relname=~\"$focus_table\", datname=~\"$database\", site=\"$site\"}[$__rate_interval])) by (relname)  / (sum(rate(pg_statio_user_tables_idx_blks_hit{relname=~\"$focus_table\", datname=~\"$database\", site=\"$site\"}[$__rate_interval])) by (relname) + sum(rate(pg_statio_user_tables_idx_blks_read{relname=~\"$focus_table\", datname=~\"$database\", site=\"$site\"}[$__rate_interval])) by (relname))","interval":"","legendFormat":"{{relname}} idx","refId":"A"},{"expr":"sum(rate(pg_statio_user_tables_heap_blks_hit{relname=~\"$focus_table\", datname=~\"$database\", site=\"$site\"}[$__rate_interval])) by (relname)  / (sum(rate(pg_statio_user_tables_heap_blks_hit{relname=~\"$focus_table\", datname=~\"$database\", site=\"$site\"}[$__rate_interval])) by (relname) + sum(rate(pg_statio_user_tables_heap_blks_read{relname=~\"$focus_table\", datname=~\"$database\", site=\"$site\"}[$__rate_interval])) by (relname))","instant":false,"interval":"","legendFormat":"{{relname}} heap","refId":"B"}],"timeFrom":null,"timeShift":null,"title":"IO %cache usage","type":"stat"}],"title":"Focus tables","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":24},"id":100,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":8,"w":9,"x":0,"y":83},"hiddenSeries":false,"id":110,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":false,"hideZero":false,"max":true,"min":false,"show":true,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"label_replace(topk(5, rate(pg_stat_statements_most_frequent_calls{site=\"$site\"}[$__rate_interval])) by (server), \"short_name\", \"$1\", \"server\", \"([^\\\\.]+)\\\\..+\")","hide":false,"instant":false,"interval":"","legendFormat":"{{short_name}}/{{datname}}: {{queryid}} ({{shrunk_query_text}})","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Most frequent queries (5 worst by server)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"reqps","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":8,"w":9,"x":9,"y":83},"hiddenSeries":false,"id":106,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"label_replace(topk(5, (pg_stat_statements_total_time_total_time_seconds{site=\"$site\"} - (pg_stat_statements_total_time_total_time_seconds{site=\"$site\"} offset 10m))) by (server), \"short_name\", \"$1\", \"server\", \"([^\\\\.]+)\\\\..+\")","interval":"","legendFormat":"{{short_name}}/{{datname}}: {{queryid}} ({{shrunk_query_text}})","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Total time spent during last 10min (5 worst by server)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":8,"w":6,"x":18,"y":83},"hiddenSeries":false,"id":94,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":false,"show":true,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null as zero","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":3,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"label_replace(rate(pg_stat_statements_temp_files_temp_blks_read{site=\"$site\",shrunk_query_text!~\"SELECT.+queryid,.+\"}[$__rate_interval]) > 0, \"short_name\", \"$1\", \"server\", \"([^\\\\.]+)\\\\..+\")","interval":"","legendFormat":"reads {{short_name}}/{{datname}}: {{queryid}} ({{shrunk_query_text}})","refId":"A"},{"expr":"label_replace(rate(pg_stat_statements_temp_files_temp_blks_written{server=\"$site\",shrunk_query_text!~\"SELECT.+queryid,.+\"}[$__rate_interval]) * -1 < 0, \"short_name\", \"$1\", \"server\", \"([^\\\\.]+)\\\\..+\")","interval":"","legendFormat":"writes {{short_name}}/{{datname}}: {{queryid}} ({{shrunk_query_text}})","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Queries triggering temporary files (work_mem overflow)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"mappings":[],"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"#EAB839","value":5},{"color":"orange","value":15},{"color":"red","value":60}]},"unit":"s"},"overrides":[]},"gridPos":{"h":7,"w":24,"x":0,"y":91},"id":108,"options":{"displayMode":"lcd","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showUnfilled":true},"pluginVersion":"7.3.4","targets":[{"expr":"topk(5, label_replace(pg_stat_statements_max_time_max_time_seconds{server=~\"$dbserver\"}, \"short_name\", \"$1\", \"server\", \"([^\\\\.]+)\\\\..+\")) by (server)","interval":"","legendFormat":"{{short_name}}/{{datname}}: {{queryid}} ({{shrunk_query_text}})","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Slowest single queries (5 worst by server)","type":"bargauge"},{"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"mappings":[],"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"#EAB839","value":10000},{"color":"orange","value":100000},{"color":"red","value":1000000}]},"unit":"rows"},"overrides":[]},"gridPos":{"h":7,"w":24,"x":0,"y":98},"id":109,"options":{"displayMode":"lcd","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showUnfilled":true},"pluginVersion":"7.3.4","targets":[{"expr":"label_replace(topk(5, pg_stat_statements_most_rows_rows{server=~\"$dbserver\"} / pg_stat_statements_most_rows_calls{server=~\"$dbserver\"}) by (server), \"short_name\", \"$1\", \"server\", \"([^\\\\.]+)\\\\..+\")","interval":"","legendFormat":"{{short_name}}/{{datname}}: {{queryid}} ({{shrunk_query_text}})","refId":"B"}],"timeFrom":null,"timeShift":null,"title":"Single queries returning the most rows per call (5 worst by server)","type":"bargauge"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","description":"For full details run:\nSELECT * from pg_stat_statements WHERE queryid='$focus_query';","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":8,"w":9,"x":0,"y":105},"hiddenSeries":false,"id":112,"legend":{"alignAsTable":true,"avg":false,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/^rows returned/","yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"max(rate(label_replace({__name__=~\"pg_stat_statements_.+_calls\",queryid=\"$focus_query\"}, \"metric_name\", \"$1\", \"__name__\", \"(.+)\")[$__rate_interval:$__interval])) by (queryid,shrunk_query_text)","interval":"","legendFormat":"request rate: {{shrunk_query_text}}[...]","refId":"A"},{"expr":"max(rate(label_replace({__name__=~\"pg_stat_statements_.+_rows\",queryid=\"$focus_query\"}, \"metric_name\", \"$1\", \"__name__\", \"(.+)\")[$__rate_interval:$__interval])) by (queryid,shrunk_query_text)","hide":false,"interval":"","legendFormat":"rows returned: {{shrunk_query_text}}[...]","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Drilldown on query ID \"$focus_query\"","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"queries/s","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":"rows returned/s","logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","description":"","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":9,"y":105},"hiddenSeries":false,"id":118,"legend":{"alignAsTable":true,"avg":false,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"max(rate(label_replace({__name__=~\"pg_stat_statements_.+_blks_read\",queryid=\"$focus_query\"}, \"metric_name\", \"$1\", \"__name__\", \"(.+)\")[$__rate_interval:$__interval])) by (queryid,shrunk_query_text)","interval":"","legendFormat":"IO reads: {{shrunk_query_text}}[...]","refId":"A"},{"expr":"(max(rate(label_replace({__name__=~\"pg_stat_statements_.+_blks_read\",queryid=\"$focus_query\"}, \"metric_name\", \"$1\", \"__name__\", \"(.+)\")[$__rate_interval:$__interval])) by (queryid,shrunk_query_text)) * -1","interval":"","legendFormat":"IO writes: {{shrunk_query_text}}[...]","refId":"C"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Drilldown on query ID \"$focus_query\"","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":"","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":"","logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"mappings":[],"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"rgb(0, 0, 0)","value":null}]},"unit":"s"},"overrides":[{"matcher":{"id":"byRegexp","options":"/stddev|calls|rows/"},"properties":[{"id":"unit","value":"none"}]}]},"gridPos":{"h":8,"w":7,"x":17,"y":105},"id":113,"options":{"colorMode":"background","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7.3.4","targets":[{"expr":"max(label_replace({__name__=~\"pg_stat_statements_.+_max_time_seconds\",queryid=\"$focus_query\"}, \"metric_name\", \"$1\", \"__name__\", \"(.+)\")) by (queryid)","hide":false,"instant":true,"interval":"","legendFormat":"max resp. time","refId":"A"},{"expr":"min(label_replace({__name__=~\"pg_stat_statements_.+_min_time_seconds\",queryid=\"$focus_query\"}, \"metric_name\", \"$1\", \"__name__\", \"(.+)\")) by (queryid)","hide":false,"instant":true,"interval":"","legendFormat":"min resp. time","refId":"B"},{"expr":"avg(label_replace({__name__=~\"pg_stat_statements_.+_mean_time_seconds\",queryid=\"$focus_query\"}, \"metric_name\", \"$1\", \"__name__\", \"(.+)\")) by (queryid)","hide":false,"instant":true,"interval":"","legendFormat":"mean resp. time","refId":"C"},{"expr":"avg(label_replace({__name__=~\"pg_stat_statements_.+_stddev_time_seconds\",queryid=\"$focus_query\"}, \"metric_name\", \"$1\", \"__name__\", \"(.+)\")) by (queryid)","hide":false,"instant":true,"interval":"","legendFormat":"resp. time stddev","refId":"D"},{"expr":"max(label_replace({__name__=~\"pg_stat_statements_.+_blk_read_time_seconds\",queryid=\"$focus_query\"}, \"metric_name\", \"$1\", \"__name__\", \"(.+)\") - label_replace({__name__=~\"pg_stat_statements_.+_blk_read_time_seconds\",queryid=\"$focus_query\"} offset 10m, \"metric_name\", \"$1\", \"__name__\", \"(.+)\")) by (queryid)","hide":false,"instant":true,"interval":"","legendFormat":"IO read time over last 10min","refId":"G"},{"expr":"max(label_replace({__name__=~\"pg_stat_statements_.+_blk_write_time_seconds\",queryid=\"$focus_query\"}, \"metric_name\", \"$1\", \"__name__\", \"(.+)\") - label_replace({__name__=~\"pg_stat_statements_.+_blk_write_time_seconds\",queryid=\"$focus_query\"} offset 10m, \"metric_name\", \"$1\", \"__name__\", \"(.+)\")) by (queryid)","hide":false,"instant":true,"interval":"","legendFormat":"IO write time over last 10min","refId":"I"},{"expr":"max(label_replace({__name__=~\"pg_stat_statements_.+_total_time_seconds\",queryid=\"$focus_query\"}, \"metric_name\", \"$1\", \"__name__\", \"(.+)\") - label_replace({__name__=~\"pg_stat_statements_.+_total_time_seconds\",queryid=\"$focus_query\"} offset 10m, \"metric_name\", \"$1\", \"__name__\", \"(.+)\")) by (queryid)","hide":false,"instant":true,"interval":"","legendFormat":"total time over last 10min","refId":"F"},{"expr":"max(label_replace({__name__=~\"pg_stat_statements_.+_rows\",queryid=\"$focus_query\"}, \"metric_name_subset\", \"$1\", \"__name__\", \"pg_stat_statements_(.+)_rows\") / label_replace({__name__=~\"pg_stat_statements_.+_calls\",queryid=\"$focus_query\"}, \"metric_name_subset\", \"$1\", \"__name__\", \"pg_stat_statements_(.+)_calls\")) by (queryid)","hide":false,"instant":true,"interval":"","legendFormat":"avg rows/call","refId":"E"},{"expr":"max(label_replace({__name__=~\"pg_stat_statements_.+_calls\",queryid=\"$focus_query\"}, \"metric_name\", \"$1\", \"__name__\", \"(.+)\") - label_replace({__name__=~\"pg_stat_statements_.+_calls\",queryid=\"$focus_query\"} offset 10m, \"metric_name\", \"$1\", \"__name__\", \"(.+)\")) by (queryid)","hide":false,"instant":true,"interval":"","legendFormat":"#calls over last 10min","refId":"H"}],"timeFrom":null,"timeShift":null,"title":"Drilldown on query ID \"$focus_query\"","type":"stat"}],"title":"Badly performing statements","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":25},"id":14,"panels":[{"aliasColors":{"master.monitoring-rds (ceil)":"#890F02","replica0.monitoring-rds (ceil)":"#890F02","replica1.monitoring-rds (ceil)":"#890F02"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":9,"w":12,"x":0,"y":26},"hiddenSeries":false,"id":33,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/current/","linewidth":2},{"alias":"/Max/","color":"#e24d42","legend":false}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (server) (pg_stat_database_numbackends{server=~\"$dbserver\"})","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{server}} (current)","refId":"C","step":2},{"expr":"min(pg_settings_max_connections{server=~\"$dbserver\"})","interval":"","legendFormat":"Max","refId":"D"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Connected clients","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{"master.monitoring-rds (ceil)":"#890F02","replica0.monitoring-rds (ceil)":"#890F02","replica1.monitoring-rds (ceil)":"#890F02"},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":9,"w":12,"x":12,"y":26},"hiddenSeries":false,"id":37,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"sort":null,"sortDesc":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/current/","linewidth":2},{"alias":"/Max/","color":"#e24d42","legend":false,"stack":false}],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum by (datname) (pg_stat_database_numbackends{server=~\"$dbserver\", datname=~\"$database\"}) > 0","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{datname}}","refId":"C","step":2},{"expr":"sum(pg_settings_max_connections{server=~\"$dbserver\"})","interval":"","legendFormat":"Max","refId":"D"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Connected clients per DB (main & replicas)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":35},"hiddenSeries":false,"id":67,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","repeat":"dbserver","repeatDirection":"h","scopedVars":{"dbserver":{"selected":false,"text":"bs-pg12-prod-0.db.camptocamp.com:5432","value":"bs-pg12-prod-0.db.camptocamp.com:5432"}},"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum(pg_client_connections_count{server=~\"$dbserver\"}) by (appname, client_addr)","interval":"","legendFormat":"{{client_addr}}: {{appname}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Clients connected to $dbserver","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":0,"format":"short","label":"conn. per client","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":35},"hiddenSeries":false,"id":742,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","repeatDirection":"h","repeatIteration":1620656767634,"repeatPanelId":67,"scopedVars":{"dbserver":{"selected":false,"text":"bs-pg12-prod-offsite-0.db.camptocamp.com:5432","value":"bs-pg12-prod-offsite-0.db.camptocamp.com:5432"}},"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"sum(pg_client_connections_count{server=~\"$dbserver\"}) by (appname, client_addr)","interval":"","legendFormat":"{{client_addr}}: {{appname}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Clients connected to $dbserver","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":0,"format":"short","label":"conn. per client","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"cacheTimeout":null,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":0,"y":42},"hiddenSeries":false,"id":422,"interval":null,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"bs-pg12-prod-0.db.camptocamp.com:5432","value":"bs-pg12-prod-0.db.camptocamp.com:5432"}},"seriesOverrides":[{"alias":"work_mem * max_conns","color":"#C4162A","fill":0,"linewidth":3,"stack":false},{"alias":"work * current_connections","color":"#1F60C4","fill":0,"linewidth":3,"stack":false}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"pg_settings_work_mem_bytes{site=\"$site\", server=~\"$dbserver\"} * pg_settings_max_connections{site=\"$site\", server=~\"$dbserver\"}","hide":false,"instant":false,"interval":"","legendFormat":"work_mem * max_conns","refId":"C"},{"expr":"max by (server) (pg_settings_work_mem_bytes{site=\"$site\", server=~\"$dbserver\"}) * (count by (server) (pg_stat_database_numbackends{site=\"$site\",server=~\"$dbserver\"}))","hide":false,"instant":false,"interval":"","legendFormat":"work * current_connections","refId":"E"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Client memory usage ($dbserver)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"cacheTimeout":null,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":12,"y":42},"hiddenSeries":false,"id":743,"interval":null,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","repeatIteration":1620656767634,"repeatPanelId":422,"scopedVars":{"dbserver":{"selected":false,"text":"bs-pg12-prod-offsite-0.db.camptocamp.com:5432","value":"bs-pg12-prod-offsite-0.db.camptocamp.com:5432"}},"seriesOverrides":[{"alias":"work_mem * max_conns","color":"#C4162A","fill":0,"linewidth":3,"stack":false},{"alias":"work * current_connections","color":"#1F60C4","fill":0,"linewidth":3,"stack":false}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"pg_settings_work_mem_bytes{site=\"$site\", server=~\"$dbserver\"} * pg_settings_max_connections{site=\"$site\", server=~\"$dbserver\"}","hide":false,"instant":false,"interval":"","legendFormat":"work_mem * max_conns","refId":"C"},{"expr":"max by (server) (pg_settings_work_mem_bytes{site=\"$site\", server=~\"$dbserver\"}) * (count by (server) (pg_stat_database_numbackends{site=\"$site\",server=~\"$dbserver\"}))","hide":false,"instant":false,"interval":"","legendFormat":"work * current_connections","refId":"E"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Client memory usage ($dbserver)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"repeat":null,"title":"Clients","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":26},"id":35,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"grid":{},"gridPos":{"h":12,"w":6,"x":0,"y":27},"hiddenSeries":false,"id":8,"legend":{"alignAsTable":true,"avg":false,"current":true,"max":true,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Alert","color":"#C4162A","fill":0}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"max(pg_xlog_position{site=\"$site\"}) - min(pg_xlog_position{site=\"$site\"})","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"","refId":"A","step":2},{"expr":"1000000000","interval":"","legendFormat":"Alert","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Lag between master and last replica (xlog diff)","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"cumulative"},"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"none","label":null,"logBase":2,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"grid":{},"gridPos":{"h":12,"w":6,"x":6,"y":27},"hiddenSeries":false,"id":7,"legend":{"alignAsTable":true,"avg":false,"current":true,"max":true,"min":false,"show":true,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"pg_replication_replag{site=\"$site\"}","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{server}}","refId":"A","step":2}],"thresholds":[{"colorMode":"critical","fill":true,"line":true,"op":"gt","value":30000,"yaxis":"left"}],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Lag on replica (seconds) slave point of view","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"cumulative"},"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":null,"logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","editable":true,"error":false,"fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"grid":{},"gridPos":{"h":12,"w":6,"x":12,"y":27},"hiddenSeries":false,"id":36,"legend":{"alignAsTable":true,"avg":false,"current":true,"max":true,"min":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"pg_replication_replay_lag{site=\"$site\"}","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{client_addr}}","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Lag on replica (Bytes) master point of view","tooltip":{"msResolution":false,"shared":true,"sort":2,"value_type":"cumulative"},"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":2,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":12,"w":6,"x":18,"y":27},"hiddenSeries":false,"id":133,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"pg_xlog_position{site=\"$site\"}","interval":"","legendFormat":"{{server}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Xlog position","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"hex","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"datasource":null,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"gridPos":{"h":2,"w":12,"x":0,"y":39},"id":323,"options":{"content":"# ${dbserver}","mode":"markdown"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"bs-pg12-prod-0.db.camptocamp.com:5432","value":"bs-pg12-prod-0.db.camptocamp.com:5432"}},"timeFrom":null,"timeShift":null,"title":"","transparent":true,"type":"text"},{"datasource":null,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"gridPos":{"h":2,"w":12,"x":12,"y":39},"id":744,"options":{"content":"# ${dbserver}","mode":"markdown"},"pluginVersion":"7.3.4","repeatIteration":1620656767634,"repeatPanelId":323,"scopedVars":{"dbserver":{"selected":false,"text":"bs-pg12-prod-offsite-0.db.camptocamp.com:5432","value":"bs-pg12-prod-offsite-0.db.camptocamp.com:5432"}},"timeFrom":null,"timeShift":null,"title":"","transparent":true,"type":"text"},{"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"mappings":[{"from":"","id":1,"text":"MAIN","to":"","type":1,"value":"0"},{"from":"","id":2,"text":"REPLICA","to":"","type":1,"value":"1"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":41},"id":337,"options":{"colorMode":"value","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"bs-pg12-prod-0.db.camptocamp.com:5432","value":"bs-pg12-prod-0.db.camptocamp.com:5432"}},"targets":[{"expr":"pg_is_in_recovery{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"","type":"stat"},{"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"mappings":[{"from":"","id":1,"text":"MAIN","to":"","type":1,"value":"0"},{"from":"","id":2,"text":"REPLICA","to":"","type":1,"value":"1"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":41},"id":745,"options":{"colorMode":"value","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeatIteration":1620656767634,"repeatPanelId":337,"scopedVars":{"dbserver":{"selected":false,"text":"bs-pg12-prod-offsite-0.db.camptocamp.com:5432","value":"bs-pg12-prod-offsite-0.db.camptocamp.com:5432"}},"targets":[{"expr":"pg_is_in_recovery{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"","type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":6,"w":12,"x":0,"y":44},"hiddenSeries":false,"id":339,"legend":{"alignAsTable":false,"avg":false,"current":false,"max":false,"min":false,"rightSide":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","repeat":"dbserver","repeatDirection":"h","scopedVars":{"dbserver":{"selected":false,"text":"bs-pg12-prod-0.db.camptocamp.com:5432","value":"bs-pg12-prod-0.db.camptocamp.com:5432"}},"seriesOverrides":[{"alias":"size","yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"pg_wals_count{site=\"$site\",server=~\"$dbserver\"}","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"count","refId":"A"},{"expr":"pg_wals_size{site=\"$site\",server=~\"$dbserver\"}","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"size","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Wal segment count","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"decbytes","label":"","logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":6,"w":12,"x":12,"y":44},"hiddenSeries":false,"id":746,"legend":{"alignAsTable":false,"avg":false,"current":false,"max":false,"min":false,"rightSide":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","repeatDirection":"h","repeatIteration":1620656767634,"repeatPanelId":339,"scopedVars":{"dbserver":{"selected":false,"text":"bs-pg12-prod-offsite-0.db.camptocamp.com:5432","value":"bs-pg12-prod-offsite-0.db.camptocamp.com:5432"}},"seriesOverrides":[{"alias":"size","yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"pg_wals_count{site=\"$site\",server=~\"$dbserver\"}","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"count","refId":"A"},{"expr":"pg_wals_size{site=\"$site\",server=~\"$dbserver\"}","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"size","refId":"B"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Wal segment count","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"decbytes","label":"","logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Replication","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":27},"id":15,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":12,"w":8,"x":0,"y":110},"hiddenSeries":false,"id":9,"legend":{"alignAsTable":true,"avg":true,"current":false,"hideEmpty":false,"hideZero":true,"max":true,"min":false,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/bytes/","yaxis":2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(pg_stat_database_temp_bytes{site=\"$site\"}[$__rate_interval]) > 0","interval":"","legendFormat":"Temp bytes {{server}} DB:{{datname}}","refId":"C"},{"expr":"rate(pg_stat_database_temp_files{site=\"$site\"}[$__rate_interval]) > 0","interval":"","legendFormat":"Temp files {{server}} DB:{{datname}}","refId":"D"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Temporary tables (work_mem overflow)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"Bps","label":null,"logBase":1,"max":null,"min":"0","show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":15,"w":8,"x":8,"y":110},"hiddenSeries":false,"id":11,"legend":{"alignAsTable":true,"avg":false,"current":true,"hideZero":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/Deadlock/","color":"#E02F44","lines":false,"nullPointMode":"null","pointradius":3,"points":true},{"alias":"/Conflict/","color":"rgb(20, 20, 20)","lines":false,"nullPointMode":"null","pointradius":3,"points":true}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(pg_stat_database_deadlocks{server=~\"$dbserver\", datname=~\"$database\"}[$__rate_interval])","interval":"","legendFormat":"Deadlock {{datname}} {{server}}","refId":"B"},{"expr":"rate(pg_stat_database_conflicts{server=~\"$dbserver\", datname=~\"$database\"}[$__rate_interval])","interval":"","legendFormat":"Conflicts {{datname}} {{server}}","refId":"C"},{"expr":"max by (mode, datname, server) (rate(pg_locks_count{server=~\"$dbserver\", datname=~\"$database\"}[$__rate_interval])) > 0","hide":false,"interval":"","legendFormat":"{{mode}} {{datname}} {{server}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Lock / Conflicts","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"locks/s","logBase":2,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","description":"","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":15,"w":8,"x":16,"y":110},"hiddenSeries":false,"id":10,"legend":{"alignAsTable":true,"avg":false,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(pg_stat_activity_count{server=~\"$dbserver\", datname=~\"$database\"}) by (datname, server, state) > 0","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"{{state}} on {{server}}/{{datname}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Workers state","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"links":[]},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":13,"w":8,"x":0,"y":122},"hiddenSeries":false,"id":124,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/checkpoints/","bars":true,"legend":false,"lines":false,"yaxis":2},{"alias":"/scheduled/","color":"#56A64B"},{"alias":"/requested/","color":"#FFB357"}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"pg_stat_bgwriter_checkpoints_timed{server=~\"$dbserver\"} - (pg_stat_bgwriter_checkpoints_timed{server=~\"$dbserver\"} offset $__interval)","hide":false,"interval":"","legendFormat":"scheduled checkpoints: {{server}}","refId":"D"},{"expr":"pg_stat_bgwriter_checkpoints_req{server=~\"$dbserver\"} - (pg_stat_bgwriter_checkpoints_req{server=~\"$dbserver\"} offset $__interval)","hide":false,"interval":"","legendFormat":"requested checkpoints: {{server}}","refId":"C"},{"expr":"rate(pg_stat_bgwriter_checkpoint_write_time{server=~\"$dbserver\"}[$__rate_interval])","format":"time_series","hide":false,"interval":"","intervalFactor":1,"legendFormat":"write time rate: {{server}}","refId":"B"},{"expr":"rate(pg_stat_bgwriter_checkpoint_sync_time{server=~\"$dbserver\"}[$__rate_interval])","format":"time_series","hide":false,"interval":"","intervalFactor":1,"legendFormat":"sync time rate: {{server}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Background writer: checkpoints","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":"1","min":"0","show":false}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":8,"y":125},"hiddenSeries":false,"id":126,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(pg_stat_bgwriter_buffers_backend{server=~\"$dbserver\"}[$__rate_interval])","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"backend: {{server}}","refId":"A"},{"expr":"rate(pg_stat_bgwriter_buffers_alloc{server=~\"$dbserver\"}[$__rate_interval])","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"alloc: {{server}}","refId":"B"},{"expr":"rate(pg_stat_bgwriter_buffers_backend_fsync{server=~\"$dbserver\"}[$__rate_interval])","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"fsync: {{server}}","refId":"C"},{"expr":"rate(pg_stat_bgwriter_buffers_checkpoint{server=~\"$dbserver\"}[$__rate_interval])","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"checkpoint: {{server}}","refId":"D"},{"expr":"rate(pg_stat_bgwriter_buffers_clean{server=~\"$dbserver\"}[$__rate_interval])","format":"time_series","interval":"","intervalFactor":1,"legendFormat":"clean: {{server}}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Background writer: buffer allocations per type","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"buffers allocated/s","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"decimals":3,"mappings":[],"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"rgb(0, 0, 0)","value":null}]},"unit":"short"},"overrides":[]},"gridPos":{"h":10,"w":8,"x":16,"y":125},"id":136,"options":{"colorMode":"background","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7.3.4","targets":[{"expr":"sum(pg_stat_user_tables_n_live_tup{server=\"$pg_master\"})","interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Database total rows count","type":"stat"},{"aliasColors":{},"bars":false,"cacheTimeout":null,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":0,"y":135},"hiddenSeries":false,"id":138,"interval":null,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"bs-pg12-int-0.db.camptocamp.com:5432","value":"bs-pg12-int-0.db.camptocamp.com:5432"}},"seriesOverrides":[{"alias":"effective_cache_size","color":"#C4162A","fill":0,"linewidth":3,"stack":false},{"alias":"/current_conns/","color":"#1F60C4","fill":0,"linewidth":3,"stack":false}],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"pg_settings_shared_buffers_bytes{server=~\"$dbserver\"}","instant":false,"interval":"","legendFormat":"shared_buffers","refId":"A"},{"expr":"pg_settings_effective_cache_size_bytes{server=~\"$dbserver\"}","instant":false,"interval":"","legendFormat":"effective_cache_size","refId":"B"},{"expr":"pg_settings_work_mem_bytes{server=~\"$dbserver\"} * pg_settings_max_connections{server=~\"$dbserver\"}","instant":false,"interval":"","legendFormat":"work_mem * max_conns","refId":"C"},{"expr":"sum(pg_settings_work_mem_bytes{server=~\"$dbserver\"}) * sum(pg_stat_database_numbackends{server=~\"$dbserver\"})","instant":false,"interval":"","legendFormat":"work_mem * current_conns","refId":"E"},{"expr":"pg_settings_maintenance_work_mem_bytes{server=~\"$dbserver\"}","interval":"","legendFormat":"maintenance_work_mem","refId":"D"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory usage breakdown ($dbserver)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"cacheTimeout":null,"dashLength":10,"dashes":false,"datasource":"$env","fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":12,"y":135},"hiddenSeries":false,"id":717,"interval":null,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.3.4","pointradius":2,"points":false,"renderer":"flot","repeatIteration":1617960935971,"repeatPanelId":138,"scopedVars":{"dbserver":{"selected":false,"text":"bs-pg12-int-offsite-0.db.camptocamp.com:5432","value":"bs-pg12-int-offsite-0.db.camptocamp.com:5432"}},"seriesOverrides":[{"alias":"effective_cache_size","color":"#C4162A","fill":0,"linewidth":3,"stack":false},{"alias":"/current_conns/","color":"#1F60C4","fill":0,"linewidth":3,"stack":false}],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"pg_settings_shared_buffers_bytes{server=~\"$dbserver\"}","instant":false,"interval":"","legendFormat":"shared_buffers","refId":"A"},{"expr":"pg_settings_effective_cache_size_bytes{server=~\"$dbserver\"}","instant":false,"interval":"","legendFormat":"effective_cache_size","refId":"B"},{"expr":"pg_settings_work_mem_bytes{server=~\"$dbserver\"} * pg_settings_max_connections{server=~\"$dbserver\"}","instant":false,"interval":"","legendFormat":"work_mem * max_conns","refId":"C"},{"expr":"sum(pg_settings_work_mem_bytes{server=~\"$dbserver\"}) * sum(pg_stat_database_numbackends{server=~\"$dbserver\"})","instant":false,"interval":"","legendFormat":"work_mem * current_conns","refId":"E"},{"expr":"pg_settings_maintenance_work_mem_bytes{server=~\"$dbserver\"}","interval":"","legendFormat":"maintenance_work_mem","refId":"D"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory usage breakdown ($dbserver)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"repeat":null,"title":"Internals","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":28},"id":190,"panels":[{"datasource":null,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"gridPos":{"h":2,"w":12,"x":0,"y":34},"id":206,"options":{"content":"# ${dbserver}","mode":"markdown"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432"}},"timeFrom":null,"timeShift":null,"title":"","transparent":true,"type":"text"},{"datasource":null,"fieldConfig":{"defaults":{"custom":{}},"overrides":[]},"gridPos":{"h":2,"w":12,"x":12,"y":34},"id":635,"options":{"content":"# ${dbserver}","mode":"markdown"},"pluginVersion":"7.3.4","repeatIteration":1614859815859,"repeatPanelId":206,"scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432"}},"timeFrom":null,"timeShift":null,"title":"","transparent":true,"type":"text"},{"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"mappings":[{"from":"","id":1,"text":"MAIN","to":"","type":1,"value":"0"},{"from":"","id":2,"text":"REPLICA","to":"","type":1,"value":"1"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":36},"id":220,"options":{"colorMode":"value","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_is_in_recovery{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"","type":"stat"},{"datasource":"$env","fieldConfig":{"defaults":{"custom":{},"mappings":[{"from":"","id":1,"text":"MAIN","to":"","type":1,"value":"0"},{"from":"","id":2,"text":"REPLICA","to":"","type":1,"value":"1"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":36},"id":636,"options":{"colorMode":"value","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeatIteration":1614859815859,"repeatPanelId":220,"scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_is_in_recovery{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":39},"id":484,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_max_connections{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Max Connections","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":39},"id":637,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeatIteration":1614859815859,"repeatPanelId":484,"scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_max_connections{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Max Connections","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":42},"id":196,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_max_wal_size_bytes{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Max WAL size","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":42},"id":638,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeatIteration":1614859815859,"repeatPanelId":196,"scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_max_wal_size_bytes{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Max WAL size","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":45},"id":201,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_shared_buffers_bytes{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Shared Buffer","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":45},"id":639,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeatIteration":1614859815859,"repeatPanelId":201,"scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_shared_buffers_bytes{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Shared Buffer","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":48},"id":194,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_effective_cache_size_bytes{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Effective cache size","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":48},"id":640,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeatIteration":1614859815859,"repeatPanelId":194,"scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_effective_cache_size_bytes{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Effective cache size","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":51},"id":195,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_maintenance_work_mem_bytes{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Maintenance work mem","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":51},"id":641,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeatIteration":1614859815859,"repeatPanelId":195,"scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_maintenance_work_mem_bytes{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Maintenance work mem","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":54},"id":572,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_work_mem_bytes{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Work mem","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":54},"id":642,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeatIteration":1614859815859,"repeatPanelId":572,"scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_work_mem_bytes{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Work mem","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"s"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":57},"id":193,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_max_standby_streaming_delay_seconds{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Max Standby Streaming Delay","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"s"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":57},"id":643,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeatIteration":1614859815859,"repeatPanelId":193,"scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_max_standby_streaming_delay_seconds{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Max Standby Streaming Delay","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"s"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":60},"id":192,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_max_standby_archive_delay_seconds{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Max Standby Archive Delay","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"s"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":60},"id":644,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeatIteration":1614859815859,"repeatPanelId":192,"scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_max_standby_archive_delay_seconds{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Max Standby Archive Delay","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":63},"id":199,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_random_page_cost{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Random page cost","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":63},"id":645,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeatIteration":1614859815859,"repeatPanelId":199,"scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_random_page_cost{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Random page cost","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":66},"id":200,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_seq_page_cost{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Sequential page cost","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":66},"id":646,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeatIteration":1614859815859,"repeatPanelId":200,"scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_seq_page_cost{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Sequential page cost","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":69},"id":197,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_max_worker_processes{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Max Worker","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":69},"id":647,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeatIteration":1614859815859,"repeatPanelId":197,"scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_max_worker_processes{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Max Worker","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":72},"id":198,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeat":"dbserver","scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-0.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_max_parallel_workers{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Max Parallel Worker","type":"stat"},{"datasource":"$env","description":"","fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":72},"id":648,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7.3.4","repeatIteration":1614859815859,"repeatPanelId":198,"scopedVars":{"dbserver":{"selected":false,"text":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432","value":"odoo-platform-prod-database-12-int-1.cs1cloud.internal:5432"}},"targets":[{"expr":"pg_settings_max_parallel_workers{site=\"$site\", server=~\"$dbserver\"}","instant":true,"interval":"","legendFormat":"{{server}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Max Parallel Worker","type":"stat"}],"title":"Postgres Settings","type":"row"}],"refresh":"","schemaVersion":26,"style":"dark","tags":[],"templating":{"list":[{"error":null,"hide":0,"includeAll":false,"label":"Environment","multi":false,"name":"env","options":[],"query":"prometheus","queryValue":"","refresh":1,"regex":"","skipUrlSync":false,"type":"datasource"},{"allValue":null,"datasource":"$env","definition":"label_values(pg_static, site)","error":null,"hide":0,"includeAll":false,"label":null,"multi":false,"name":"site","options":[],"query":"label_values(pg_static, site)","refresh":2,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":".*","datasource":"$env","definition":"label_values(pg_database_size_bytes{site=\"$site\"}, datname)","error":null,"hide":0,"includeAll":true,"label":null,"multi":true,"name":"database","options":[],"query":"label_values(pg_database_size_bytes{site=\"$site\"}, datname)","refresh":2,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"datasource":"$env","definition":"label_values(pg_stat_user_tables_idx_scan{datname=~\"$database\", site=\"$site\"}, relname)","error":null,"hide":0,"includeAll":false,"label":"Table(s) picked for detailed analysis in \"Focus tables\" row","multi":true,"name":"focus_table","options":[],"query":"label_values(pg_stat_user_tables_idx_scan{datname=~\"$database\", site=\"$site\"}, relname)","refresh":2,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":"","current":{"selected":true,"text":["All"],"value":["$__all"]},"datasource":"$env","definition":"label_values(pg_static{site=\"$site\"}, server)","error":null,"hide":0,"includeAll":true,"label":"Database server","multi":true,"name":"dbserver","options":[],"query":"label_values(pg_static{site=\"$site\"}, server)","refresh":2,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"error":null,"hide":0,"label":"QueryID for pg_stat_statements drill-down","name":"focus_query","query":"","skipUrlSync":false,"type":"textbox"},{"allValue":null,"datasource":"$env","definition":"label_values(pg_static{site=\"$site\"}, short_version)","error":null,"hide":2,"includeAll":false,"label":null,"multi":false,"name":"pg_version","options":[],"query":"label_values(pg_static{site=\"$site\"}, short_version)","refresh":2,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"datasource":"$env","definition":"query_result(pg_is_in_recovery{site=\"$site\"} == 0)","error":null,"hide":2,"includeAll":false,"label":null,"multi":false,"name":"pg_master","query":"query_result(pg_is_in_recovery{site=\"$site\"} == 0)","refresh":0,"regex":"/.*server=\"([^\"]+)\".*/","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-6h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"💾 Postgres Database","uid":"RP86ihCGk","version":3}
---
# Source: prometheus-postgres-exporter/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-prometheus-postgres-exporter-master
  labels:
    app.kubernetes.io/name: prometheus-postgres-exporter
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: "Monitoring"
    app.kubernetes.io/managed-by: Helm
    helm.sh/chart: prometheus-postgres-exporter-2.3.7
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: prometheus-postgres-exporter
      app.kubernetes.io/instance: release-name
      pginstance: master
  template:
    metadata:
      labels:
        app.kubernetes.io/name: prometheus-postgres-exporter
        app.kubernetes.io/instance: release-name
        line: prod
        site: pg-12-prod
        pginstance: master
        config-hash: "904127dd"
    spec:
      containers:
        - name: exporter
          image: bitnami/postgres-exporter:0.9.0
          imagePullPolicy: IfNotPresent
          env:
            - name: PG_EXPORTER_AUTO_DISCOVER_DATABASES
              value: "true"
            - name: DATA_SOURCE_USER
              value: "postgres"
            - name: DATA_SOURCE_PASS
              value: "pgpass"
            - name: DATA_SOURCE_URI
              value: "master:5432/postgres?sslmode=require"
            - name: PG_EXPORTER_EXCLUDE_DATABASES
              value: "template0,template1,rdsadmin,azure_maintenance"
            - name: PG_EXPORTER_INCLUDE_DATABASES
              value: ""
            - name: PG_EXPORTER_EXTEND_QUERY_PATH
              value: /etc/prometheus-postgres-exporter/queries.yaml
          ports:
            - name: metrics
              containerPort: 9187
              protocol: TCP
          volumeMounts:
            - name: config
              mountPath: /etc/prometheus-postgres-exporter/
      volumes:
        - name: config
          configMap:
            name: release-name-prometheus-postgres-exporter-master
---
# Source: prometheus-postgres-exporter/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-prometheus-postgres-exporter-replica0
  labels:
    app.kubernetes.io/name: prometheus-postgres-exporter
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: "Monitoring"
    app.kubernetes.io/managed-by: Helm
    helm.sh/chart: prometheus-postgres-exporter-2.3.7
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: prometheus-postgres-exporter
      app.kubernetes.io/instance: release-name
      pginstance: replica0
  template:
    metadata:
      labels:
        app.kubernetes.io/name: prometheus-postgres-exporter
        app.kubernetes.io/instance: release-name
        line: prod
        site: pg-12-prod
        pginstance: replica0
        config-hash: "985be769"
    spec:
      containers:
        - name: exporter
          image: bitnami/postgres-exporter:0.9.0
          imagePullPolicy: IfNotPresent
          env:
            - name: PG_EXPORTER_AUTO_DISCOVER_DATABASES
              value: "true"
            - name: DATA_SOURCE_USER
              value: "postgres"
            - name: DATA_SOURCE_PASS
              value: "pgpass"
            - name: DATA_SOURCE_URI
              value: "replica0:5432/postgres?sslmode=require"
            - name: PG_EXPORTER_EXCLUDE_DATABASES
              value: "template0,template1,rdsadmin,azure_maintenance"
            - name: PG_EXPORTER_INCLUDE_DATABASES
              value: ""
            - name: PG_EXPORTER_EXTEND_QUERY_PATH
              value: /etc/prometheus-postgres-exporter/queries.yaml
          ports:
            - name: metrics
              containerPort: 9187
              protocol: TCP
          volumeMounts:
            - name: config
              mountPath: /etc/prometheus-postgres-exporter/
      volumes:
        - name: config
          configMap:
            name: release-name-prometheus-postgres-exporter-replica
---
# Source: prometheus-postgres-exporter/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-prometheus-postgres-exporter-replica1
  labels:
    app.kubernetes.io/name: prometheus-postgres-exporter
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: "Monitoring"
    app.kubernetes.io/managed-by: Helm
    helm.sh/chart: prometheus-postgres-exporter-2.3.7
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: prometheus-postgres-exporter
      app.kubernetes.io/instance: release-name
      pginstance: replica1
  template:
    metadata:
      labels:
        app.kubernetes.io/name: prometheus-postgres-exporter
        app.kubernetes.io/instance: release-name
        line: prod
        site: pg-12-prod
        pginstance: replica1
        config-hash: "985be769"
    spec:
      containers:
        - name: exporter
          image: bitnami/postgres-exporter:0.9.0
          imagePullPolicy: IfNotPresent
          env:
            - name: PG_EXPORTER_AUTO_DISCOVER_DATABASES
              value: "true"
            - name: DATA_SOURCE_USER
              value: "postgres"
            - name: DATA_SOURCE_PASS
              value: "pgpass"
            - name: DATA_SOURCE_URI
              value: "replica1:5432/postgres?sslmode=require"
            - name: PG_EXPORTER_EXCLUDE_DATABASES
              value: "template0,template1,rdsadmin,azure_maintenance"
            - name: PG_EXPORTER_INCLUDE_DATABASES
              value: ""
            - name: PG_EXPORTER_EXTEND_QUERY_PATH
              value: /etc/prometheus-postgres-exporter/queries.yaml
          ports:
            - name: metrics
              containerPort: 9187
              protocol: TCP
          volumeMounts:
            - name: config
              mountPath: /etc/prometheus-postgres-exporter/
      volumes:
        - name: config
          configMap:
            name: release-name-prometheus-postgres-exporter-replica
---
# Source: prometheus-postgres-exporter/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-prometheus-postgres-exporter-replica2
  labels:
    app.kubernetes.io/name: prometheus-postgres-exporter
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: "Monitoring"
    app.kubernetes.io/managed-by: Helm
    helm.sh/chart: prometheus-postgres-exporter-2.3.7
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: prometheus-postgres-exporter
      app.kubernetes.io/instance: release-name
      pginstance: replica2
  template:
    metadata:
      labels:
        app.kubernetes.io/name: prometheus-postgres-exporter
        app.kubernetes.io/instance: release-name
        line: prod
        site: pg-12-prod
        pginstance: replica2
        config-hash: "985be769"
    spec:
      containers:
        - name: exporter
          image: bitnami/postgres-exporter:0.9.0
          imagePullPolicy: IfNotPresent
          env:
            - name: PG_EXPORTER_AUTO_DISCOVER_DATABASES
              value: "true"
            - name: DATA_SOURCE_USER
              value: "postgres"
            - name: DATA_SOURCE_PASS
              value: "pgpass"
            - name: DATA_SOURCE_URI
              value: "replica2:5432/postgres?sslmode=require"
            - name: PG_EXPORTER_EXCLUDE_DATABASES
              value: "template0,template1,rdsadmin,azure_maintenance"
            - name: PG_EXPORTER_INCLUDE_DATABASES
              value: ""
            - name: PG_EXPORTER_EXTEND_QUERY_PATH
              value: /etc/prometheus-postgres-exporter/queries.yaml
          ports:
            - name: metrics
              containerPort: 9187
              protocol: TCP
          volumeMounts:
            - name: config
              mountPath: /etc/prometheus-postgres-exporter/
      volumes:
        - name: config
          configMap:
            name: release-name-prometheus-postgres-exporter-replica
---
# Source: prometheus-postgres-exporter/templates/podmonitor.yaml
apiVersion: monitoring.coreos.com/v1
kind: PodMonitor
metadata:
  name: release-name-prometheus-postgres-exporter
  labels:
    app.kubernetes.io/name: prometheus-postgres-exporter
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: "Monitoring"
    app.kubernetes.io/managed-by: Helm
    helm.sh/chart: prometheus-postgres-exporter-2.3.7
spec:
  podTargetLabels:
    - line
    - site
  podMetricsEndpoints:
    - port: metrics
  namespaceSelector:
    matchNames:
      - default
  selector:
    matchLabels:
      app.kubernetes.io/name: prometheus-postgres-exporter
      app.kubernetes.io/instance: release-name
